<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="KSMoving">
    <meta name="author" content="Coderthemes">
    <link rel="shortcut icon" href="assets/images/favicon_1.ico">
    <title>RoadToDecovery-Login</title>
    <link href="../plugins/switchery/switchery.min.css" rel="stylesheet" />
    <link href="assets/css/bootstrap-rtl.min.css" rel="stylesheet" type="text/css">
    <link href="assets/css/core.css" rel="stylesheet" type="text/css">
    <link href="assets/css/icons.css" rel="stylesheet" type="text/css">
    <link href="assets/css/components.css" rel="stylesheet" type="text/css">
    <link href="assets/css/pages.css" rel="stylesheet" type="text/css">
    <link href="assets/css/menu.css" rel="stylesheet" type="text/css">
    <link href="assets/css/responsive.css" rel="stylesheet" type="text/css">

    <script src="lib/lz-string.js"></script>
    <script src="lib/master.js"></script>
    <style type="text/css">
        .wrapper-page {
            background-color: #3bafda;
            max-width: 450px;
        }

        body, html {
            overflow-y: hidden;
        }

        #footer img {
            margin: 0px auto;
            height: 100%;
            width: 100%;
        }
    </style>

    <script src="assets/js/CookiesFunctions.js"></script>
    <script src="assets/js/modernizr.min.js"></script>
    <!-- Sweet Alert css -->
    <link href="../plugins/bootstrap-sweetalert/sweet-alert.css" rel="stylesheet" type="text/css" />
    <script src="assets/js/jquery.min.js"></script>

    <script>



            //function Login()
            //{
            //    userName = $("#userName").val();
            //    password = $("#password").val();

            //    //save = $("#checkbox-signup").prop('checked');
            //    $.ajax({
            //        dataType: "json",
            //        url: "WebService.asmx/loginUser",
            //        contentType: "application/json; charset=utf-8",
            //        type: "POST",
            //        async: false,
            //        data: JSON.stringify({ uName: userName, password: password }),
            //        success: function (data) {
            //            var userInDB = JSON.parse(data.d);

            //            if (userInDB) {
            //                swal({
            //                    title: "ברוך הבא",
            //                    type: "success",
            //                    timer: 1000,
            //                    showConfirmButton: false
            //                });
            //                setTimeout(function () {
            //                    location.href = "index.html";
            //                }, 1001);

            //            }
            //            else {
            //                swal({
            //                    title: "שם משתמש או סיסמא שגוי",
            //                    type: "warning",
            //                    timer: 1000,
            //                    showConfirmButton: false
            //                });
            //            }
            //        },
            //        error: function (err) {
            //            alert("Error");
            //        }
            //    });
            //}
            
    </script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body>

    <div class="wrapper-page">
        <div class="card-box">
            <div class="text-center">
                <img src="../../Media/R2R Logo.png" />
            </div>
            <form id="loginForm" class="form-horizontal m-t-20" role="form">
                <div class="form-group">
                    <div class="col-xs-12">
                        <input id="userName" name="userName" class="form-control" type="text" placeholder="שם משתמש">
                        <i class="md md-account-circle form-control-feedback l-h-34"></i>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-xs-12">
                        <input id="password" name="password" class="form-control" type="password" placeholder="סיסמא">
                        <i class="md md-vpn-key form-control-feedback l-h-34"></i>
                    </div>
                </div>
                <div class="form-group text-center m-t-20">
                    <div class="col-xs-12">
                        <button data-toggle="tooltip" title="دخول OK" class="btn btn-primary btn-custom w-md waves-effect waves-light" type="submit" id="loginBTN">
                            כניסה
                        </button>
                    </div>
                </div>

            </form>

        </div>

    </div>
    <div class="text-center">
        תאריך עדכון אחרון: 23/10/2020 15:00
    </div>
        <div class="row" id="footer">
            <div class="col-sm-4">

            </div>
            <div class="col-sm-4">
                <img src="../../Media/Leonard Cohen.jpg" alt="Alternate Text" />
            </div>
            <div class="col-sm-4">

            </div>
        </div>


    <script>
        var resizefunc = [];
    </script>
    <script src="../plugins/jquery-validation/dist/jquery.validate.min.js"></script>
    <script>
        var isAssistant;
        $(document).ready(function () {
            //changeride();
            // DO NOT REMOVE : GLOBAL FUNCTIONS!
            //debugger;
            if (window.location.href.indexOf('http://40.117.122.242/Road%20to%20Recovery/') != -1) {
                window.location.href = "notAvailable.html";
            } // Check that the user did not entered the old path
            var errorClass = 'invalid';
            var errorElement = 'em';
            $('[data-toggle="tooltip"]').tooltip();   

            var $loginForm = $('#loginForm').validate({
                //errorClass: errorClass,
                //errorElement: errorElement,
                //errorElement: 'span',
                //errorClass: 'label label-danger',
                //errorPlacement: function(error, element) {
                //    if(element.parent('.input-group').length) {
                //        error.insertAfter(element.parent());
                //    } else {
                //        error.insertAfter(element);
                //    }
                //},
                highlight: function (element) {
                    jQuery(element).closest('.form-group').addClass('has-error');
                },
                unhighlight: function (element) {
                    jQuery(element).closest('.form-group').removeClass('has-error');
                },

                // Rules for form validation
                rules: {
                    userName: {
                        required: true
                    },
                    password: {
                        required: true
                    }
                },
                submitHandler: function (form, event) {
                    event.preventDefault();
                    //START OF Insert Product Code
                    userName = $("#userName").val();
                    password = $("#password").val();
                    setCookie("username", userName, 1 / 24);
                    //save = $("#checkbox-signup").prop('checked');
                    $.ajax({
                        dataType: "json",
                        url: "WebService.asmx/loginUser",
                        contentType: "application/json; charset=utf-8",
                        type: "POST",
                        async: false,
                        data: JSON.stringify({ uName: userName, password: password }),
                        success: function (data) {
                            var userInDB = JSON.parse(data.d);

                            if (userInDB) {
                                GetIsAssistantByCellphone(userName);
                                if (isAssistant) {
                                    swal({
                                        title: "ברוכים הבאים\nمرحبا بك\nWelcome!",
                                        type: "success",
                                        timer: 1000,
                                        showConfirmButton: false
                                    });
                                    GetUserNameByCellphone(userName);
                                    GENERAL.USER.setIsAssistant(isAssistant);
                                    setTimeout(function () {
                                        location.href = "SelectCoordinator.html";
                                    }, 1002);
                                }
                                else {
                                    swal({
                                        title: "ברוכים הבאים\nمرحبا بك\nWelcome!",
                                        type: "success",
                                        timer: 1000,
                                        showConfirmButton: false
                                    });

                                    setTimeout(function () {
                                        location.href = "manageRidePats.html";
                                    }, 1001);
                                    GetUserNameByCellphone(userName);
                                    GENERAL.USER.setUserName(userName);
                                    GENERAL.USER.setIsAssistant(isAssistant);
                                    // getUserType(userName);
                                }
                            }
                            else {
                                swal({
                                    title: "שם משתמש או סיסמא שגויים",
                                    type: "warning",
                                    timer: 1000,
                                    showConfirmButton: false
                                });
                            }
                        },
                        error: function (err) {
                            alert("Error in loginUser: "+err.responseText);
                        }
                    });
                    //END OF Insert Product Code

                    return false;
                },

                // Messages for form validation
                messages: {
                    userName: {
                        required: "אנא הכנס שם משתמש"
                    },
                    password: {
                        required: "אנא הכנס סיסמא"
                    }
                },

            });
            function GetIsAssistantByCellphone(userName) {
                $.ajax({
                    dataType: "json",
                    url: "WebService.asmx/GetIsAssistantByCellphone",
                    contentType: "application/json; charset=utf-8",
                    type: "POST",
                    async: false,
                    data: JSON.stringify({ uName: userName }),
                    success: function (data) {
                        var userInDB = JSON.parse(data.d);
                        isAssistant = userInDB;
                    },
                    error: function (err) {
                        alert("Error in finding is assistant by cellphone: " + err.responseText);
                        isAssistant = false;
                    }
                });
            }
            function changeride() {
                $.ajax({
                    dataType: "json",
                    url: "WebService.asmx/ChangeRidepatAreas",
                    contentType: "application/json; charset=utf-8",
                    type: "POST",
                    async: false,
                   // data: JSON.stringify({ uName: userName }),
                    success: function (data) {
                        console.log("hey")
                    },
                    error: function (err) {
                        console.log(err.message)
                    }
                });
            }
            function GetUserNameByCellphone(userName)
            {
                if(isAssistant){
                      $.ajax({
                        dataType: "json",
                        url: "WebService.asmx/GetUserEnglishNameByCellphone",
                        contentType: "application/json; charset=utf-8",
                        type: "POST",
                        async: false,
                        data: JSON.stringify({ uName: userName}),
                        success: function (data) {
                            var userInDB = JSON.parse(data.d);
                            console.log(userInDB)
                            if (userInDB != "") {
                                GENERAL.USER.setAsistantDisplayName(userInDB);
                            }
                        },
                        error: function (err) {
                            alert("Error in finding user by cellphone: " + err.responseText);
                        }
                    });
                }
                else{
                    $.ajax({
                        dataType: "json",
                        url: "WebService.asmx/GetUserNameByCellphone",
                        contentType: "application/json; charset=utf-8",
                        type: "POST",
                        async: false,
                        data: JSON.stringify({ uName: userName}),
                        success: function (data) {
                            var userInDB = JSON.parse(data.d);
                            console.log(userInDB)
                            if (userInDB != "") {
                                GENERAL.USER.setUserDisplayName(userInDB);
                            }
                        },
                        error: function (err) {
                            alert("Error in finding user by cellphone: " + err.responseText);
                        }
                    });
                }
            }
            GetDatabaseType();
        });

        function GetDatabaseType() {
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/isProductionDatabase",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                async: true,
                data: "",
                success: function (data) {
                    var ans = JSON.parse(data.d);
                    //GENERAL.isProductionDatabase = ans;
                    localStorage["isProductionDatabase"] = ans;
                    //alert("HERE");
                },
                error: function (err) {
                    alert("Error in isProductionDatabase function: " + err.responseText);
                }
            });
        }

    </script>

    <!-- jQuery  -->
    <script src="assets/js/bootstrap-rtl.min.js"></script>
    <script src="assets/js/detect.js"></script>
    <script src="assets/js/fastclick.js"></script>
    <script src="assets/js/jquery.slimscroll.js"></script>
    <script src="assets/js/jquery.blockUI.js"></script>
    <script src="assets/js/waves.js"></script>
    <script src="assets/js/wow.min.js"></script>
    <script src="assets/js/jquery.nicescroll.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="../plugins/switchery/switchery.min.js"></script>
    <!-- Sweet Alert js -->
    <script src="../plugins/bootstrap-sweetalert/sweet-alert.min.js"></script>
    <script src="assets/pages/jquery.sweet-alert.init.js"></script>
    <script src="assets/js/jquery.core.js"></script>
    <script src="assets/js/jquery.app.js"></script>
</body>
</html>