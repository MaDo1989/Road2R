<!DOCTYPE html>
<html lang="en" dir="rtl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="KSMoving">
    <meta name="author" content="Coderthemes">

    <link rel="shortcut icon" href="assets/images/favicon_1.ico">

    <title>ניהול ההסעות </title>
    <!--GENERAL object and additional functions-->
    <script src="lib/lz-string.js"></script>
    <script src="lib/master.js"></script>
    <script src="lib/rideMessages.js"></script>
    <!-- use version 0.20.0 -->
    <!--this script cdn is for export to xlsx file without changing the data tables.-->
    <script lang="javascript" src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

    <!-- #region REAL-TIME BY SIGNALR - FOR ANY COMPLAINTS WHATSOEVER YOU CAN TALK 2 YOGEV-->
    <script src="../../Scripts/jquery-3.6.0.min.js"></script>
    <script src="../../Scripts/jquery.signalR-2.4.2.min.js"></script>

    <!--Reference↓ the AUTOGENERATED!!! SignalR hub script (by run time)-->
    <script src="../../signalr/hubs"></script>
    <script>

        //#region Variables for real-time updates

        let tableNameRidePatShouldBeRender;
        let tableName2manipulate;
        let thisRidePatDate;
        let thisRidePatLastModified;
        let row2manipulate;
        let tr_nodesAsArray = [];
        let node2manipulate;
        let nodechilds;
        let lastModified_td;
        let ridePatBeforeUpdate;
        let _timeinterval_G = localStorage.getItem('timeInterval') != undefined ? localStorage.getItem('timeInterval') : 'טווח זמן'
        const ADD_DRIVER = 'add driver', REMOVE_DRIVER = 'remove driver', RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED = 'ridepat_patient_status_edittime_changed';
        const tableNames = {
            MORNING: 'datatable-morning',
            AFTERNOON: 'datatable-afternoon',
            TOMORROW_MORNING: 'datatable-tomorrow-morning',
            TOMORROW_AFTERNOON: 'datatable-tomorrow-afternoon',
            FUTURE: 'datatable-future',
            NOT_RELEVANT: 'not-relevant'
        }
        let currentRidePat_EditTimeStamp;
        let updatedRidePat_EditTimeStamp;
        let currentRidePat_status;
        let updatedRidePat_status;
        let isAfterNoonRide;
        let treatmentFinished;
        let driverIsAssigned;
        let listRowstoColor = [];
        hospitals = [];
        //#endregion

        //#region Functions to Reuse

        const update_arr_rides = (updated_ridePat) => {
            const index = arr_rides.findIndex(r => r.RidePatNum === updated_ridePat.RidePatNum);
            ridePatBeforeUpdate = arr_rides[index];
            arr_rides[index] = updated_ridePat;
        }

        //make the flat object to complex object like the old API
        const CustomRideObject = (thisRide) => {

            let CustomObj = {};
            CustomObj.RidePatNum = thisRide.RidePatNum;
            CustomObj.Status = thisRide.Status;
            CustomObj.Remark = thisRide.Remark;
            CustomObj.OnlyEscort = thisRide.OnlyEscort;
            CustomObj.LastModified = thisRide.LastModified;
            CustomObj.Date = thisRide.PickupTime;

            CustomObj.Pat = {};
            CustomObj.Pat.DisplayName = thisRide.PatientName;
            CustomObj.Pat.Id = thisRide.PatientId;
            CustomObj.Pat.DisplayNameA = ''
            CustomObj.Pat.EnglishName = ''
            CustomObj.Pat.PatientIdentity = 0;
            CustomObj.Pat.Equipment = thisRide.PatientEquipments == null ? [] : thisRide.PatientEquipments ;
            CustomObj.Pat.IsAnonymous = thisRide.IsAnonymous;
            CustomObj.Pat.RidePatPatientStatus = {};
            CustomObj.Pat.RidePatPatientStatus.Status = (thisRide.PatientStatus == "" || thisRide.PatientStatus == "Not Finished") ? -1 : 1;
            CustomObj.Pat.RidePatPatientStatus.EditTimeStamp = thisRide.PatientStatusEditTime

            CustomObj.Pat.EscortedList = [];
            CustomObj.Escorts = [];
            //for (var i = 0; i < thisRide[18].Value.length; i++) {
            //    let oneEscort = {}
            //    oneEscort.Id = thisRide[18].Value[i][0].Value;
            //    oneEscort.DisplayName = thisRide[18].Value[i][1].Value;
            //    CustomObj.Escorts.push(oneEscort);
            //}
            for (var i = 0; i < thisRide.AmountOfEscorts; i++) {
                let oneEscort = {}
                oneEscort.Id = 0
                oneEscort.DisplayName = ''
                CustomObj.Pat.EscortedList.push(oneEscort);
            }

            for (var i = 0; i < thisRide.AmountOfEscorts; i++) {
                let oneEscort = {}
                oneEscort.Id = 0
                oneEscort.DisplayName = ''
                CustomObj.Escorts.push(oneEscort);
            }

            CustomObj.Drivers = [];
            let Maindriver = {};
            Maindriver.DisplayName = thisRide.DriverName;
            Maindriver.Id = thisRide.MainDriver;
            Maindriver.CellPhone = thisRide.DriverCellPhone
            CustomObj.Drivers.push(Maindriver);
            if (Maindriver.Id == null || Maindriver.Id==-1) {
                CustomObj.Drivers = [];
            }

            CustomObj.Destination = {};
            CustomObj.Destination.Name = thisRide.Destination
            CustomObj.Origin = {};
            CustomObj.Origin.Name = thisRide.Origin;

            CustomObj.Pat.Barrier = {}
            CustomObj.Pat.Hospital = {}
            CustomObj.Pat.Age = thisRide.PatientAge;
            CustomObj.Pat.cellPhone = thisRide.PatientCellPhone;
            CustomObj.Pat.GenderAsEnum = thisRide.PatientGender;
            CustomObj.Pat.Barrier.Name = CustomObj.Destination.Name;
            CustomObj.Pat.Hospital.Name = CustomObj.Origin.Name;

            CustomObj.Coordinator = {};
            CustomObj.Coordinator.DisplayName = thisRide.CoorName
            CustomObj.Coordinator.Id = thisRide.CoorId

            return CustomObj;
        }


     
        const getTableName2Manipulate = (ridePatNum) => {
            let tableName2manipulate;
            if (typeof tMorning.row(`#${ridePatNum}`).data() !== 'undefined') {
                tableName2manipulate = tableNames.MORNING;
            } else if (typeof tAfternoon.row(`#${ridePatNum}`).data() !== 'undefined') {
                tableName2manipulate = tableNames.AFTERNOON;
            } else if (typeof tTomorrowMorning.row(`#${ridePatNum}`).data() !== 'undefined') {
                tableName2manipulate = tableNames.TOMORROW_MORNING;
            } else if (typeof tTomorrowAfternoon.row(`#${ridePatNum}`).data() !== 'undefined') {
                tableName2manipulate = tableNames.TOMORROW_AFTERNOON;
            } else if (typeof tFuture.row(`#${ridePatNum}`).data() !== 'undefined') {
                tableName2manipulate = tableNames.FUTURE;
            } else {
                tableName2manipulate = 'table did not found...';
            }
            return tableName2manipulate;
        }

        const getTableNameToBeRenderedIn = (ridepatDate) => {

            let tableName = '';

            if (ridepatDate.toLocaleDateString() === new Date().toLocaleDateString()) {//<---- today

                if (ridepatDate.getHours() < 12) {

                    tableName = tableNames.MORNING;
                } else {

                    tableName = tableNames.AFTERNOON;
                }

            } else {

                tableName = tableNames.NOT_RELEVANT;
            }

            return tableName;
        }

        const fixDate_WhichComeFromOpenConnection = (date2fix, getDate = true) => {

            const ticks = new Date(date2fix) - new Date().getTimezoneOffset() * 60000;

            if (getDate) {

                let fixedDate = new Date(ticks);
                return fixedDate;
            }

            return ticks;
        }

        const manipilateNodeStyle = (tr_node2manipulate, updated_ridePat, functionlity, isFutureTable = false, tableName = "") => {

            nodechilds = Array.from($(tr_node2manipulate).children());
            lastModified_td = nodechilds.find(x => x.className.includes('last-modified_td'));
            driver_td = nodechilds.find(x => x.className.includes('driver_td'));
            $(lastModified_td).addClass('within2HoursSinceChange');
            //console.log('CHECK COLOR-->', driver_td)
            $(driver_td).removeClass('withIn12HoursDrive withIn24HoursDrive');

            switch (functionlity) {

                case ADD_DRIVER:

                    //if (!isFutureTable && updated_ridePat.Pat.IsAnonymous === 'True') {
                    //    $(tr_node2manipulate).addClass('driverAssign2AnonymousRide');
                    //}

                    break;

                case REMOVE_DRIVER:

                    $(tr_node2manipulate).removeClass('driverAssign2AnonymousRide');

                    let hh, mm;
                    const rideDate = fixDate_WhichComeFromOpenConnection(updated_ridePat.Date);

                    if (rideDate.getMinutes() === afternoonIndicator) {
                        hh = 12, mm = 0;
                    } else {
                        hh = rideDate.getHours(), mm = rideDate.getMinutes();
                    }

                    const suitableClass = classManager.getSuitableClassS_4thisTime(tableName, hh, mm);
                    $(driver_td).addClass(suitableClass);
                    break;

                case RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED:
                    $(tr_node2manipulate).addClass('highlightRow-after-patientStatusModal');

                    break;

            }
        }

        const shiftRidePatToSuitableTable = (tableNameRidePatIsNowIn, tableNameRidePatShouldBeRender, updated_ridePat) => {

            removeRidePatFromOldTable(tableNameRidePatIsNowIn, updated_ridePat);

            rePaintRidePatToNewTable(tableNameRidePatShouldBeRender, updated_ridePat);
        }

        const removeRidePatFromOldTable = (tableNameRidePatIsNowIn, updated_ridePat) => {

            switch (tableNameRidePatIsNowIn) {
                case tableNames.MORNING:

                    row2manipulate = tMorning.row(`#${updated_ridePat.RidePatNum}`).data();
                    tMorning.row(row2manipulate).remove().draw();
                    break;

                case tableNames.AFTERNOON:

                    row2manipulate = tAfternoon.row(`#${updated_ridePat.RidePatNum}`).data();
                    tAfternoon.row(row2manipulate).remove().draw();
                    break;
            }

        }

        const rePaintRidePatToNewTable = (tableNameRidePatShouldBeRender, updated_ridePat) => {

            let ridePat2Draw = {};
            ridePat2Draw.time = buildTimeHTML(thisRidePatDate, updated_ridePat.RidePatNum);
            ridePat2Draw.origin = !isAssistant ? updated_ridePat.Origin.Name : updated_ridePat.Origin.EnglishName;
            ridePat2Draw.destination = !isAssistant ? updated_ridePat.Destination.Name : updated_ridePat.Destination.EnglishName;
            ridePat2Draw.patient = buildPatientHTML(updated_ridePat);
            row2manipulate.patientAge = buildPatientAgeHTML_AfterUnited(updated_ridePat.Pat);
            ridePat2Draw.driver = buildDriverHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers[0], updated_ridePat.RidePatNum);
            ridePat2Draw.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
            ridePat2Draw.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
            ridePat2Draw.remark = buildRemarkHTML(updated_ridePat.Remark, updated_ridePat.RidePatNum);
            ridePat2Draw.isAnonymous = updated_ridePat.Pat.IsAnonymous;
            ridePat2Draw.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

            switch (tableNameRidePatShouldBeRender) {

                case tableNames.MORNING:

                    tMorning.row.add(
                        {
                            ridePatNum: updated_ridePat.RidePatNum,
                            time: ridePat2Draw.time,
                            origin: ridePat2Draw.origin,
                            destination: ridePat2Draw.destination,
                            patient: ridePat2Draw.patient,
                            patientAge: row2manipulate.patientAge,
                            driver: ridePat2Draw.driver,
                            status: ridePat2Draw.status,
                            lastModified: ridePat2Draw.lastModified,
                            remark: ridePat2Draw.remark,
                            isAnonymous: ridePat2Draw.isAnonymous,
                            buttons: ridePat2Draw.buttons
                        }
                    ).draw(false);

                    tr_nodesAsArray = Array.from(tMorning.rows().nodes());
                    break;

                case tableNames.AFTERNOON:

                    tAfternoon.row.add(
                        {
                            ridePatNum: updated_ridePat.RidePatNum,
                            time: ridePat2Draw.time,
                            origin: ridePat2Draw.origin,
                            destination: ridePat2Draw.destination,
                            patient: ridePat2Draw.patient,
                            patientAge: row2manipulate.patientAge,
                            driver: ridePat2Draw.driver,
                            status: ridePat2Draw.status,
                            lastModified: ridePat2Draw.lastModified,
                            remark: ridePat2Draw.remark,
                            isAnonymous: ridePat2Draw.isAnonymous,
                            buttons: ridePat2Draw.buttons
                        }
                    ).draw(false);

                    tr_nodesAsArray = Array.from(tAfternoon.rows().nodes());
                    break;
            }

            if (tr_nodesAsArray) {
                tr_node2manipulate = tr_nodesAsArray.find(node => node.id === `${updated_ridePat.RidePatNum}`);

                updatedRidePat_status = updated_ridePat.Pat.RidePatPatientStatus.Status;
                treatmentFinished = updatedRidePat_status === patientStatus.Finished;
                driverIsAssigned = updated_ridePat.Drivers.length > 0;

                if (!driverIsAssigned && treatmentFinished) {
                   manipilateNodeStyle(tr_node2manipulate, updated_ridePat, RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED);
                }

            }
        }

        //#endregion

        //#region Hubs Connections

        const notification = $.connection.ridePatHub;
        const notification2 = $.connection.unityRideHub;

        $.connection.hub.start().done();

        //#endregion

        //#region Callbacks Function From Server to Clients

        notification.client.ridePatUpdated = function (updated_ridePat) {

            /*   *********************
                 * !!! IMPORTANT !!! *
                 ********↓↓↓**********/
            //update the specific ride in arr_rides:
            update_arr_rides(updated_ridePat);
            /*  *********↑↑↑*********
                * !!! IMPORTANT !!! *
                *********************/
            //console.log('From notification.client.ridePatUpdated--> get this-->', updated_ridePat);
            tableName2manipulate = getTableName2Manipulate(updated_ridePat.RidePatNum);
            thisRidePatDate = fixDate_WhichComeFromOpenConnection(updated_ridePat.Date);
            thisRidePatLastModified = fixDate_WhichComeFromOpenConnection(updated_ridePat.LastModified);
            tableNameRidePatShouldBeRender = getTableNameToBeRenderedIn(thisRidePatDate);

            if (tableName2manipulate !== tableNameRidePatShouldBeRender && tableNameRidePatShouldBeRender !== tableNames.NOT_RELEVANT) {

                shiftRidePatToSuitableTable(tableName2manipulate, tableNameRidePatShouldBeRender, updated_ridePat);
            } else {

                switch (tableName2manipulate) {

                    case tableNames.MORNING:

                        row2manipulate = tMorning.row(`#${updated_ridePat.RidePatNum}`).data();

                        row2manipulate.time = buildTimeHTML(thisRidePatDate, updated_ridePat.RidePatNum);
                        row2manipulate.origin = !isAssistant ? updated_ridePat.Origin.Name : updated_ridePat.Origin.EnglishName;
                        row2manipulate.destination = !isAssistant ? updated_ridePat.Destination.Name : updated_ridePat.Destination.EnglishName;
                        row2manipulate.patient = buildPatientHTML(updated_ridePat);
                        row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers[0], updated_ridePat.RideNum);
                        row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                        row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                        row2manipulate.remark = buildRemarkHTML(updated_ridePat.Remark, updated_ridePat.RidePatNum);
                        row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                        tMorning.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                        increaseCounter(tableNames.MORNING, updated_ridePat.RidePatNum);

                        tr_nodesAsArray = Array.from(tMorning.rows().nodes());
                        break;

                    case tableNames.AFTERNOON:

                        row2manipulate = tAfternoon.row(`#${updated_ridePat.RidePatNum}`).data();

                        row2manipulate.time = buildTimeHTML(thisRidePatDate, updated_ridePat.RidePatNum);
                        row2manipulate.origin = !isAssistant ? updated_ridePat.Origin.Name : updated_ridePat.Origin.EnglishName;
                        row2manipulate.destination = !isAssistant ? updated_ridePat.Destination.Name : updated_ridePat.Destination.EnglishName;
                        row2manipulate.patient = buildPatientHTML(updated_ridePat);
                        row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers[0], updated_ridePat.RideNum);
                        row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                        row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                        row2manipulate.remark = buildRemarkHTML(updated_ridePat.Remark, updated_ridePat.RidePatNum);;
                        row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                        tAfternoon.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                        increaseCounter(tableNames.AFTERNOON, updated_ridePat.RidePatNum);

                        tr_nodesAsArray = Array.from(tAfternoon.rows().nodes());
                        break;

                    case tableNames.TOMORROW_MORNING:

                        row2manipulate = tTomorrowMorning.row(`#${updated_ridePat.RidePatNum}`).data();

                        row2manipulate.date = thisRidePatDate.toLocaleDateString('he-IL');
                        row2manipulate.time = buildTimeHTML(thisRidePatDate, updated_ridePat.RidePatNum);
                        row2manipulate.origin = !isAssistant ? updated_ridePat.Origin.Name : updated_ridePat.Origin.EnglishName;
                        row2manipulate.destination = !isAssistant ? updated_ridePat.Destination.Name : updated_ridePat.Destination.EnglishName;
                        row2manipulate.patient = buildPatientHTML(updated_ridePat);
                        row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers[0], updated_ridePat.RideNum);
                        row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                        row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                        row2manipulate.remark = buildRemarkHTML(updated_ridePat.Remark, updated_ridePat.RidePatNum);;
                        row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                        tTomorrowMorning.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                        increaseCounter(tableNames.TOMORROW_MORNING, updated_ridePat.RidePatNum);

                        tr_nodesAsArray = Array.from(tTomorrowMorning.rows().nodes());

                        break;

                    case tableNames.TOMORROW_AFTERNOON:

                        row2manipulate = tTomorrowAfternoon.row(`#${updated_ridePat.RidePatNum}`).data();

                        row2manipulate.date = thisRidePatDate.toLocaleDateString('he-IL');
                        row2manipulate.time = buildTimeHTML(thisRidePatDate, updated_ridePat.RidePatNum);
                        row2manipulate.origin = !isAssistant ? updated_ridePat.Origin.Name : updated_ridePat.Origin.EnglishName;
                        row2manipulate.destination = !isAssistant ? updated_ridePat.Destination.Name : updated_ridePat.Destination.EnglishName;
                        row2manipulate.patient = buildPatientHTML(updated_ridePat);
                        row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers[0], updated_ridePat.RideNum);
                        row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                        row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                        row2manipulate.remark = buildRemarkHTML(updated_ridePat.Remark, updated_ridePat.RidePatNum);;
                        row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                        tTomorrowAfternoon.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                        increaseCounter(tableNames.TOMORROW_AFTERNOON, updated_ridePat.RidePatNum);

                        tr_nodesAsArray = Array.from(tTomorrowMorning.rows().nodes());

                        break;


                    case tableNames.FUTURE:

                        row2manipulate = tFuture.row(`#${updated_ridePat.RidePatNum}`).data();

                        row2manipulate.date = thisRidePatDate.toLocaleDateString('he-IL');
                        row2manipulate.time = buildTimeHTML(thisRidePatDate, updated_ridePat.RidePatNum);
                        row2manipulate.origin = !isAssistant ? updated_ridePat.Origin.Name : updated_ridePat.Origin.EnglishName;
                        row2manipulate.destination = !isAssistant ? updated_ridePat.Destination.Name : updated_ridePat.Destination.EnglishName;
                        row2manipulate.patient = buildPatientHTML(updated_ridePat);
                        row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers[0], updated_ridePat.RideNum);
                        row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                        row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                        row2manipulate.remark = buildRemarkHTML(updated_ridePat.Remark, updated_ridePat.RidePatNum);;
                        row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                        tFuture.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                        increaseCounter(tableNames.FUTURE, updated_ridePat.RidePatNum);

                        tr_nodesAsArray = Array.from(tFuture.rows().nodes());
                        tr_node2manipulate = tr_nodesAsArray.find(node => node.id === `${updated_ridePat.RidePatNum}`);
                        manipilateNodeStyle(tr_node2manipulate, updated_ridePat, ADD_DRIVER, true);

                        break;

                    default:
                        console.log('system recognized a tempt of the server to post real-time data but failed to found the rellevant row to redraw');
                        tr_nodesAsArray = null;
                        break;
                }

                if (tr_nodesAsArray) {
                    tr_node2manipulate = tr_nodesAsArray.find(node => node.id === `${updated_ridePat.RidePatNum}`);

                    updatedRidePat_status = updated_ridePat.Pat.RidePatPatientStatus.Status;
                    treatmentFinished = updatedRidePat_status === patientStatus.Finished;
                    isAfterNoonRide = thisRidePatDate.getMinutes() === afternoonIndicator;
                    driverIsAssigned = updated_ridePat.Drivers.length > 0;

                    if (treatmentFinished) {

                        if (!driverIsAssigned) {

                            manipilateNodeStyle(tr_node2manipulate, updated_ridePat, RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED);
                        } else if (driverIsAssigned && isAfterNoonRide) {

                            manipilateNodeStyle(tr_node2manipulate, updated_ridePat, RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED);
                        } else {

                            $(tr_node2manipulate).removeClass('highlightRow-after-patientStatusModal');
                        }
                    } else {

                        $(tr_node2manipulate).removeClass('highlightRow-after-patientStatusModal');
                    }
                }
            }
        }

        //Gilad addition use signalR
        notification2.client.UnityRideUpdated = function (updatedUnityRide) {
            //console.log('From server to client in notification2.client.ridePatUpdated get this --> ', updatedUnityRide);
            /*   *********************
                 * !!! IMPORTANT !!! *
                 ********↓↓↓**********/
            //update the specific ride in arr_rides:
            update_arr_rides(updatedUnityRide);
            /*  *********↑↑↑*********
                * !!! IMPORTANT !!! *
                *********************/

            let customRide = CustomRideObject(updatedUnityRide); // to ajust the object

            //console.log('After Custom object look like this-->', customRide)

            tableName2manipulate = getTableName2Manipulate(customRide.RidePatNum);
            thisRidePatDate = fixDate_WhichComeFromOpenConnection(customRide.Date);
            thisRidePatLastModified = fixDate_WhichComeFromOpenConnection(customRide.LastModified);
            tableNameRidePatShouldBeRender = getTableNameToBeRenderedIn(thisRidePatDate);

            if (tableName2manipulate !== tableNameRidePatShouldBeRender && tableNameRidePatShouldBeRender !== tableNames.NOT_RELEVANT) {

                shiftRidePatToSuitableTable(tableName2manipulate, tableNameRidePatShouldBeRender, customRide);
            } else {

                switch (tableName2manipulate) {

                    case tableNames.MORNING:

                        row2manipulate = tMorning.row(`#${customRide.RidePatNum}`).data();

                        row2manipulate.time = buildTimeHTML(thisRidePatDate, customRide.RidePatNum);
                        row2manipulate.origin = !isAssistant ? customRide.Origin.Name : customRide.Origin.EnglishName;
                        row2manipulate.destination = !isAssistant ? customRide.Destination.Name : customRide.Destination.EnglishName;
                        row2manipulate.patient = buildPatientHTML(customRide);
                        row2manipulate.driver = buildDriverHTML(customRide.RidePatNum, customRide.Drivers[0], customRide.RidePatNum);
                        row2manipulate.status = buildStatusString(customRide.Pat.RidePatPatientStatus, customRide.RidePatNum);
                        row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                        row2manipulate.remark = buildRemarkHTML(customRide.Remark, customRide.RidePatNum);
                        row2manipulate.buttons = buildAcionsButtonsHTML(customRide.RidePatNum, customRide.Drivers);

                        tMorning.row(`#${customRide.RidePatNum}`).data(row2manipulate).draw('page');
                        increaseCounter(tableNames.MORNING, customRide.RidePatNum);

                        tr_nodesAsArray = Array.from(tMorning.rows().nodes());

                        if (customRide.Status == 'נמחקה') {
                            tMorning.row(`#${customRide.RidePatNum}`).remove().draw()
                        }
                        break;

                    case tableNames.AFTERNOON:

                        row2manipulate = tAfternoon.row(`#${customRide.RidePatNum}`).data();

                        row2manipulate.time = buildTimeHTML(thisRidePatDate, customRide.RidePatNum);
                        row2manipulate.origin = !isAssistant ? customRide.Origin.Name : customRide.Origin.EnglishName;
                        row2manipulate.destination = !isAssistant ? customRide.Destination.Name : customRide.Destination.EnglishName;
                        row2manipulate.patient = buildPatientHTML(customRide);
                        row2manipulate.driver = buildDriverHTML(customRide.RidePatNum, customRide.Drivers[0], customRide.RidePatNum);
                        row2manipulate.status = buildStatusString(customRide.Pat.RidePatPatientStatus, customRide.RidePatNum);
                        row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                        row2manipulate.remark = buildRemarkHTML(customRide.Remark, customRide.RidePatNum);
                        row2manipulate.buttons = buildAcionsButtonsHTML(customRide.RidePatNum, customRide.Drivers);

                        tAfternoon.row(`#${customRide.RidePatNum}`).data(row2manipulate).draw('page');
                        increaseCounter(tableNames.AFTERNOON, customRide.RidePatNum);

                        tr_nodesAsArray = Array.from(tAfternoon.rows().nodes());
                        if (customRide.Status == 'נמחקה') {
                            tAfternoon.row(`#${customRide.RidePatNum}`).remove().draw()
                        }
                        break;

                    case tableNames.TOMORROW_MORNING:

                        row2manipulate = tTomorrowMorning.row(`#${customRide.RidePatNum}`).data();

                        row2manipulate.date = thisRidePatDate.toLocaleDateString('he-IL');
                        row2manipulate.time = buildTimeHTML(thisRidePatDate, customRide.RidePatNum);
                        row2manipulate.origin = !isAssistant ? customRide.Origin.Name : customRide.Origin.EnglishName;
                        row2manipulate.destination = !isAssistant ? customRide.Destination.Name : customRide.Destination.EnglishName;
                        row2manipulate.patient = buildPatientHTML(customRide);
                        row2manipulate.driver = buildDriverHTML(customRide.RidePatNum, customRide.Drivers[0], customRide.RidePatNum);
                        row2manipulate.status = buildStatusString(customRide.Pat.RidePatPatientStatus, customRide.RidePatNum);
                        row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                        row2manipulate.remark = buildRemarkHTML(customRide.Remark, customRide.RidePatNum);
                        row2manipulate.buttons = buildAcionsButtonsHTML(customRide.RidePatNum, customRide.Drivers);

                        tTomorrowMorning.row(`#${customRide.RidePatNum}`).data(row2manipulate).draw('page');
                        increaseCounter(tableNames.TOMORROW_MORNING, customRide.RidePatNum);

                        tr_nodesAsArray = Array.from(tTomorrowMorning.rows().nodes());

                        if (customRide.Status == 'נמחקה') {
                            tTomorrowMorning.row(`#${customRide.RidePatNum}`).remove().draw()
                        }
                        break;

                    case tableNames.TOMORROW_AFTERNOON:

                        row2manipulate = tTomorrowAfternoon.row(`#${customRide.RidePatNum}`).data();

                        row2manipulate.date = thisRidePatDate.toLocaleDateString('he-IL');
                        row2manipulate.time = buildTimeHTML(thisRidePatDate, customRide.RidePatNum);
                        row2manipulate.origin = !isAssistant ? customRide.Origin.Name : customRide.Origin.EnglishName;
                        row2manipulate.destination = !isAssistant ? customRide.Destination.Name : customRide.Destination.EnglishName;
                        row2manipulate.patient = buildPatientHTML(customRide);
                        row2manipulate.driver = buildDriverHTML(customRide.RidePatNum, customRide.Drivers[0], customRide.RidePatNum);
                        row2manipulate.status = buildStatusString(customRide.Pat.RidePatPatientStatus, customRide.RidePatNum);
                        row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                        row2manipulate.remark = buildRemarkHTML(customRide.Remark, customRide.RidePatNum);
                        row2manipulate.buttons = buildAcionsButtonsHTML(customRide.RidePatNum, customRide.Drivers);

                        tTomorrowAfternoon.row(`#${customRide.RidePatNum}`).data(row2manipulate).draw('page');
                        increaseCounter(tableNames.TOMORROW_AFTERNOON, customRide.RidePatNum);

                        tr_nodesAsArray = Array.from(tTomorrowMorning.rows().nodes());

                        if (customRide.Status == 'נמחקה') {
                            tTomorrowAfternoon.row(`#${customRide.RidePatNum}`).remove().draw()
                        }
                        break;


                    case tableNames.FUTURE:

                        row2manipulate = tFuture.row(`#${customRide.RidePatNum}`).data();

                        row2manipulate.date = thisRidePatDate.toLocaleDateString('he-IL');
                        row2manipulate.time = buildTimeHTML(thisRidePatDate, customRide.RidePatNum);
                        row2manipulate.origin = !isAssistant ? customRide.Origin.Name : customRide.Origin.EnglishName;
                        row2manipulate.destination = !isAssistant ? customRide.Destination.Name : customRide.Destination.EnglishName;
                        row2manipulate.patient = buildPatientHTML(customRide);
                        row2manipulate.driver = buildDriverHTML(customRide.RidePatNum, customRide.Drivers[0], customRide.RidePatNum);
                        row2manipulate.status = buildStatusString(customRide.Pat.RidePatPatientStatus, customRide.RidePatNum);
                        row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                        row2manipulate.remark = buildRemarkHTML(customRide.Remark, customRide.RidePatNum);;
                        row2manipulate.buttons = buildAcionsButtonsHTML(customRide.RidePatNum, customRide.Drivers);

                        tFuture.row(`#${customRide.RidePatNum}`).data(row2manipulate).draw('page');
                        increaseCounter(tableNames.FUTURE, customRide.RidePatNum);

                        tr_nodesAsArray = Array.from(tFuture.rows().nodes());
                        tr_node2manipulate = tr_nodesAsArray.find(node => node.id === `${customRide.RidePatNum}`);
                        manipilateNodeStyle(tr_node2manipulate, customRide, ADD_DRIVER, true);
                        if (customRide.Status == 'נמחקה') {
                            tFuture.row(`#${customRide.RidePatNum}`).remove().draw()
                        }
                        if (customRide.RidePatNum <0) {
                            tFuture.row(`#${customRide.RidePatNum*-1}`).remove().draw()
                        }

                        break;

                    default:
                        console.log('system recognized a tempt of the server to post real-time data but failed to found the rellevant row to redraw');
                        tr_nodesAsArray = null;
                        break;
                }

                if (tr_nodesAsArray) {
                    tr_node2manipulate = tr_nodesAsArray.find(node => node.id === `${customRide.RidePatNum}`);

                    updatedRidePat_status = customRide.Pat.RidePatPatientStatus.Status;
                    treatmentFinished = updatedRidePat_status === patientStatus.Finished;
                    isAfterNoonRide = thisRidePatDate.getMinutes() === afternoonIndicator;
                    driverIsAssigned = customRide.Drivers.length > 0;

                    if (treatmentFinished) {
                        //console.log('color check -->', tr_node2manipulate, customRide, RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED)
                        if (!driverIsAssigned) {

                            manipilateNodeStyle(tr_node2manipulate, customRide, RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED);
                        } else if (driverIsAssigned && isAfterNoonRide) {

                            manipilateNodeStyle(tr_node2manipulate, customRide, RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED);
                        } else {

                            $(tr_node2manipulate).removeClass('highlightRow-after-patientStatusModal');
                        }
                    } else {
                        //console.log('color check -->', tr_node2manipulate, customRide, RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED)
                        manipilateNodeStyle(tr_node2manipulate, customRide, RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED);
                        $(tr_node2manipulate).removeClass('highlightRow-after-patientStatusModal');
                    }
                }
            }
        }

        notification.client.driverHasAssigned2RidePat = function (updated_ridePat) {

            /*   *********************
                 * !!! IMPORTANT !!! *
                 ********↓↓↓**********/
            //update the specific ride in arr_rides:
            update_arr_rides(updated_ridePat);
            /*  *********↑↑↑*********
                * !!! IMPORTANT !!! *
                *********************/

            tableName2manipulate = getTableName2Manipulate(updated_ridePat.RidePatNum);
            thisRidePatDate = fixDate_WhichComeFromOpenConnection(updated_ridePat.Date);
            thisRidePatLastModified = fixDate_WhichComeFromOpenConnection(updated_ridePat.LastModified);

            switch (tableName2manipulate) {

                case tableNames.MORNING:

                    row2manipulate = tMorning.row(`#${updated_ridePat.RidePatNum}`).data();

                    row2manipulate.time = buildTimeHTML(thisRidePatDate, updated_ridePat.RidePatNum);
                    row2manipulate.origin = !isAssistant ? updated_ridePat.Origin.Name : updated_ridePat.Origin.EnglishName;
                    row2manipulate.destination = !isAssistant ? updated_ridePat.Destination.Name : updated_ridePat.Destination.EnglishName;
                    row2manipulate.patient = buildPatientHTML(updated_ridePat);
                    row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers[0], updated_ridePat.RideNum);
                    row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                    row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    //row2manipulate.englishOriginAndDestination = updated_ridePat.Origin.EnglishName + " - " + updated_ridePat.Destination.EnglishName;
                    row2manipulate.remark = buildRemarkHTML(updated_ridePat.Remark, updated_ridePat.RidePatNum);;
                    row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                    tMorning.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                    increaseCounter(tableNames.MORNING, updated_ridePat.RidePatNum);

                    tr_nodesAsArray = Array.from(tMorning.rows().nodes());
                    break;

                case tableNames.AFTERNOON:

                    row2manipulate = tAfternoon.row(`#${updated_ridePat.RidePatNum}`).data();

                    row2manipulate.time = buildTimeHTML(thisRidePatDate, updated_ridePat.RidePatNum);
                    row2manipulate.origin = !isAssistant ? updated_ridePat.Origin.Name : updated_ridePat.Origin.EnglishName;
                    row2manipulate.destination = !isAssistant ? updated_ridePat.Destination.Name : updated_ridePat.Destination.EnglishName;
                    row2manipulate.patient = buildPatientHTML(updated_ridePat);
                    row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers[0], updated_ridePat.RideNum);
                    row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                    row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    //row2manipulate.englishOriginAndDestination = updated_ridePat.Origin.EnglishName + " - " + updated_ridePat.Destination.EnglishName;
                    row2manipulate.remark = buildRemarkHTML(updated_ridePat.Remark, updated_ridePat.RidePatNum);;
                    row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                    tAfternoon.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                    increaseCounter(tableNames.AFTERNOON, updated_ridePat.RidePatNum);

                    tr_nodesAsArray = Array.from(tAfternoon.rows().nodes());
                    break;

                case tableNames.TOMORROW_MORNING:

                    row2manipulate = tTomorrowMorning.row(`#${updated_ridePat.RidePatNum}`).data();

                    row2manipulate.date = thisRidePatDate.toLocaleDateString('he-IL');
                    row2manipulate.time = buildTimeHTML(thisRidePatDate, updated_ridePat.RidePatNum);
                    row2manipulate.origin = !isAssistant ? updated_ridePat.Origin.Name : updated_ridePat.Origin.EnglishName;
                    row2manipulate.destination = !isAssistant ? updated_ridePat.Destination.Name : updated_ridePat.Destination.EnglishName;
                    row2manipulate.patient = buildPatientHTML(updated_ridePat);
                    row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers[0], updated_ridePat.RideNum);
                    row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                    row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    //row2manipulate.englishOriginAndDestination = updated_ridePat.Origin.EnglishName + " - " + updated_ridePat.Destination.EnglishName;
                    row2manipulate.remark = buildRemarkHTML(updated_ridePat.Remark, updated_ridePat.RidePatNum);;
                    row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                    tTomorrowMorning.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                    increaseCounter(tableNames.TOMORROW_MORNING, updated_ridePat.RidePatNum);

                    tr_nodesAsArray = Array.from(tTomorrowMorning.rows().nodes());
                    break;

                case tableNames.TOMORROW_AFTERNOON:

                    row2manipulate = tTomorrowAfternoon.row(`#${updated_ridePat.RidePatNum}`).data();

                    row2manipulate.date = thisRidePatDate.toLocaleDateString('he-IL');
                    row2manipulate.time = buildTimeHTML(thisRidePatDate, updated_ridePat.RidePatNum);
                    row2manipulate.origin = !isAssistant ? updated_ridePat.Origin.Name : updated_ridePat.Origin.EnglishName;
                    row2manipulate.destination = !isAssistant ? updated_ridePat.Destination.Name : updated_ridePat.Destination.EnglishName;
                    row2manipulate.patient = buildPatientHTML(updated_ridePat);
                    row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers[0], updated_ridePat.RideNum);
                    row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                    row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    //row2manipulate.englishOriginAndDestination = updated_ridePat.Origin.EnglishName + " - " + updated_ridePat.Destination.EnglishName;
                    row2manipulate.remark = buildRemarkHTML(updated_ridePat.Remark, updated_ridePat.RidePatNum);;
                    row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                    tTomorrowAfternoon.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                    increaseCounter(tableNames.TOMORROW_AFTERNOON, updated_ridePat.RidePatNum);

                    tr_nodesAsArray = Array.from(tTomorrowMorning.rows().nodes());
                    break;

                case tableNames.FUTURE:

                    row2manipulate = tFuture.row(`#${updated_ridePat.RidePatNum}`).data();

                    row2manipulate.date = thisRidePatDate.toLocaleDateString('he-IL');
                    row2manipulate.time = buildTimeHTML(thisRidePatDate, updated_ridePat.RidePatNum);
                    row2manipulate.origin = !isAssistant ? updated_ridePat.Origin.Name : updated_ridePat.Origin.EnglishName;
                    row2manipulate.destination = !isAssistant ? updated_ridePat.Destination.Name : updated_ridePat.Destination.EnglishName;
                    row2manipulate.patient = buildPatientHTML(updated_ridePat);
                    row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers[0], updated_ridePat.RideNum);
                    row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                    row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    //row2manipulate.englishOriginAndDestination = updated_ridePat.Origin.EnglishName + " - " + updated_ridePat.Destination.EnglishName;
                    row2manipulate.remark = buildRemarkHTML(updated_ridePat.Remark, updated_ridePat.RidePatNum);;
                    row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                    tFuture.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                    increaseCounter(tableNames.FUTURE, updated_ridePat.RidePatNum);

                    tr_nodesAsArray = Array.from(tFuture.rows().nodes());
                    tr_node2manipulate = tr_nodesAsArray.find(node => node.id === `${updated_ridePat.RidePatNum}`);
                    manipilateNodeStyle(tr_node2manipulate, updated_ridePat, ADD_DRIVER, true);
                    // tr_nodesAsArray = null;
                    break;

                default:
                    console.log('system recognized a tempt of the server to post real-time data but failed to found the rellevant row to redraw');
                    tr_nodesAsArray = null;
                    break;
            }
            if (tr_nodesAsArray) {

                tr_node2manipulate = tr_nodesAsArray.find(node => node.id === `${updated_ridePat.RidePatNum}`);
                manipilateNodeStyle(tr_node2manipulate, updated_ridePat, ADD_DRIVER);

                updatedRidePat_status = updated_ridePat.Pat.RidePatPatientStatus.Status;
                isAfterNoonRide = thisRidePatDate.getMinutes() === afternoonIndicator;
                treatmentFinished = updatedRidePat_status === patientStatus.Finished;

                if (isAfterNoonRide && treatmentFinished) {

                    manipilateNodeStyle(tr_node2manipulate, updated_ridePat, RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED);
                } else if (treatmentFinished && !isAfterNoonRide) {

                    $(tr_node2manipulate).removeClass('highlightRow-after-patientStatusModal');
                }
            }
        }

        notification.client.driverHasRemovedFromRidePat = function (updated_ridePat) {
            /*********************
             * !!! IMPORTANT !!! *
             ********↓↓↓**********/
            //update the specific ride in arr_rides:
            update_arr_rides(updated_ridePat);
            /*********↑↑↑*********
             * !!! IMPORTANT !!! *
             *********************/
            tableName2manipulate = getTableName2Manipulate(updated_ridePat.RidePatNum);
            thisRidePatDate = fixDate_WhichComeFromOpenConnection(updated_ridePat.Date);
            thisRidePatLastModified = fixDate_WhichComeFromOpenConnection(updated_ridePat.LastModified);

            switch (tableName2manipulate) {

                case tableNames.MORNING:

                    row2manipulate = tMorning.row(`#${updated_ridePat.RidePatNum}`).data();

                    row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum);
                    row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                    row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                    tMorning.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                    increaseCounter(tableNames.MORNING, updated_ridePat.RidePatNum);

                    tr_nodesAsArray = Array.from(tMorning.rows().nodes());
                    break;

                case tableNames.AFTERNOON:

                    row2manipulate = tAfternoon.row(`#${updated_ridePat.RidePatNum}`).data();

                    row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum);
                    row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                    row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                    tAfternoon.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                    increaseCounter(tableNames.AFTERNOON, updated_ridePat.RidePatNum);

                    tr_nodesAsArray = Array.from(tAfternoon.rows().nodes());
                    break;

                case tableNames.TOMORROW_MORNING:

                    row2manipulate = tTomorrowMorning.row(`#${updated_ridePat.RidePatNum}`).data();

                    row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum);
                    row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                    row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                    tTomorrowMorning.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                    increaseCounter(tableNames.TOMORROW_MORNING, updated_ridePat.RidePatNum);

                    tr_nodesAsArray = Array.from(tTomorrowMorning.rows().nodes());
                    break;

                case tableNames.TOMORROW_AFTERNOON:

                    row2manipulate = tTomorrowAfternoon.row(`#${updated_ridePat.RidePatNum}`).data();

                    row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum);
                    row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                    row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                    tTomorrowAfternoon.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                    increaseCounter(tableNames.TOMORROW_AFTERNOON, updated_ridePat.RidePatNum);

                    tr_nodesAsArray = Array.from(tTomorrowMorning.rows().nodes());
                    break;



                case tableNames.FUTURE:

                    row2manipulate = tFuture.row(`#${updated_ridePat.RidePatNum}`).data();

                    row2manipulate.driver = buildDriverHTML(updated_ridePat.RidePatNum);
                    row2manipulate.status = buildStatusString(updated_ridePat.Pat.RidePatPatientStatus, updated_ridePat.RidePatNum);
                    row2manipulate.lastModified = thisRidePatLastModified.toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    row2manipulate.buttons = buildAcionsButtonsHTML(updated_ridePat.RidePatNum, updated_ridePat.Drivers);

                    tFuture.row(`#${updated_ridePat.RidePatNum}`).data(row2manipulate).draw('page');
                    increaseCounter(tableNames.FUTURE, updated_ridePat.RidePatNum);

                    tr_nodesAsArray = Array.from(tFuture.rows().nodes());
                    tr_node2manipulate = tr_nodesAsArray.find(node => node.id === `${updated_ridePat.RidePatNum}`);
                    manipilateNodeStyle(tr_node2manipulate, updated_ridePat, REMOVE_DRIVER, true, tableName2manipulate);
                    //tr_nodesAsArray = null;
                    break;

                default:

                    console.log('system recognized a tempt of the server to post real-time data but failed to found the rellevant row to redraw');
                    tr_nodesAsArray = null;
                    break;
            }

            if (tr_nodesAsArray) {

                tr_node2manipulate = tr_nodesAsArray.find(node => node.id === `${updated_ridePat.RidePatNum}`);
                manipilateNodeStyle(tr_node2manipulate, updated_ridePat, REMOVE_DRIVER, false, tableName2manipulate);

                updatedRidePat_status = updated_ridePat.Pat.RidePatPatientStatus.Status;
                treatmentFinished = updatedRidePat_status === patientStatus.Finished;

                if (treatmentFinished) {

                    manipilateNodeStyle(tr_node2manipulate, updated_ridePat, RIDEPAT_PATIENT_STATUS_EDITTIME_CHANGED);
                } else {

                    $(tr_node2manipulate).removeClass('highlightRow-after-patientStatusModal');
                }

            }
        }

        //#endregion

    </script>

    <!-- #endregion REAL-TIME BY SIGNALR - FOR ANY COMPLAINTS WHATSOEVER YOU CAN TALK 2 YOGEV -->
    <!-- Sweet Alert css -->
    <link href="../plugins/bootstrap-sweetalert/sweet-alert.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/switchery/switchery.min.css" rel="stylesheet" />
    <link href="assets/css/bootstrap-rtl.min.css" rel="stylesheet" type="text/css">
    <link href="assets/css/core.css" rel="stylesheet" type="text/css">
    <link href="assets/css/icons.css" rel="stylesheet" type="text/css">
    <link href="assets/css/components.css" rel="stylesheet" type="text/css">
    <link href="assets/css/pages.css" rel="stylesheet" type="text/css">
    <link href="assets/css/menu.css" rel="stylesheet" type="text/css">
    <link href="assets/css/responsive.css" rel="stylesheet" type="text/css">

    <script src="assets/js/CookiesFunctions.js"></script>

    <script src="assets/js/modernizr.min.js"></script>


    <!-- Data Table export to excel module -->
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

    <script src="assets/js/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.6.1/jszip.min.js" integrity="sha512-qDzk+Wqv8uAmrIr0t9Hjo4qM3DjvwTWuuuG3w9H8JBKd1EMpMaUEKoHKYbX6yP+ilTloEADFKFwKMzOZLlgTEg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.6.1/jszip.min.js"
            integrity="sha512-qDzk+Wqv8uAmrIr0t9Hjo4qM3DjvwTWuuuG3w9H8JBKd1EMpMaUEKoHKYbX6yP+ilTloEADFKFwKMzOZLlgTEg=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.print.min.js"></script>

    <!--<script src="datetime-moment.js"></script>-->
    <!--<script src="./moment.js"></script>-->
    <!-- Select2 css+js -->
    <!--<link href="assets/css/select2.css" rel="stylesheet" />
    <script src="assets/js/select2.min.js"></script>-->
    <!-- jQuery  -->
    <script src="assets/js/bootstrap-rtl.min.js"></script>
    <script src="assets/js/detect.js"></script>
    <script src="assets/js/fastclick.js"></script>
    <script src="assets/js/jquery.slimscroll.js"></script>
    <script src="assets/js/jquery.blockUI.js"></script>
    <script src="assets/js/waves.js"></script>
    <script src="assets/js/wow.min.js"></script>
    <script src="assets/js/jquery.nicescroll.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="../plugins/switchery/switchery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="assets/js/jquery.core.js"></script>
    <script src="assets/js/jquery.app.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- DataTables -->
    <link href="../plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/datatables/buttons.bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/datatables/fixedHeader.bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/datatables/responsive.bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/datatables/scroller.bootstrap.min.css" rel="stylesheet" type="text/css" />

    <!-- Datatables-->
    <!--<script src="moment.js"></script>-->
    <script src="dataTables.js"></script>
    <script src="../plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="../plugins/datatables/dataTables.bootstrap.js"></script>
    <script src="../plugins/datatables/dataTables.buttons.min.js"></script>
    <script src="../plugins/datatables/buttons.bootstrap.min.js"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"
            integrity="sha512-xcHCGC5tQ0SHlRX8Anbz6oy/OullASJkEhb4gjkneVpGE3/QGYejf14CUO5n5q5paiHfRFTa9HKgByxzidw2Bw=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->
    <!--<script src="../plugins/datatables/pdfmake.min.js"></script>-->
    <script src="../plugins/datatables/vfs_fonts.js"></script>
    <script src="../plugins/datatables/buttons.html5.min.js"></script>
    <script src="../plugins/datatables/buttons.print.min.js"></script>
    <script src="../plugins/datatables/dataTables.fixedHeader.min.js"></script>
    <script src="../plugins/datatables/dataTables.keyTable.min.js"></script>
    <script src="../plugins/datatables/dataTables.responsive.min.js"></script>
    <script src="../plugins/datatables/responsive.bootstrap.min.js"></script>
    <script src="../plugins/datatables/dataTables.scroller.min.js"></script>


    <!-- Datatable init js -->
    <script src="assets/pages/datatables.init.js"></script>

    <!-- Sweet Alert js -->
    <script src="../plugins/bootstrap-sweetalert/sweet-alert.min.js"></script>
    <script src="assets/pages/jquery.sweet-alert.init.js"></script>



    <!--<script src="lib/sorting.js"></script>-->
    <script src="lib/includeHTML.js"></script>

    <script>
        /*
        NOTICE THIS:
        אחה"צ
        calculation   wise: its value is 12:00 (like when we calaulate hours gap between the present and a given ridepat)
        table sorting wise: its value is Infinity or negetive Infinity
        */
        checkCookie();
        var destinationName = "";
        var originName = "";
        var driverName = "";
        var patientName = "";
        var Origin_Dest = "";
        var isAnonymous = false;
        var isAssistant = false;
        var refreshTime;
        var refreshInterval;
        var tomorrowDate = new Date()
        tomorrowDate.setDate(tomorrowDate.getDate() + 1)
        var hospitals = [];
        var returnRidePat;
        var returnRidePatMsg = ""
        var dateReturn;
        var returnDriverMsg;

        let arrayOF_areasObj = [];
        let morningRidePats = [];
        let afterNoonRidePats = [];
        let tomorrowMorningRidePats = [];
        let tomorrowAfternoonRidePats = [];
        let futureRidePats = [];
        let allReadyCountedRidePats = [];
        let candidate4IhaveSeen;
        let timer;
        let arr_rides;

        const {

            validateMobileNumFullVersion,
            addSeperator2MobileNum,
            convertDBDate2FrontEndDate,
            getHoursGap,
            convert2DBDateToInt,
            getHebrew_WeekDay,
            showMe,
            dateCompareFunc,
            datetimeCompareFunc,
            isDate,
            IsNullOrUndefined

        } = GENERAL.USEFULL_FUNCTIONS;

        const { GetPatientGender, GetPatientStatus } = GENERAL.PATIENTS;

        const { ajaxCall } = GENERAL.FETCH_DATA;
        const { APP_ID } = GENERAL;

        const newVolunteerText = `מתנדב חדש`;
        //   const noDriver = { hebrew: 'אין', english: 'None!' };

        const controllersLayout = "<'row top'<'col-sm-6'l><'col-sm-5'f><'col-sm-1'B>>rt<'bottom'pi>";//https://datatables.net/reference/option/dom
        const controllersLayoutForFutureTable = "<'row top'<'col-sm-2'l><'#future-table-time-interval-container.col-sm-4'><'col-sm-5'f><'col-sm-1'B>>rt<'bottom'pi>";
        let drivers, driverNames;
        let _ridepatToManipulate;
        let _assignDriverToRideNum;
        let _isDriverReplacement;
        let _trToHighLight;
        let _driverId;

        let tMorning, tAfternoon, tTomorrowMorning, tTomorrowAfternoon, tFuture;


        function wiringDataTables() {
            //manage button clicks on tables

            //#region remove ridepat
            $(`#${tableNames.MORNING} tbody`).on('click', '.remove', function () {
                confirmDelete(this, tMorning);
            });

            $(`#${tableNames.AFTERNOON} tbody`).on('click', '.remove', function () {
                confirmDelete(this, tAfternoon);
            });

            $(`#${tableNames.TOMORROW_MORNING} tbody`).on('click', '.remove', function () {
                confirmDelete(this, tTomorrowMorning);
            });

            $(`#${tableNames.TOMORROW_AFTERNOON} tbody`).on('click', '.remove', function () {
                confirmDelete(this, tTomorrowAfternoon);
            });

            $(`#${tableNames.FUTURE} tbody`).on('click', '.remove', function () {
                confirmDelete(this, tFuture);
            });
            //#endregion

            //#region edit ridepat
            $(`#${tableNames.MORNING} tbody`).on('click', '.edit', function () {
                editButton(this);
            });

            $(`#${tableNames.AFTERNOON} tbody`).on('click', '.edit', function () {
                editButton(this);
            });


            $(`#${tableNames.TOMORROW_MORNING} tbody`).on('click', '.edit', function () {
                editButton(this);
            });


            $(`#${tableNames.TOMORROW_AFTERNOON} tbody`).on('click', '.edit', function () {
                editButton(this);
            });

            $(`#${tableNames.FUTURE} tbody`).on('click', '.edit', function () {
                editButton(this);
            });
            //#endregion

            //#region copyMessage ridepat
            $(`#${tableNames.MORNING} tbody`).on('click', '.copyMessage', function () {
                copyMessageButton(this, tMorning);
            });

            $(`#${tableNames.AFTERNOON} tbody`).on('click', '.copyMessage', function () {
                copyMessageButton(this, tAfternoon);
            });


            $(`#${tableNames.TOMORROW_MORNING} tbody`).on('click', '.copyMessage', function () {
                copyMessageButton(this, tTomorrowMorning);
            });

            $(`#${tableNames.TOMORROW_AFTERNOON} tbody`).on('click', '.copyMessage', function () {
                copyMessageButton(this, tTomorrowAfternoon);
            });

            $(`#${tableNames.FUTURE} tbody`).on('click', '.copyMessage', function () {
                copyMessageButton(this, tFuture);
            });
            //#endregion

            //#region show target form
            /*
             IMPORTANT NOTE
             the event is mouseup in order to catch all scenarios.
             */
            $(`#${tableNames.MORNING} tbody`).on('mouseup', '.showMe', function () {
                let targetObj = {};
                targetObj.objName = $(this).attr("data-obj");
                targetObj.displayName = this.text;

                showMe(targetObj);
            });

            $(`#${tableNames.AFTERNOON} tbody`).on('mouseup', '.showMe', function () {
                let targetObj = {};
                targetObj.objName = $(this).attr("data-obj");
                targetObj.displayName = this.text;

                showMe(targetObj);
            });

            $(`#${tableNames.TOMORROW_MORNING} tbody`).on('mouseup', '.showMe', function () {
                let targetObj = {};
                targetObj.objName = $(this).attr("data-obj");
                targetObj.displayName = this.text;

                showMe(targetObj);
            });

            $(`#${tableNames.TOMORROW_AFTERNOON} tbody`).on('mouseup', '.showMe', function () {

                let targetObj = {};
                targetObj.objName = $(this).attr("data-obj");
                targetObj.displayName = this.text;

                showMe(targetObj);

            });

            $(`#${tableNames.FUTURE} tbody`).on('mouseup', '.showMe', function () {

                let targetObj = {};
                targetObj.objName = $(this).attr("data-obj");
                targetObj.displayName = this.text;

                showMe(targetObj);

            });
            //#endregion

            //#region ContextMenu_dropdown
            $(`#${tableNames.MORNING} tbody`).on('mousedown', '.within2HoursSinceChange', function (e) {

                timer = setTimeout(function () {

                    candidate4IhaveSeen = e.target.parentElement.id;
                    $('.ContextMenu_dropdown').removeClass('hidden');
                    $(".ContextMenu_dropdown").css({ position: "absolute", top: e.pageY, left: e.pageX });
                }, 500);
            }).on("mouseup mouseleave", function () {
                clearTimeout(timer);
            }).on("click", function () {//click on the td...
                $('.ContextMenu_dropdown').addClass('hidden');
            });

            $(`#${tableNames.AFTERNOON} tbody`).on('mousedown', '.within2HoursSinceChange', function (e) {

                timer = setTimeout(function () {

                    candidate4IhaveSeen = e.target.parentElement.id;
                    $('.ContextMenu_dropdown').removeClass('hidden');
                    $(".ContextMenu_dropdown").css({ position: "absolute", top: e.pageY, left: e.pageX });
                }, 500);
            }).on("mouseup mouseleave", function () {
                clearTimeout(timer);
            }).on("click", function () {//click on the td...
                $('.ContextMenu_dropdown').addClass('hidden');
            });

            $(`#${tableNames.TOMORROW_MORNING} tbody`).on('mousedown', '.within2HoursSinceChange', function (e) {

                timer = setTimeout(function () {

                    candidate4IhaveSeen = e.target.parentElement.id;
                    $('.ContextMenu_dropdown').removeClass('hidden');
                    $(".ContextMenu_dropdown").css({ position: "absolute", top: e.pageY, left: e.pageX });
                }, 500);
            }).on("mouseup mouseleave", function () {
                clearTimeout(timer);
            }).on("click", function () {//click on the td...
                $('.ContextMenu_dropdown').addClass('hidden');
            });

            $(`#${tableNames.TOMORROW_AFTERNOON} tbody`).on('mousedown', '.within2HoursSinceChange', function (e) {

                timer = setTimeout(function () {

                    candidate4IhaveSeen = e.target.parentElement.id;
                    $('.ContextMenu_dropdown').removeClass('hidden');
                    $(".ContextMenu_dropdown").css({ position: "absolute", top: e.pageY, left: e.pageX });
                }, 500);
            }).on("mouseup mouseleave", function () {
                clearTimeout(timer);
            }).on("click", function () {//click on the td...
                $('.ContextMenu_dropdown').addClass('hidden');
            });


            $(`#${tableNames.FUTURE} tbody`).on('mousedown', '.within2HoursSinceChange', function (e) {

                timer = setTimeout(function () {

                    candidate4IhaveSeen = e.target.parentElement.id;
                   // console.log(e);
                    $('.ContextMenu_dropdown').removeClass('hidden');
                    $(".ContextMenu_dropdown").css({ position: "absolute", top: e.pageY, left: e.pageX });
                }, 500);
            }).on("mouseup mouseleave", function () {
                clearTimeout(timer);
            }).on("click", function () {//click on the td...
                $('.ContextMenu_dropdown').addClass('hidden');
            });

            //#endregion

            //#region candidatesButton
            $(`#${tableNames.MORNING} tbody`).on('click', '.candidatesBtn', function () {
                candidatesButton(this);
            });

            $(`#${tableNames.AFTERNOON} tbody`).on('click', '.candidatesBtn', function () {
                candidatesButton(this);
            });

            $(`#${tableNames.TOMORROW_MORNING} tbody`).on('click', '.candidatesBtn', function () {
                candidatesButton(this);
            });

            $(`#${tableNames.TOMORROW_AFTERNOON} tbody`).on('click', '.candidatesBtn', function () {
                candidatesButton(this);
            });

            $(`#${tableNames.FUTURE} tbody`).on('click', '.candidatesBtn', function () {
                candidatesButton(this);
            });
            //#endregion

        }

        function getDrivers() {

            const driversPromise = new Promise((resolve, reject) => {

                const getDrivers_SCB = (data) => {
                    drivers = JSON.parse(data.d);
                    driverNames = drivers.map(d => d.DisplayName);

                    return resolve(driverNames);
                }

                const getDrivers_ECB = (err) => {
                    alert('Issue in getDrivers ' + JSON.stringify(err));

                    return reject(err);
                }
                ajaxCall('GetDrivers', JSON.stringify({ isActive: true, isDriving: true }), getDrivers_SCB, getDrivers_ECB);
            });

            return driversPromise;
        }


        const assignOrUpdateAPIcall = (unityRideID, DriverId) => {
            const request = {
                UnityRideId: unityRideID,
                DriverId: DriverId,
                isDelete: false
            }
            ajaxCall('AssignUpdateDriverToUnityRide', JSON.stringify(request), assignDriverToRidePat_SCB, assignDriverToRidePat_ECB);

        }

        const assignDriverToRidePat = () => {
            $('#wait').show();
            const driverNameFromInput = $('#driver').val();

            if (typeof driverNameFromInput === 'undefined' || !driverNameFromInput || driverNameFromInput.length === 0 || !driverNames.includes(driverNameFromInput)) {

                $('#wait').hide();
                return alert('יש לבחור נהג מתוך הרשימה');
            }
            const driverIndex = driverNames.indexOf(driverNameFromInput);
            const userSelected = drivers[driverIndex];
            let request;
            let dataString;


            $.ajax({
                dataType: "json",
                url: "WebService.asmx/GetAbsenceByVolunteerId",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({ volunteerId: userSelected.Id }),
                success: function (data) {
                    $('#wait').hide();
                    Absences = JSON.parse(data.d);
                    let absenceStatus = false;
                    //console.log('Gilad check -- > ', Absences)
                    for (var i = 0; i < Absences.length; i++) {
                        if (Absences[i].AbsenceStatus) {
                            absenceStatus = true;
                        }
                    }
                    if (absenceStatus) {
                        swal({
                            title: "?האם הינך בטוח/ה שברצונך לשבץ נהג זה",
                            type: "warning",
                            text: 'נהג זה כרגע אינו זמין,באפשרותך לשבץ אותו בכל זאת או לבחור בנהג חלופי',
                            showCancelButton: true,
                            cancelButtonText: "בטל",
                            confirmButtonClass: 'btn-warning',
                            confirmButtonText: "שבץ",
                            closeOnConfirm: true
                        }, function (userResponse) {
                            if (userResponse) {
                                assignOrUpdateAPIcall(_ridepatToManipulate, userSelected.Id);
                                setTimeout(() => {
                                    colorRowWithDriver([_ridepatToManipulate]);

                                },750)
                                assignDriverToRidePatAbort();

                            }

                        });
                    }
                    else {
                        assignOrUpdateAPIcall(_ridepatToManipulate, userSelected.Id);
                        setTimeout(() => {
                            colorRowWithDriver([_ridepatToManipulate]);

                        }, 750)
                        assignDriverToRidePatAbort();

                    }

                },
                error: function (err) {
                    alert("Error in GetVolunteersAbsences (manageridepat.html ajax) !: " + err.responseText);
                    $('#wait').hide();
                }
            });




        }

        const assignDriverToRidePatAbort = () => {
            removeClass('highlightRow');
        }

        const editPatientStatusAbort = () => {
            removeClass('highlightRow');
        }

        //New Api because the unity Gilad
        const updateUnityridePatientStatus = () => {
            $('#wait').show();
            removeClass('highlightRow');
            const hours = $("#editPatientStatusModalHours").val();
            const minutes = $("#editPatientStatusModalMinutes").val();
            const isTreatmentFinished = !$("#editPatientStatusNotFinishedCB").is(':checked');

            if (
                isNaN(hours) || isNaN(minutes) ||
                hours === null || minutes === null
            ) {
                $('#wait').hide();
                return alert('נא לבחור שעה מהרשימות הנגללות או לבטל את הפעולה');
            }

            let ridepatToManipulate = arr_rides.find(r => r.RidePatNum === _ridepatToManipulate);
            const now = new Date();
            const editTimeStamp = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);

            ridepatToManipulate = CustomRideObject(ridepatToManipulate);
            ridepatToManipulate.Pat.RidePatPatientStatus.Status = isTreatmentFinished;
            ridepatToManipulate.Pat.RidePatPatientStatus.EditTimeStamp = editTimeStamp;

            //update_arr_rides(ridepatToManipulate);
            
            const data = {
                patientId: ridepatToManipulate.Pat.Id,
                unityRideID: ridepatToManipulate.RidePatNum,
                patientStatus: isTreatmentFinished ? "Finished" : "Not Finished",
                editTimeStamp: editTimeStamp
            }
            //console.log('check it --', data)

            const updatePatientStatus_SCB = () => {

                $('#wait').hide();
                $('#editPatientStatusModal').modal('hide');
            }

            const updatePatientStatus_ECB = (err) => {

                $('#wait').hide();
                $('#editPatientStatusModal').modal('hide');
                console.log(err);
                alert(err);
            }

            //console.log('Gilad check the data send -->', data);
            ajaxCall('UpdatePatientStatus_UnityRide', JSON.stringify(data), updatePatientStatus_SCB, updatePatientStatus_ECB);
        }


        const updateRidePatPatientStatus = () => {

            $('#wait').show();
            removeClass('highlightRow');
            const hours = $("#editPatientStatusModalHours").val();
            const minutes = $("#editPatientStatusModalMinutes").val();
            const isTreatmentFinished = !$("#editPatientStatusNotFinishedCB").is(':checked');

            if (
                isNaN(hours) || isNaN(minutes) ||
                hours === null || minutes === null
            ) {
                $('#wait').hide();
                return alert('נא לבחור שעה מהרשימות הנגללות או לבטל את הפעולה');
            }

            let ridepatToManipulate = arr_rides.find(r => r.RidePatNum === _ridepatToManipulate);
            const now = new Date();

            const editTimeStamp = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);
            ridepatToManipulate = CustomRideObject(ridepatToManipulate);
            ridepatToManipulate.Pat.RidePatPatientStatus.Status = isTreatmentFinished;
            ridepatToManipulate.Pat.RidePatPatientStatus.EditTimeStamp = editTimeStamp;
            update_arr_rides(ridepatToManipulate);

            const data = {
                patientId: ridepatToManipulate.Pat.Id,
                ridePatId: ridepatToManipulate.RidePatNum,
                patientStatus: isTreatmentFinished ? "Finished" : "Not Finished",
                editTimeStamp: editTimeStamp
            }

            const updatePatientStatus_SCB = () => {

                $('#wait').hide();
                $('#editPatientStatusModal').modal('hide');
            }

            const updatePatientStatus_ECB = (err) => {

                $('#wait').hide();
                $('#editPatientStatusModal').modal('hide');
                console.log(err);
                alert(err);
            }

            //console.log('Gilad check the data send -->', data);
            ajaxCall('UpdatePatientStatus', JSON.stringify(data), updatePatientStatus_SCB, updatePatientStatus_ECB);


        }

        //Gilad change here the date to PickupTime
        const updateRidePatTime = () => {

            $('#wait').show();
            let hours, minutes = null;
            const isAfterNoon = $("#editTimeAfterNoonCB").is(':checked');

            if (isAfterNoon) {
                hours = 22;
                minutes = 14;
            } else {
                hours = $("#hours").val();
                minutes = $("#minutes").val();
            }
            if (
                isNaN(hours) || isNaN(minutes) ||
                hours === null || minutes === null
            ) {
                $('#wait').hide();
                return alert('נא לבחור שעה מהרשימות הנגללות או אחה"צ');
            }

            let ridepatToManipulate = arr_rides.find(r => r.RidePatNum === _ridepatToManipulate);
            let dateToManipulate = convertDBDate2FrontEndDate(ridepatToManipulate.PickupTime);
            dateToManipulate.setHours(hours, minutes);

            let data = {
                ridePatId: _ridepatToManipulate,
                dateTime: dateToManipulate
            };

            const updateRidePatTime_SCB = () => {

                $('#wait').hide();
                removeClass('highlightRow');
                //the timeout is because the render take time and we want to update the color in real time. by gilad.
                setTimeout(colorRowWithDriver, 750, [_ridepatToManipulate])
                //colorRowWithDriver([_ridepatToManipulate]);

                $('#editTimeModal').modal('hide');
            }

            const updateRidePatTime_ECB = (err) => {

                $('#wait').hide();
                removeClass('highlightRow');
                $('#editTimeModal').modal('hide');
                alert(err);
            }

            //console.log('From updateRidePatTime func--> send this-->', data);

            ajaxCall('UpdateRidePatTime', JSON.stringify(data), updateRidePatTime_SCB, updateRidePatTime_ECB);

        }

        //new Api
        const updateUnityRideTime = () => {

            $('#wait').show();
            let hours, minutes = null;
            const isAfterNoon = $("#editTimeAfterNoonCB").is(':checked');

            if (isAfterNoon) {
                hours = 22;
                minutes = 14;
            } else {
                hours = $("#hours").val();
                minutes = $("#minutes").val();
            }
            if (
                isNaN(hours) || isNaN(minutes) ||
                hours === null || minutes === null
            ) {
                $('#wait').hide();
                return alert('נא לבחור שעה מהרשימות הנגללות או אחה"צ');
            }

            let ridepatToManipulate = arr_rides.find(r => r.RidePatNum === _ridepatToManipulate);
            let dateToManipulate = convertDBDate2FrontEndDate(ridepatToManipulate.PickupTime);
            dateToManipulate.setHours(hours, minutes);

            let data = {
                unityRideId: _ridepatToManipulate,
                pickupTime: dateToManipulate
            };

            const updateUnityRideTime_SCB = () => {

                $('#wait').hide();
                removeClass('highlightRow');
                //the timeout is because the render take time and we want to update the color in real time. by gilad.
                setTimeout(colorRowWithDriver, 750, [_ridepatToManipulate])
                //colorRowWithDriver([_ridepatToManipulate]);

                $('#editTimeModal').modal('hide');
            }

            const updateUnityRideTime_ECB = (err) => {

                $('#wait').hide();
                removeClass('highlightRow');
                $('#editTimeModal').modal('hide');
                alert(err);
            }

            //console.log('From NEW updateUnityRideTime NEW func--> send this-->', data);

            ajaxCall('UpdateUnityRideTime', JSON.stringify(data), updateUnityRideTime_SCB, updateUnityRideTime_ECB);

        }


        //new API to update remark by Gilad
        const updateRemark_UnityRide = () => {
            $('#wait').show();
            let ridepatToManipulate = arr_rides.find(r => r.RidePatNum === _ridepatToManipulate);
            let newRemark = $('#editRemarkTextEditor').val();

            newRemark = newRemark.replace(/\n/g, "<br>");

            let data = {
                UnityRideID: _ridepatToManipulate,
                newRemark
            };
            //console.log('Gilad check -->', data);
            const updateRemark_SCB = () => {

                $('#wait').hide();
                removeClass('highlightRow');
                $('#editRemarkModal').modal('hide');
            }

            const updateRemark_ECB = (err) => {

                $('#wait').hide();
                removeClass('highlightRow');
                $('#editRemarkModal').modal('hide');
                alert(err);
            }

            ajaxCall('UpdateUnityRideRemark', JSON.stringify(data), updateRemark_SCB, updateRemark_ECB);
        }

        const updateRemark = () => {

            $('#wait').show();
            let ridepatToManipulate = arr_rides.find(r => r.RidePatNum === _ridepatToManipulate);
            let newRemark = $('#editRemarkTextEditor').val();

            newRemark = newRemark.replace(/\n/g, "<br>");

            let data = {
                ridePatId: _ridepatToManipulate,
                newRemark
            };

            const updateRemark_SCB = () => {

                $('#wait').hide();
                removeClass('highlightRow');
                $('#editRemarkModal').modal('hide');
            }

            const updateRemark_ECB = (err) => {

                $('#wait').hide();
                removeClass('highlightRow');
                $('#editRemarkModal').modal('hide');
                alert(err);
            }

            ajaxCall('UpdateRidePatRemark', JSON.stringify(data), updateRemark_SCB, updateRemark_ECB);

        }

        const editTimeAbort = () => {
            removeClass('highlightRow');
        }

        const editRemarkAbort = () => {
            removeClass('highlightRow');
        }

        const removeClass = (className) => {
            _trToHighLight.classList.remove(className);
        }

        const assignDriverToRidePat_SCB = (data) => {
            //console.log('what data ? ', data);
            $('#wait').hide();
            removeClass('highlightRow');
            $('#assignDriverModal').modal('hide');
        }

        const assignDriverToRidePat_ECB = (err) => {
            $('#wait').hide();
            assignDriverToRidePat('highlightRow');
            alert('Issue in assignDriverToRidePat: ' + JSON.stringify(err));
        }

        const UpdateDriver_SCB = (data) => {
            $('#wait').hide();
            _trToHighLight.classList.remove('highlightRow');
            $('#assignDriverModal').modal('hide');
        }

        const UpdateDriver_ECB = (err) => {
            $('#wait').hide();
            _trToHighLight.classList.remove('highlightRow');
            alert('Issue in UpdateDriver: ' + JSON.stringify(err));
        }

        const deleteDriverFromRide = () => {

            swal({
                title: "האם אתה בטוח שאתה רוצה למחוק את הנהג מההסעה?",
                type: "warning",
                text: 'בלחיצה על מחיקה הנהג יוסר מהסעה זו',
                showCancelButton: true,
                cancelButtonText: "בטל",
                confirmButtonClass: 'btn-warning',
                confirmButtonText: "מחיקה",
                closeOnConfirm: true
            }, function (userResponse) {
                if (userResponse) {
                    $('#wait').show();

                    const request = {
                        UnityRideId: _ridepatToManipulate,
                        DriverId: _driverId,
                        isDelete: true

                    }
                    $(`#${_ridepatToManipulate}`).removeClass('statusComplete');
                    const dataString = JSON.stringify(request);
                    ajaxCall('AssignUpdateDriverToUnityRide', dataString, deleteRideSuccessCB, deleteRideErrorCB);

                }

            });




        }

        const deleteRideSuccessCB = (data) => {
            $('#wait').hide();
            $('#assignDriverModal').modal('hide');
            //let td = document.getElementById(_ridepatToManipulate).getElementsByClassName('driver_td')[0]
            //td.classList.add('withIn12HoursDrive')
            let tr = document.getElementById(_ridepatToManipulate)
            tr_node2manipulate = tr;
            manipilateNodeStyle(tr_node2manipulate, _ridepatToManipulate, REMOVE_DRIVER, false, tableName2manipulate);

            assignDriverToRidePatAbort();
        }

        const deleteRideErrorCB = (err) => {

            $('#wait').hide();
            $('#assignDriverModal').modal('hide');
            assignDriverToRidePatAbort();
            alert(err);
        }

        $(document).ready(function () {

            $("#assignDriverModal").attr("w3-include-html", "assignDriverModal.html");
            $('#assignDriverModal').on('shown.bs.modal', bsModalHasShown); // triger cb function only after modal is shown
            $('#editRemarkModal').on('shown.bs.modal', editRemarkModalHasShown); // triger cb function only after modal is shown


            $("#editTimeModal").attr("w3-include-html", "editTimeModal.html");
            $("#editPatientStatusModal").attr("w3-include-html", "editPatientStatusModal.html");
            $("#editRemarkModal").attr("w3-include-html", "editRemarkModal.html");
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getHospitalView",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                //  async: false,
                data: JSON.stringify({ active: true }),
                success: function (data) {
                    arr_hospitals = JSON.parse(data.d);
                    for (i in arr_hospitals) {
                        hospitals.push(arr_hospitals[i].Name)
                    }
                },
                error: function (err) { alert("Error in getHospitalView: " + err.responseText); }
            });


            wiringDataTables();
            const { COPYWRITE } = GENERAL;
            $('#rights').html(COPYWRITE());

            if (localStorage.refreshTime == "undefined" || localStorage.refreshTime === undefined) { // Set the deafult refresh rate for 5 minutes
                localStorage.refreshTime = '300000';
                $('#refreshTime').val('300000')
            } else {
                $('#refreshTime').val(parseInt(JSON.parse(localStorage.refreshTime)));
            }
            refreshTime = parseInt(JSON.parse(localStorage.refreshTime));

            $('#refreshTime').on('change', function () {

                localStorage.refreshTime = String(this.value);
                refreshTime = parseInt(JSON.parse(localStorage.refreshTime));
                clearInterval(refreshInterval);
                refreshInterval = setInterval("refreshTable_UnityRide()", refreshTime);

            });

            if (!JSON.parse(localStorage.getItem("isProductionDatabase"))) {
                $("#databaseType").text("Test database ")
            }
            else $("#databaseType").text("Production database")
            $('[data-toggle="tooltip"]').tooltip({
                container: 'body'
            })
            if (window.location.hostname.toString() == 'localhost' || window.location.pathname.toLowerCase().indexOf('test') != -1) {
                $("#na").css("background-color", "#ffde89");
            }
            if (window.location.href.indexOf('http://40.117.122.242/Road%20to%20Recovery/') != -1) {
                window.location.href = "notAvailable.html";
            }
            isAssistant = JSON.parse(GENERAL.USER.getIsAssistant());

            var assistantName = "";
            if (isAssistant) {
                $("#menuType").attr("w3-include-html", "HelperMenu.html");
                var coorAssistant = GENERAL.USER.getCoorAssistant();
                assistantName = GENERAL.USER.getAsistantDisplayName();
            }
            else $("#menuType").attr("w3-include-html", "menu.html");
            includeHTML();
            if (isAssistant) {
                var userName = GENERAL.USER.getAsistantAndCoorDisplayName();
                $("#userName").html(userName);
            }
            else {
                var userName = GENERAL.USER.getUserDisplayName();
                $("#userName").html(userName);
            }


            deceideWhichTable2Show();

            jQuery.extend(jQuery.fn.dataTableExt.oSort, {

                "de_time-asc": function (a, b) {
                    /*a and b are a couple of times hh:mm to compare
                    return value will be:
                    0 if a=b
                    1 if a > b
                   -1 if a < b
                    */

                    a = $(a)[0].querySelector('.time').innerHTML;
                    b = $(b)[0].querySelector('.time').innerHTML;

                    let datetime_a = $.trim(a).split(':');
                    let datetime_b = $.trim(b).split(':');
                    let hh_a = parseInt(datetime_a[0]);
                    let mm_a = parseInt(datetime_a[1]);

                    let hh_b = parseInt(datetime_b[0]);
                    let mm_b = parseInt(datetime_b[1]);

                    let now = new Date();

                    let a_dateTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hh_a, mm_a);
                    let b_dateTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hh_b, mm_b);

                    a = a_dateTime.getTime();
                    b = b_dateTime.getTime();

                    if (isNaN(a)) { //this is for אחה"צ
                        a = Infinity;
                    }
                    if (isNaN(b)) {
                        b = Infinity;
                    }

                    return a === b ? 0 : a > b ? 1 : -1;

                },

                "de_time-desc": function (a, b) {
                    /*a and b are a couple of times hh:mm to  compare
                      return value will be:
                      0 if a=b
                     -1 if a > b
                      1 if a < b
                      */
                    a = $(a)[0].querySelector('.time').innerHTML;
                    b = $(b)[0].querySelector('.time').innerHTML;

                    let datetime_a = $.trim(a).split(':');
                    let datetime_b = $.trim(b).split(':');

                    let hh_a = parseInt(datetime_a[0]);
                    let mm_a = parseInt(datetime_a[1]);

                    let hh_b = parseInt(datetime_b[0]);
                    let mm_b = parseInt(datetime_b[1]);

                    let now = new Date();

                    let a_dateTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hh_a, mm_a)
                    let b_dateTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hh_b, mm_b)

                    a = a_dateTime.getTime();
                    b = b_dateTime.getTime();

                    if (isNaN(a)) {//this is for אחה"צ
                        a = Infinity;
                    }
                    if (isNaN(b)) {
                        b = Infinity;
                    }

                    return a === b ? 0 : a > b ? -1 : 1;
                },

                "de_date-asc": (a, b) => {

                    return dateCompareFunc(a, b, true);

                },

                "de_date-desc": (a, b) => {

                    return dateCompareFunc(a, b, false);
                },

                "last_modifiedSort-asc": (a, b) => {

                    return datetimeCompareFunc(a, b, true);

                },

                "last_modifiedSort-desc": (a, b) => {

                    return datetimeCompareFunc(a, b, false);

                },
            });

            getCoors();

            let timeInt = _timeinterval_G == 'חודש' ? 30 : _timeinterval_G == 'שבועיים' ? 14 : 7
            refreshTable_UnityRide(timeInt);
            //refreshTable()

            if (!isAssistant) {

                refreshInterval = setInterval("refreshTable_UnityRide()", refreshTime);
            }

            let allSortsSwitch = true;
            if (localStorage.getItem('allSortsSwitch') != null)
                allSortsSwitch = JSON.parse(localStorage.getItem('allSortsSwitch'));

            if (allSortsSwitch) {
                $('#allSortsSwitch').prop('checked', true);
                $('#openSortsControllers').prop('disabled', false);
                $('#allSortsLabel').html('כבה סינון');
            } else {
                $('#allSortsSwitch').prop('checked', false);
                $('#openSortsControllers').prop('disabled', true);
                $('#allSortsLabel').html('הפעל סינון');
            }



        });

        const assignTable2lastOne = (tableName) => {

            localStorage.setItem('lastTableWas', tableName);
        }

        const deceideWhichTable2Show = () => {
            /*
             #collapse1 = datatable-morning
             #collapse2 = datatable-afternoon
             #collapse3 = datatable-tomorrow-morning
             #collapse4 = ddatatable-tomorrow-afternoon
             #collapse5 = datatable-future
             */

            let table2open = localStorage.getItem('lastTableWas') ? localStorage.getItem('lastTableWas') : '';

            switch (table2open) {

                case tableNames.MORNING:
                    $('#collapse1').addClass("in");
                    $('#collapsed1_aTag').removeClass('collapsed');
                    break;

                case tableNames.AFTERNOON:
                    $('#collapse2').addClass("in");
                    $('#collapsed2_aTag').removeClass('collapsed');
                    break;

                case tableNames.TOMORROW_MORNING:
                    $('#collapse3').addClass("in");
                    $('#collapsed3_aTag').removeClass('collapsed');
                    break;

                case tableNames.TOMORROW_AFTERNOON:
                    $('#collapse4').addClass("in");
                    $('#collapse4_aTag').removeClass('collapsed');
                    break;

                case tableNames.FUTURE:
                    $('#collapse5').addClass("in");
                    $('#collapse5_aTag').removeClass('collapsed');
                    break;

                default:
                    setTable2Show_Bytime();
                    break;

            }

        }

        const setTable2Show_Bytime = () => {

            let now = new Date();

            if (parseInt(now.getHours()) <= 12) {//show the morning table

                $('#collapse1').addClass("in");
            } else {//show the afternoon table

                $('#collapse2').addClass("in");
            }


        }

        function getCoors() {
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getCoorList",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                async: false,
                //data: JSON.stringify({}),
                success: getCoorsSuccessCB,
                error: getCoorsErrorCB
            });
        }

        function sendMessegeFromAssistant(ridepat, cellphone, msg) {
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/pushAssistant",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                async: false,
                data: JSON.stringify({ ridepat: ridepat, cellphone: cellphone, msg: msg }),
                error: pushAssistantErrorCB
            });
        }

        function pushAssistantErrorCB(error) {
            console.log(error);
        }

        function getCoorsSuccessCB(data) {
            var arr_coor = JSON.parse(data.d);
            var user = GENERAL.USER.getUserName();
            for (i in arr_coor) {
                if (user == arr_coor[i].UserName) {
                    currentCoor = arr_coor[i].DisplayName;
                    GENERAL.USER.setUserType(arr_coor[i].TypeVol)
                    break;
                }
            }
        }

        function getCoorsErrorCB(e) {
            alert("Error in getCoors: " + e.responseText);
        }

        function confirmDelete(deleteBtn, table) {

            let ridePatNum = parseInt(deleteBtn.id);

            //IMMUTABLE paradigme !
            const original_deleteCandidate = arr_rides.find((r) => r.RidePatNum === ridePatNum);


            let deleteCandidate = {
                ...original_deleteCandidate,
                Date: convertDBDate2FrontEndDate(original_deleteCandidate.Date)
            }
            deleteCandidate = CustomRideObject(deleteCandidate);
            deleteCandidate.Date = new Date(convert2DBDateToInt(deleteCandidate.Date));
            //console.log('check delete--=>', deleteCandidate);
            let isAfterNoon = deleteCandidate.Date.getMinutes() === 14;
            let isToday = table.context[0].sTableId === "datatable-afternoon" || table.context[0].sTableId === "datatable-morning";

            const { DisplayName } = deleteCandidate.Pat;
            const { Name: from } = deleteCandidate.Origin;
            const { Name: to } = deleteCandidate.Destination;
            const { Date: date } = deleteCandidate; //Date is a reserved word for js! DO NOT ASSIGHN !!!

            let msg2user = `מחיקת ההסעה של ${DisplayName} מ: ${from} ל: ${to} `;

            msg2user += isToday ? 'היום ' :
                `יציאה בתאריך ${date.toLocaleString('he-IL', { dateStyle: 'short' })} `;

            msg2user += isAfterNoon ? 'בשעות אחה"צ ' :
                `בשעה ${date.toLocaleString('he-IL', { timeStyle: 'short' })} `;

            let addToTextWarning = ''
            addToTextWarning = (original_deleteCandidate.MainDriver == -1) && (original_deleteCandidate.IsAnonymous == true) ? '(לא יהיה ניתן לשחזר מידע את הנסיעה (תימחק לצמיתות)' : '';
            msg2user += '\n' + addToTextWarning;
            swal({
                title: "هل انت متأكد?\nהאם אתם בטוחים?",
                type: "warning",
                text: msg2user,
                showCancelButton: true,
                cancelButtonText: "الغاء\nבטל",
                confirmButtonClass: 'btn-warning',
                confirmButtonText: "حذف\nמחיקה",
                closeOnConfirm: true
            }, function (userResponse) {
                if (userResponse) {
                   // deleteRidePat(original_deleteCandidate, deleteBtn, table);
                   deleteUnityRide(original_deleteCandidate, deleteBtn, table)
                }

            });


        }

        //gilad addition

        function jsonToExcelAndDownload(data, fileName) {
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Tomorrow-Ride');
            XLSX.writeFile(wb, fileName + '.xlsx');
        }



        const FixedHour = (DBdateString) => {
            let h = new Date(convertDBDate2FrontEndDate(DBdateString)).getHours()
            let m = new Date(convertDBDate2FrontEndDate(DBdateString)).getMinutes();
            if (h.toString().length==1) {
                h = `0${h}`;
            }
            if (m.toString().length==1) {
                m = `0${m}`;
            }
            return `${h}:${m}`;
        }



        const MessageToPalestinianCoor = () => {
            //const dest = tomorrowMorningRidePats[0].destination
            //const origin = tomorrowMorningRidePats[0].origin
            //let time = tomorrowMorningRidePats[0].time.replace('<div class="elementsInSameLine"><span class="time">', '').replace(`</span><button type='button' data-toggle="modal" data-target="#editTimeModal" onclick="prepreparationEditTimeModal(this, ${tomorrowMorningRidePats[0].ridePatNum})" class='btn btn-icon waves-effect waves-light btn-secondary' title='עריכה'><i class='ti-pencil'></i></button></div>`, '');
            //let patientName = tomorrowMorningRidePats[0].patient.split('>')[1].split('<')[0]
            $('#wait').show();
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/Get_Tomorrow_RidePatView_Gilad",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                success: (data) => {
                    $('#wait').hide();
                    let tomorrowListExcel = JSON.parse(data.d);
                    let listToExcel = [];
                    let rideNum = 1;
                    tomorrowListExcel.forEach(row => {
                        //console.log('Gilad check this -->', FixedHour(row.pickupTime), row.pickupTime);
                        let rowToExcel = {
                            Row: rideNum,
                            From: row.OriginE,
                            To: row.DestinationE,
                            At: FixedHour(row.pickupTime),
                            Pateint_Name: row.patientEName,
                            Num_of_passengers: row.numOfPass,
                            Driver: row.MainDriver
                        };
                        rideNum++;
                        listToExcel.push(rowToExcel);
                    })
                    const stringToCopy = buildMessageString(listToExcel);

                    navigator.clipboard.writeText(stringToCopy)
                        .then(function () {
                            swal({
                                title: "ההודעה מוכנה בפעולת הדבק",
                                timer: 1000,
                                type: "success",
                                showConfirmButton: false
                            });
                        }, function (err) {
                            swal({
                                title: "העתקת ההודעה נכשלה",
                                timer: 1000,
                                type: "error",
                                showConfirmButton: false
                            });
                        });



                    //was excel
                    //console.log('res Gilad ', listToExcel);
                    //jsonToExcelAndDownload(listToExcel, `Tomorrow-Ride ${d.getDate()+1}-${d.getMonth() + 1}-${d.getFullYear()}`);


                },
                error: (error) => {
                    console.log('from ajax to Get_Tomorrow_RidePatView_Gilad ', error);
                    $('#wait').hide();
                }
            
            });
        }

        //gilad
        const buildMessageString = (rideList) => {
            const d = new Date();
            const space = '\n';
            const line = '_______________________________________________________________' + space+space;
            const tab = '\t';
            const sep = `  `;
            let str = `Tomorrow-Rides${tab}${ d.getDate() + 1 } - ${ d.getMonth() + 1 } - ${ d.getFullYear() }` +space;
            str += line;


            for (let i = 0; i < rideList.length; i++) {
                rideList[i].same = i + 1;

                if (i != 0 && isSameRide(rideList[i], rideList[i - 1])) {
                    rideList[i].same = i + 1;
                    rideList[i - 1].same = i + 1;
                    //this change for cal the num of passanger each ride.
                    rideList[i].Num_of_passengers = rideList[i].Num_of_passengers + rideList[i - 1].Num_of_passengers + 1;
                    rideList[i - 1].Num_of_passengers = rideList[i].Num_of_passengers

                }
                else {
                    rideList[i].Num_of_passengers += 1;
                }


            }
            for (let i = 0; i < rideList.length; i++) {
                let tempStr = '';
                //if (i != 0 && rideList[i].same != rideList[i - 1].same) {
                //    tempStr=line
                //}
                tempStr += `Ride ${rideList[i].same}${sep}From: ${rideList[i].From}${sep}To: ${rideList[i].To}${sep}At: ${rideList[i].At}${sep}${rideList[i].Pateint_Name}${sep} (${rideList[i].Num_of_passengers})`;
                tempStr += space;
                str += tempStr;
            }
            str += line;

            return str;

        }
        //gilad
        const isSameRide = (ride1,ride2) => {
            if (ride1.At == ride2.At && ride1.From == ride2.From && ride1.To == ride2.To && ride1.Driver == ride2.Driver) {
                return true
            }
            return false;
        }

        function copyMessageButton(copyMsgBtn, table) {

            let ridePatNum = parseInt(copyMsgBtn.id);
            let messageObject = showMessage(arr_rides, ridePatNum);

            if (!messageObject.date.includes('Date')) {

                const dateTicks = fixDate_WhichComeFromOpenConnection(messageObject.date, false);
                messageObject.date = repaireDateForMeesageModule(dateTicks);
            }
            //console.log('what im send here ? ', messageObject);
            let textMessageToCopy = buildMessage(messageObject);
            //console.log(textMessageToCopy);

            navigator.clipboard.writeText(textMessageToCopy)
                .then(function () {
                    swal({
                        title: "ההודעה מוכנה בפעולת הדבק",
                        timer: 1000,
                        type: "success",
                        showConfirmButton: false
                    });
                }, function (err) {
                    swal({
                        title: "העתקת ההודעה נכשלה",
                        timer: 1000,
                        type: "error",
                        showConfirmButton: false
                    });
                });
        }

        const repaireDateForMeesageModule = (ticks) => {
            let rawDate = `/Date(${ticks})/`;

            return rawDate;
        }

        const candidatesButton = (btn) => {
            let ridePatNum = btn.id;
            GENERAL.RIDEPAT.setRidePatNum4_viewCandidate(ridePatNum);

            ridePatNum = parseInt(ridePatNum);
            const thisridePatObj = arr_rides.find((r) => r.RidePatNum === ridePatNum);

            localStorage.setItem(`ridePatObj_${ridePatNum}`, JSON.stringify(thisridePatObj));

            window.open("viewCandidates.html", '_blank').focus();

            /*
            let a = document.createElement('a');

            a.target = '_blank';
            a.href = "viewCandidates.html";
            a.click();
            */
        }

        function editButton(ridePat) {
            arr_details = { RidePatNum: ridePat.name, func: "edit" }; //ridePat.name=RidePatNum
            GENERAL.RIDEPAT.setRidePatList(JSON.stringify(arr_details));
            location.href = "ridePatForm.html";
        }

        function deleteRidePat(ridePat, deleteBtn, thistable) {
            checkCookie();
            $('#wait').show();
            // var numberOfRides = 1;
            //var repeatRide = "";
            let ridePatNums2MarkDeleted = [];
            ridePatNums2MarkDeleted.push(ridePat.RidePatNum);
            let nowInUTC = new Date().toUTCString();

            $.ajax({
                dataType: "json",
                url: "WebService.asmx/ChangeArrayOF_RidePatStatuses",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({ newStatus: 'נמחקה', ridePatNums: ridePatNums2MarkDeleted, clientUTCTimeStemp: nowInUTC }),
                success: function () {
                    swal({
                        title: "لقد تم حذف السفرية\nההסעה נמחקה",
                        timer: 1000,
                        type: "success",
                        showConfirmButton: false
                    });


                    if (thistable && deleteBtn) {
                        //console.log('Gilad check from deleteRidePat --> ', deleteBtn,)
                        thistable.row($(deleteBtn).parents('tr')).remove().draw();
                    } else {
                        location.reload();
                    }

                    let RidePat = {
                        Date: typeof ridePat.Date === 'string' ? convertDBDate2FrontEndDate(ridePat.Date) : ridePat.Date,
                        Destination: ridePat.Destination,
                        Origin: ridePat.Origin,
                        Pat: ridePat.Pat
                    }
                    //retturn ride part.
                    $.ajax({
                        dataType: "json",
                        url: "WebService.asmx/getReturnRidePat",
                        contentType: "application/json; charset=utf-8",
                        type: "POST",
                        async: false,
                        data: JSON.stringify({ RidePat }),
                        success: function (data) {

                            returnRidePat = JSON.parse(data.d);


                            if (returnRidePat && returnRidePat.Status !== 'נמחקה') {
                                $('#wait').hide();

                                let patientName = 'חולה';
                                if (!returnRidePat.Pat.DisplayName.includes("אנונימי")) {
                                    patientName = returnRidePat.Pat.DisplayName;
                                }
                                let frontEndDate = convertDBDate2FrontEndDate(returnRidePat.Date);

                                if (frontEndDate.getMinutes() === 14) {//afternoon
                                    frontEndDate = `תאריך ${frontEndDate.toLocaleDateString('he-IL')} בשעות אחה"צ`;
                                } else {
                                    frontEndDate = frontEndDate.toLocaleString('he-IL', { dateStyle: 'short', timeStyle: 'short' });
                                }

                                returnRidePatMsg = `האם למחוק גם את ההחזרה של ${patientName} מ${returnRidePat.Origin.Name} ל${returnRidePat.Destination.Name} ב${frontEndDate}`;
                                $('#DriverReturnRidePatMsg').html("");
                                if (returnRidePat.Drivers.length != 0) {
                                    returnDriverMsg = returnRidePat.Drivers[0].DisplayName + " נרשם להחזרה הזו!";
                                    $('#DriverReturnRidePatMsg').html("<h5 style='color:red; font-weight: bold;'>שימו לב!</h5><h5>" + returnRidePat.Drivers[0].DisplayName + " נרשם להחזרה הזו!</h5>");
                                }

                                $('#returnRidePatMsg').html(returnRidePatMsg);
                                $('#messagesModal').modal('toggle');
                            } else {
                                $('#wait').hide();
                            }
                        },
                        error: function (err) {
                            alert("Error in getReturnRidePat: " + err.responseText);
                            console.log(err);
                        }
                    })
                },
                error: function (err) { alert("Error in deleteRidePat:" + err.responseText); }
            });

        }


        const deleteUnityRide = (ridePat, deleteBtn, thistable) => {
            checkCookie();
            $('#wait').show();
            // var numberOfRides = 1;
            //var repeatRide = "";
            let ridePatNums2MarkDeleted = [];
            ridePatNums2MarkDeleted.push(ridePat.RidePatNum);
            let nowInUTC = new Date().toUTCString();
            const listIds = []
            listIds.push(ridePat.RidePatNum);
            let request = { ListIDs: listIds };
            //console.log('check request -->', request)
            console.log('Gilad check -->', ridePat);
                $.ajax({
                    dataType: "json",
                    url: "WebService.asmx/deleteUnityRide",
                    contentType: "application/json; charset=utf-8",
                    type: "POST",
                    data: JSON.stringify(request),
                    success: function (data) {
                        swal({
                            title: "لقد تم حذف السفرية\nההסעה נמחקה",
                            timer: 1000,
                            type: "success",
                            showConfirmButton: false
                        });
                        if (thistable && deleteBtn) {
                            //console.log('Check This table and btn', thistable, deleteBtn, thistable.row($(deleteBtn).parents('tr')))
                            //console.log('Gilad check from deleteRidePat --> ', deleteBtn,)
                            let stam = thistable.row($(deleteBtn).parents('tr')).remove().draw();
                            //console.log(stam);
                        } else {
                            location.reload();
                        }
                        $('#wait').hide();
                        //retturn ride part.
                        // only non anonymous and destination==hospital
                        if (isThisReturnNonAnonymousRide(ridePat)) {
                          $.ajax({
                            dataType: "json",
                            url: "WebService.asmx/GetReturnRideUnityRide",
                            contentType: "application/json; charset=utf-8",
                            type: "POST",
                            async: false,
                            data: JSON.stringify({ unityRideID:ridePat.RidePatNum }),
                            success: function (data) {

                                returnRidePat = JSON.parse(data.d);
                                returnRidePat = CustomRideObject(returnRidePat);

                                if (returnRidePat && returnRidePat.Status !== 'נמחקה') {
                                    $('#wait').hide();

                                    let patientName = 'חולה';
                                    if (!returnRidePat.Pat.DisplayName.includes("אנונימי")) {
                                        patientName = returnRidePat.Pat.DisplayName;
                                    }
                                    let frontEndDate = convertDBDate2FrontEndDate(returnRidePat.Date);

                                    if (frontEndDate.getMinutes() === 14) {//afternoon
                                        frontEndDate = `תאריך ${frontEndDate.toLocaleDateString('he-IL')} בשעות אחה"צ`;
                                    } else {
                                        frontEndDate = frontEndDate.toLocaleString('he-IL', { dateStyle: 'short', timeStyle: 'short' });
                                    }

                                    returnRidePatMsg = `האם למחוק גם את ההחזרה של ${patientName} מ${returnRidePat.Origin.Name} ל${returnRidePat.Destination.Name} ב${frontEndDate}`;
                                    $('#DriverReturnRidePatMsg').html("");
                                    if (returnRidePat.Drivers.length != 0) {
                                        returnDriverMsg = returnRidePat.Drivers[0].DisplayName + " נרשם להחזרה הזו!";
                                        $('#DriverReturnRidePatMsg').html("<h5 style='color:red; font-weight: bold;'>שימו לב!</h5><h5>" + returnRidePat.Drivers[0].DisplayName + " נרשם להחזרה הזו!</h5>");
                                    }

                                    $('#returnRidePatMsg').html(returnRidePatMsg);
                                    $('#messagesModal').modal('toggle');
                                } else {
                                    $('#wait').hide();
                                }
                            },
                            error: function (err) {
                                alert("Error in getReturnUnityRide***: " + err.responseText);
                                console.log(err);
                            }
                        })
                        }
                        
                      







                    },
                    error: function (err) {
                        alert("Error in deleteUnityRide: " + err.responseText);
                        $('#wait').hide();
                        console.log(err);
                    }
                })
            

      

        
        }


        function newRidePatForm() {
            ridePatNum = " ";
            arr_details = { ridePatNum: ridePatNum, func: "new" };
            GENERAL.RIDEPAT.setRidePatList(JSON.stringify(arr_details));
            location.href = "ridePatForm.html";
        }
        function deleteReturn_unityRide() {
    
            let thisTable = null;
            let deleteBtn = null;

            if (document.getElementById(`${returnRidePat.RidePatNum}`) !== null) { //DUE TO SORTING THE ROW IS NOT RENDERED


                deleteBtn = document.getElementById(`${returnRidePat.RidePatNum}`);

                switch ($(deleteBtn).parents("table:first")[0].id) {
                    case tableNames.MORNING:
                        thisTable = tMorning;
                        break;
                    case tableNames.AFTERNOON:
                        thisTable = tAfternoon;
                        break;
                    case tableNames.TOMORROW_MORNING:
                        thisTable = tTomorrowMorning
                        break;
                    case tableNames.TOMORROW_AFTERNOON:
                        thisTable = tTomorrowAfternoon
                        break;
                    case tableNames.FUTURE:
                        thisTable = tFuture;
                        break;
                }

            }
            let ridepat = returnRidePat;
            returnRidePat = null;
            $('#messagesModal').modal('toggle');
            $('#DriverReturnRidePatMsg').html("");
            //if (thisTable && deleteBtn) {
            //    console.log('Gilad check from deleteReturn --> ', deleteBtn.children[10].children[0].children[1],$(deleteBtn).parents('tr'), $('#' + RidePat.RidePatNum).parents('tr'));
            //    thisTable.row($(deleteBtn).parents('tr')).remove().draw();
            //}
            //console.log('Gilad check from deleteReturn --> ', deleteBtn, deleteBtn.children[deleteBtn.children.length-1].children[0].children[1]);
            //deleteBtn = deleteBtn.children[10].children[0].children[1];
            deleteBtn = deleteBtn.children[deleteBtn.children.length - 1].children[0].children[1]

            deleteUnityRide(ridepat, deleteBtn, thisTable);
        }
        function deleteReturn() {

            var RidePat = new Object();
            RidePat.RidePatNum = returnRidePat.RidePatNum;
            //   var tempDate = dateReturn; --wtf ?! YOGEV disable it
            var tempDate = "01/01/1970"; // Fictional date for deletion
            var tempDateReveresed = tempDate.split('/').reverse().join('/')
            var date3 = new Date(tempDateReveresed);
            RidePat.Date = date3;
            if (isNaN(date3.getTime())) {
                var date3 = new Date();
                var tempHour = tempDate.split(':');
                date3.setHours(tempHour[0])
                RidePat.Date = date3;
            }
            var Pat = new Object();
            Pat.DisplayName = returnRidePat.Pat.DisplayName;
            RidePat.Pat = Pat;
            var Destination = new Object();
            Destination.Name = returnRidePat.Destination.Name;
            RidePat.Destination = Destination;
            var Origin = new Object();
            Origin.Name = returnRidePat.Origin.Name;
            RidePat.Origin = Origin;

            let thisTable = null;
            let deleteBtn = null;

            if (document.getElementById(`${RidePat.RidePatNum}`) !== null) { //DUE TO SORTING THE ROW IS NOT RENDERED


                deleteBtn = document.getElementById(`${RidePat.RidePatNum}`);

                switch ($(deleteBtn).parents("table:first")[0].id) {
                    case tableNames.MORNING:
                        thisTable = tMorning;
                        break;
                    case tableNames.AFTERNOON:
                        thisTable = tAfternoon;
                        break;
                    case tableNames.TOMORROW_MORNING:
                        thisTable = tTomorrowMorning
                        break;
                    case tableNames.TOMORROW_AFTERNOON:
                        thisTable = tTomorrowAfternoon
                        break;
                    case tableNames.FUTURE:
                        thisTable = tFuture;
                        break;
                }

            }

            returnRidePat = null;
            $('#messagesModal').modal('toggle');
            $('#DriverReturnRidePatMsg').html("");
            //if (thisTable && deleteBtn) {
            //    console.log('Gilad check from deleteReturn --> ', deleteBtn.children[10].children[0].children[1],$(deleteBtn).parents('tr'), $('#' + RidePat.RidePatNum).parents('tr'));
            //    thisTable.row($(deleteBtn).parents('tr')).remove().draw();
            //}
            //console.log('Gilad check from deleteReturn --> ', deleteBtn, deleteBtn.children[deleteBtn.children.length-1].children[0].children[1]);
            //deleteBtn = deleteBtn.children[10].children[0].children[1];
            deleteBtn = deleteBtn.children[deleteBtn.children.length - 1].children[0].children[1]

            deleteRidePat(RidePat, deleteBtn, thisTable);
        }

        const isThisReturnNonAnonymousRide = (ride) => {
            console.log('parms-->', ride);
            if (hospitals.includes(ride.Destination) && !ride.IsAnonymous) {
                return true;
            }
            else {
                return false;
            }
           

        }


        function closeModal() {
            $('#messagesModal').modal('hide');
            $('#DriverReturnRidePatMsg').html("");

            //הסטטוס 'אין נסיעת הלוך' עושה בעיות כיוון שלא ניתן להשתבץ אליו.
            //newStatus = "אין נסיעת הלוך"


        }

        const showFiltersModal = () => {

            ajaxCall(
                'getAreas_AsLocationObj',
                '',
                getAreas_SCB,
                getAreas_ECB
            );

            $('#filtersModal').modal({
                backdrop: 'static', //prevent popup to close when clicking outside
                keyboard: false     //prevent popup to close when press esc on the keyboard
            })
            $('#filtersModal').modal('show');
        }

        const getAreas_ECB = (err) => { console.log(err); }

        const getAreas_SCB = (data) => {

            let listOfAreas = JSON.parse(data.d);

            let checkBoxesStr = '';

            const arrayOF_areasObj_isEmpty = localStorage.getItem('arrayOF_areasObj') === null || localStorage.getItem('arrayOF_areasObj') === 'null';

            let areasFromLs = JSON.parse(localStorage.getItem('arrayOF_areasObj'));


            if (!arrayOF_areasObj_isEmpty && listOfAreas.length > areasFromLs.length) {
                //case when 1 or more new areas added and ls is allready exist

                for (let i = areasFromLs.length; i < listOfAreas.length; i++) { //the gap between them
                    areasFromLs.push({
                        hebrewName: listOfAreas[i].Area,
                        englishName: listOfAreas[i].EnglishName,
                        checked: false
                    });
                }
                localStorage.setItem('arrayOF_areasObj', JSON.stringify(areasFromLs));
            } else if (!arrayOF_areasObj_isEmpty && listOfAreas.length < areasFromLs.length) {
                localStorage.setItem('arrayOF_areasObj', null);
                location.reload();
            }

            for (let i = 0; i < listOfAreas.length; i++) {

                if (arrayOF_areasObj_isEmpty) {

                    arrayOF_areasObj[i] = { hebrewName: listOfAreas[i].Area, englishName: listOfAreas[i].EnglishName }

                    if (i === listOfAreas.length - 1) {
                        localStorage.setItem('arrayOF_areasObj', JSON.stringify(arrayOF_areasObj));
                    }
                }

                checkBoxesStr += `<div>`;
                checkBoxesStr += `<input type="checkbox" id="${listOfAreas[i].EnglishName}" checked />`;
                checkBoxesStr += `<label class="overRideBS_label" for="${listOfAreas[i].EnglishName}">&nbsp;${listOfAreas[i].Area}</label>`;
                checkBoxesStr += `</div>`;
            }
            document.getElementById('filtersModal_placeHolder').innerHTML = checkBoxesStr;

            if (!arrayOF_areasObj_isEmpty) {

                let checkBoxesContainer = document.getElementById('filtersModal_placeHolder').children;
                let arrayOF_areasObj = JSON.parse(localStorage.getItem('arrayOF_areasObj'));

                for (let i = 0; i < checkBoxesContainer.length; i++) {
                    $(`#${arrayOF_areasObj[i].englishName}`).prop('checked', arrayOF_areasObj[i].checked);
                }

            }
        }

        const saveFilters = () => {

            let checkBoxesContainer = document.getElementById('filtersModal_placeHolder').children;
            let arrayOF_areasObj = JSON.parse(localStorage.getItem('arrayOF_areasObj'));

            let areasToShow_arr = [];

            for (let i = 0; i < checkBoxesContainer.length; i++) {
                arrayOF_areasObj[i] = {
                    ...arrayOF_areasObj[i],
                    checked: $(`#${arrayOF_areasObj[i].englishName}`).prop('checked')
                };

                if ($(`#${arrayOF_areasObj[i].englishName}`).prop('checked')) {
                    areasToShow_arr.push(arrayOF_areasObj[i].hebrewName);
                }
            }

            localStorage.setItem('arrayOF_areasObj', JSON.stringify(arrayOF_areasObj));
            localStorage.setItem('areasToShow_arr', JSON.stringify(areasToShow_arr));

            refreshTable_UnityRide();
        }

        const allSortsSwitch_changed = () => {

            let considerSorts_controllers = $('#allSortsSwitch').prop('checked');
            localStorage.setItem('allSortsSwitch', JSON.stringify(considerSorts_controllers));

            if (!considerSorts_controllers) {

                $('#allSortsLabel').html('הפעל סינון');
                $('#openSortsControllers').prop('disabled', true);
                refreshTable_UnityRide();
            } else {

                $('#allSortsLabel').html('כבה סינון');
                $('#openSortsControllers').prop('disabled', false);
                refreshTable_UnityRide();
            }

        }

        const classManager = {

            getSuitableClassS_4thisTime: (tableName, hh = -1, mm = -1) => {
                let suitableClass;

                switch (tableName) {
                    case "datatable-morning":
                        suitableClass = 'withIn12HoursDrive';
                        break;
                    case "datatable-afternoon":
                        suitableClass = classManager.calculateSuitableClass_24HoursRange(hh, mm);
                        break;
                    case "datatable-tomorrow-morning":
                        suitableClass = classManager.calculateSuitableClass_24HoursRange(
                            hh,
                            mm,
                            false
                        );
                        break;
                    case "datatable-future":
                        suitableClass = 'initialStyle';
                        break;
                }
                return suitableClass;
            },

            calculateSuitableClass_24HoursRange: (hh, mm, isToday = true) => {

                let now = new Date();
                let ridePatTimeObj = {
                    hh: parseInt(hh),
                    mm: parseInt(mm),
                };
                const addons = isToday ? 0 : 1;

                let ridePatTime = new Date(
                    now.getFullYear(),
                    now.getMonth(),
                    now.getDate() + addons,
                    ridePatTimeObj.hh,
                    ridePatTimeObj.mm
                );


                let hours_gap = getHoursGap(ridePatTime, now);

                if (hours_gap >= 0 && hours_gap <= 24) {

                    return hours_gap <= 12 ? 'withIn12HoursDrive' : 'withIn24HoursDrive';
                }

                return 'initialStyle';
            },
        };

        const isWithin2HoursSinceChange = (ridePatLastModified) => {
            let now = new Date();
            const hoursGap = getHoursGap(ridePatLastModified, now);
            return (hoursGap >= -2 && hoursGap <= 0);
        }

        const getNext_X_DaysDateAsString = (days) => {

            if (typeof days != 'number') {
                return;
            }

            let today = new Date();
            let futureIntRepresentation = today.setDate(today.getDate() + days);
            let futureDate = new Date(futureIntRepresentation);
            let finalOutPut = futureDate.toLocaleString('he-IL', { dateStyle: "short" });

            return finalOutPut;
        }

        // just to check the new api gilad
        const CHECK_TEST_NOT_REAL = () => {
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/GetUnityRide",
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Content-Encoding", "gzip");
                },
                type: "POST",
                data: JSON.stringify({days: 7 }),
                success: function (data) {
                    $('#wait').hide();
                    const test = JSON.parse(data.d);
                    //console.log('Gilad check this -->', test)


                },
                error: function (err) {
                    $('#wait').hide();
                    alert("Error in GetRidePatView: " + err.responseText);
                }
            });
        }


        //This one take from unityRide the data *work* 
        function refreshTable_UnityRide(timeInterval = 7) {
            $('#wait').show();

            morningRidePats = [];
            afterNoonRidePats = [];
            tomorrowMorningRidePats = [];
            tomorrowAfternoonRidePats = [];
            futureRidePats = [];

            let areasToShow_arr = JSON.parse(localStorage.getItem('areasToShow_arr'));
            let allSortsSwitch = JSON.parse(localStorage.getItem('allSortsSwitch'));

            checkCookie();

            if (areasToShow_arr !== null && areasToShow_arr.length === 0 && allSortsSwitch) { //dont show any
                $('#wait').hide();

                tMorning = $(`#${tableNames.MORNING}`).DataTable({ data: [], destroy: true });

                tAfternoon = $(`#${tableNames.AFTERNOON}`).DataTable({ data: [], destroy: true });

                tTomorrowMorning = $(`#${tableNames.TOMORROW_MORNING}`).DataTable({ data: [], destroy: true });

                tTomorrowAfternoon = $(`#${tableNames.TOMORROW_AFTERNOON}`).DataTable({ data: [], destroy: true });

                tFuture = $(`#${tableNames.FUTURE}`).DataTable({ data: [], destroy: true });
                return;
            }

            var volunteerId = -1 // VolunteerId - 1 means get ALL FUTURE ridePats // VolunteerId -2 means get ALL ridePats
            //gilad check
            //console.log('Gilad check this new func* -->', volunteerId, timeInterval)
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/GetUnityRide",
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Content-Encoding", "gzip");
                },
                type: "POST",
                data: JSON.stringify({ days: timeInterval }),
                success: function (data) {
                    $('#wait').hide();
                    arr_rides = JSON.parse(data.d);
                    //console.log('Gilad check this new func*  -->', arr_rides)
                    GENERAL.RIDEPAT.setRidePatList(JSON.stringify(arr_rides));

                    let thisRidePatDate;
                    let thisRidePat = {};
                    let editBtn;
                    let deleteBtn;
                    let messageToCopyBtn;
                    let candidateBtn;
                    let btnStr = '';
                    //     let lastModified = convertDBDate2FrontEndDate(arr_rides[i].LastModified).toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    let numOfRealEscorts = 0; //not anonymous
                    let driverColumnContent = '';
                    let englishStatus = '';
                    let patientHTML;
                    let driverHTML;
                    let status2render;
                    let timeHTML;
                    let patientGender = null;
                    let patientAge = null;
                    let isPatientStatusShouldPaintRow = false;
                    let remarkHTML = '';
                    listRowstoColor = [];


                    for (let i = 0; i < arr_rides.length; i++)
                    {
                        //if (arr_rides[i].Status == 'שובץ נהג') {
                        //    //console.log(arr_rides[i], document.getElementById(arr_rides[i].RidePatNum), $(`#${arr_rides[i].RidePatNum}`));
                        //    listRowstoColor.push(arr_rides[i].RidePatNum);

                        //}

                        if (allSortsSwitch && areasToShow_arr !== null) {
                            if (areasToShow_arr.length !== 0) {
                                if (!areasToShow_arr.includes(arr_rides[i].Area)) {
                                    continue;
                                }
                            }
                        }
                        thisRidePatDate = convertDBDate2FrontEndDate(arr_rides[i].PickupTime);
                        timeHTML = buildTimeHTML(thisRidePatDate, arr_rides[i].RidePatNum);
                        numOfEscorts = arr_rides[i].AmountOfEscorts;

                        //#region adjust patient column
                        patientHTML = buildPatientHTML_AfterUnited(arr_rides[i]);
                        //#endregion

                        //#region adjust driver column
                        driverHTML = '';
                        let driversArr = [];
                        if (arr_rides[i].DriverName != '') {
                            //Custom obj for buildDriverHTML and buildAcionsButtonsHTML functions.
                            let MainDriver = {
                                Id: arr_rides[i].MainDriver,
                                DisplayName: arr_rides[i].DriverName,
                                EnglishFN: '',
                                EnglishLN: '',
                                CellPhone: arr_rides[i].DriverCellPhone,
                                NoOfDocumentedRides: arr_rides[i].NoOfDocumentedRides,
                                IsNewDriver: arr_rides[i].IsNewDriver

                            }
                            driversArr.push(MainDriver);
                            let RideNum = 1;
                            driverHTML = buildDriverHTML(arr_rides[i].RidePatNum, MainDriver, RideNum);
                        } else {

                            driverHTML = buildDriverHTML(arr_rides[i].RidePatNum);
                        }
                        //#endregion adjust driver column

                        //#region Status
                        //custom for buildstatusString function
                        let statusObj = {}
                        //console.log('Check here -->', arr_rides[i])
                        if (arr_rides[i].PatientStatus == '' || arr_rides[i].PatientStatus =='Not Finished') {
                            statusObj.Status = -1;
                        }
                        else {
                            statusObj.Status = 1;

                        }
                        statusObj.EditTimeStamp = arr_rides[i].PatientStatusEditTime;
                        status2render = buildStatusString(statusObj, arr_rides[i].RidePatNum);
                        //#endregion Status

                        //#region remarkHTML
                        remarkHTML = buildRemarkHTML(arr_rides[i].Remark, arr_rides[i].RidePatNum);
                        //#endregion remarkHTML

                        //#region patient age

                        //custom object for buildPatientAgeHTML function.
                        let ageObj = {}
                        ageObj.PatientName = arr_rides[i].PatientName;
                        ageObj.Age = arr_rides[i].PatientAge;
                        ageObj.GenderAsEnum = arr_rides[i].PatientGender;
                        ageObj.IsAnonymous = arr_rides[i].IsAnonymous;
                        patientAge = buildPatientAgeHTML_AfterUnited(ageObj);
                        //#endregion


                        //#region buttons

                        btnStr = buildAcionsButtonsHTML(arr_rides[i].RidePatNum, driversArr);
                        //#endregion buttons

                        //#region isPatientStatusShouldPaintRow
                        isPatientStatusShouldPaintRow = callIfPatientStatusShouldPaintRow_AfterUnited(arr_rides[i]);
                        //#endregion isPatientStatusShouldPaintRow

                        thisRidePat = {
                            ridePatNum: arr_rides[i].RidePatNum,
                            time: timeHTML,
                            //origin: isAssistant ? arr_rides[i].Origin.EnglishName : arr_rides[i].Origin.Name,
                            //destination: isAssistant ? arr_rides[i].Destination.EnglishName : arr_rides[i].Destination.Name,
                            origin: arr_rides[i].Origin,
                            destination: arr_rides[i].Destination,
                            patient: patientHTML,
                            patientAge: patientAge,
                            driver: driverHTML,
                            status: status2render,
                            lastModified: convertDBDate2FrontEndDate(arr_rides[i].LastModified).toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" }),
                            remark: remarkHTML,
                            isAnonymous: arr_rides[i].IsAnonymous == true,
                            hasDriver: arr_rides[i].MainDriver != -1,
                            buttons: btnStr,
                            isPatientStatusShouldPaintRow: isPatientStatusShouldPaintRow,
                        }

                        if (thisRidePatDate.toLocaleDateString() === new Date().toLocaleDateString()) {                         //<---- today
                            if (thisRidePatDate.getHours() < 12) {                                                              //<---- today morning

                                morningRidePats.push(thisRidePat);
                            } else {                                                                                           //<---- today afternoon

                                afterNoonRidePats.push(thisRidePat);
                            }

                        } else if (thisRidePatDate.toLocaleDateString() === tomorrowDate.toLocaleDateString()) {              //<---- tomorrow

                            if (thisRidePatDate.getHours() < 12) {                                                           //<---- tomorrow morning
                                thisRidePat.date = thisRidePatDate.toLocaleString('he-IL', { dateStyle: 'short' });

                                tomorrowMorningRidePats.push(thisRidePat);
                            } else {                                                                                         //<---- tomorrow afternoon
                                thisRidePat.date = thisRidePatDate.toLocaleString('he-IL', { dateStyle: 'short' });

                                tomorrowAfternoonRidePats.push(thisRidePat);
                            }

                        } else if (thisRidePatDate > tomorrowDate) {                                                         //<---- future

                            thisRidePat.date = thisRidePatDate.toLocaleString('he-IL', { dateStyle: 'short' });
                            futureRidePats.push(thisRidePat);
                        }

                        //here need to be the logic of coloring the row
                        
                        const hourRide = convertDBDate2FrontEndDate(arr_rides[i].PickupTime).getHours();
                        //console.log('checking:', arr_rides[i].MainDriver, hourRide, arr_rides[i].IsAnonymous);
                        const anonymous = arr_rides[i].PatientName.includes('אנונימי') || arr_rides[i].IsAnonymous;
                        //console.log('params:', !anonymous && arr_rides[i].MainDriver > 0 && hourRide <= 21);
                        if (!anonymous && arr_rides[i].MainDriver > 0 && hourRide <= 21) {
                            //console.log('colord row', arr_rides[i].RidePatNum)
                            listRowstoColor.push(arr_rides[i].RidePatNum);
                            //$(`#${arr_rides[i].RidePatNum}`).addClass('statusComplete');
                        }


                    }
                    let arrayOf_IHaveSeenAllready = localStorage.getItem('arrayOf_IHaveSeenAllready') ?
                        JSON.parse(localStorage.getItem('arrayOf_IHaveSeenAllready'))
                        :
                        [];

                    //           ============================
                    //           || ↓DATATABLES PROPERTIES↓||
                    //           ============================

                    //console.log('Morning table data-->', morningRidePats);
                    tMorning = $(`#${tableNames.MORNING}`).DataTable({
                        data: morningRidePats,
                        rowId: 'ridePatNum',
                        dom: controllersLayout,
                        buttons: [
                            {
                                extend: 'excelHtml5',
                                text: 'ייצוא לאקסל',
                                title: `ניהול הסעות - בוקר ${getNext_X_DaysDateAsString(0)}`,
                            }
                        ],
                        pageLength: 100,
                        stateSave: true,
                        destroy: true,
                        autoWidth: false,
                        columns: [
                            //when add column be aware of columnDefs refernces [i] IMPORTANT !!!
                            { data: "time" },                                //0
                            { data: "origin" },                              //1
                            { data: "destination" },                         //2
                            { data: "patient" },                             //3
                            { data: "patientAge" },                          //4
                            { data: "driver" },                              //5
                            { data: "status" },                              //6
                            { data: "lastModified" },                        //7
                            { data: "remark" },                              //8
                            { data: "isAnonymous" },                         //9
                            { data: "buttons" },                             //10
                        ],
                        columnDefs: [
                            { width: '5%', "targets": [0, 1, 2, 5, 6, 7] },
                            { width: '2%', "targets": [4] },
                            { width: '15%', "targets": [3] },
                            { width: '25%', "targets": [9] },
                            { targets: 0, type: 'de_time' },
                            {
                                targets: [1, 2, 3, 5, 6, 7], createdCell: (cell, cellData, rowData, rowIndex, colIndex) => {
                                    if (isAssistant) {
                                        cell.className += ' ltr';
                                    }

                                    switch (colIndex) {
                                        case 5: //driver column

                                            $(cell).addClass('driver_td');
                                            if (!rowData.hasDriver) {
                                                const suitableClass = classManager.getSuitableClassS_4thisTime("datatable-morning");
                                                $(cell).addClass(suitableClass);
                                            }
                                            break;

                                        case 6://status column
                                            if (
                                                cellData.indexOf("הגענו ליעד") !== -1 ||
                                                cellData.indexOf("Reached destination") !== -1
                                            ) {
                                                cell.style.backgroundColor = "green";
                                                cell.style.color = "white";
                                            }
                                            else if (cellData.includes('שובץ נהג') || cellData.includes('Driver registered')) {

                                                if (rowData["isAnonymous"]) {
                                                    $(cell.parentElement).addClass('driverAssign2AnonymousRide');
                                                }
                                            }
                                            break;
                                        case 7://lastModified column

                                            const thisRidePatNum = rowData.ridePatNum;
                                            const thisridePatObj = arr_rides.find((r) => r.RidePatNum === thisRidePatNum);
                                            const intValue = convert2DBDateToInt(thisridePatObj.LastModified);//the reasone why we get the origial obj is to support pc with english date
                                            const thisRidePatLastModified = new Date(intValue)
                                            const isSeenAllReady = arrayOf_IHaveSeenAllready.includes(thisRidePatNum);

                                            if (isWithin2HoursSinceChange(thisRidePatLastModified) && !isSeenAllReady) {
                                                cell.classList.add('within2HoursSinceChange');
                                                increaseCounter(tableNames.MORNING, thisRidePatNum);
                                            }
                                            break;

                                    }

                                }
                            },
                            { targets: 7, className: 'last-modified_td' },
                            { targets: 7, type: 'last_modifiedSort' },
                            { "targets": [9], visible: false },
                            { targets: [10], orderable: false }

                        ],
                        createdRow: function (row, data, dataIndex) {

                            if (data.isPatientStatusShouldPaintRow) {

                                $(row).addClass("highlightRow-after-patientStatusModal");
                            }
                        },
                    });

                    tAfternoon = $(`#${tableNames.AFTERNOON}`).DataTable({
                        rowId: 'ridePatNum',
                        dom: controllersLayout,
                        buttons: [
                            {
                                extend: 'excelHtml5',
                                text: 'ייצוא לאקסל',
                                title: `ניהול הסעות -  אחה"צ ${getNext_X_DaysDateAsString(0)}`,
                            }
                        ],
                        pageLength: 100,
                        data: afterNoonRidePats,
                        stateSave: true,
                        destroy: true,
                        columns: [
                            //when add column be aware of columnDefs refernces [i] IMPORTANT !!!
                            { data: "time" },                                //0
                            { data: "origin" },                              //1
                            { data: "destination" },                         //2
                            { data: "patient" },                             //3
                            { data: "patientAge" },                          //4
                            { data: "driver" },                              //5
                            { data: "status" },                              //6
                            { data: "lastModified" },                        //7
                            { data: "remark" },                              //8
                            { data: "isAnonymous" },                         //9
                            { data: "buttons" },                             //10
                        ],
                        columnDefs: [
                            { width: '5%', "targets": [0, 1, 2, 5, 6, 7, 8] },
                            { width: '2%', "targets": [4] },
                            { width: '15%', "targets": [3] },
                            { width: '25%', "targets": [10] },
                            { targets: 0, type: 'de_time' },
                            { targets: [0], createdCell: (td) => { $(td).attr('id', 'rideTiming') } },
                            {
                                targets: [1, 2, 3, 5, 6, 7], createdCell: (cell, cellData, rowData, rowIndex, colIndex) => {
                                    if (isAssistant) {
                                        cell.className += ' ltr';
                                    }

                                    switch (colIndex) {

                                        case 1: //origin
                                            $(cell).attr('id', 'OriginName');
                                            if (cellData.indexOf('מרכז') !== -1
                                                || cellData.indexOf('center') !== -1
                                                || rowData['destination'].indexOf('מרכז') !== -1
                                                || rowData['destination'].indexOf('center') !== -1
                                            ) {
                                                $(cell.parentElement).addClass('driverAssign2AnonymousRide');
                                            }
                                            break;

                                        case 2://destination
                                            createdCell: (td) => { $(td).attr('id', 'DestinationName') }
                                            break;

                                        case 5: //driver
                                            //this code is identical to the one in datatable-tomorrow-morning when can need to change to 1 function
                                            $(cell).addClass('driver_td');
                                            if (!rowData.hasDriver) {

                                                let ridePatTime_td;
                                                if (rowData['time'] === 'אחה"צ') {

                                                    ridePatTime_td = [12, 0];
                                                } else {

                                                    ridePatTime_td = $.trim(rowData['time']).split(':');
                                                }

                                                const hh = parseInt(ridePatTime_td[0]);
                                                const mm = parseInt(ridePatTime_td[1]);

                                                const suitableClass = classManager.getSuitableClassS_4thisTime("datatable-afternoon", hh, mm);
                                                $(cell).addClass(suitableClass);

                                            }
                                            break;

                                        case 6://status
                                            if (cellData.indexOf("הגענו ליעד") !== -1 ||
                                                cellData.indexOf("Reached destination") !== -1) {

                                                $(cell).addClass('reached2destination');
                                            } else if (cellData.includes('שובץ נהג') || cellData.includes('Driver registered')) {

                                                if (rowData["isAnonymous"]) {

                                                    $(cell.parentElement).addClass('driverAssign2AnonymousRide');
                                                }
                                            }
                                            break;
                                        case 7://lastModified column

                                            const thisRidePatNum = rowData.ridePatNum;
                                            const thisridePatObj = arr_rides.find((r) => r.RidePatNum === thisRidePatNum);
                                            const intValue = convert2DBDateToInt(thisridePatObj.LastModified);//the reasone why we get the origial obj is to support pc with english date
                                            const thisRidePatLastModified = new Date(intValue)
                                            const isSeenAllReady = arrayOf_IHaveSeenAllready.includes(thisRidePatNum);

                                            if (isWithin2HoursSinceChange(thisRidePatLastModified) && !isSeenAllReady) {
                                                cell.classList.add('within2HoursSinceChange');
                                                increaseCounter(tableNames.AFTERNOON, thisRidePatNum);
                                            }
                                            break;

                                    }

                                }
                            },
                            { targets: 7, className: 'last-modified_td' },
                            { targets: 7, type: 'last_modifiedSort' },
                            { targets: [9], visible: false },
                            { targets: [10], orderable: false }
                        ],
                        autoWidth: false,
                        createdRow: function (row, data, dataIndex) {

                            if (data.isPatientStatusShouldPaintRow) {

                                $(row).addClass("highlightRow-after-patientStatusModal");
                            }
                        },
                    });

                    tTomorrowMorning = $(`#${tableNames.TOMORROW_MORNING}`).DataTable({
                        rowId: 'ridePatNum',
                        dom: controllersLayout,
                        buttons: [
                            {
                                extend: 'excelHtml5',
                                text: 'ייצוא לאקסל',
                                title: `ניהול הסעות למחר ${getNext_X_DaysDateAsString(1)}`,
                            }
                        ],
                        data: tomorrowMorningRidePats,
                        stateSave: true,
                        destroy: true,
                        "pageLength": 100,
                        columns: [
                            //when add column be aware of columnDefs refernces [i] IMPORTANT !!!
                            { data: "date" },                                //0
                            { data: "time" },                                //1
                            { data: "origin" },                              //2
                            { data: "destination" },                         //3
                            { data: "patient" },                             //4
                            { data: "patientAge" },                          //5
                            { data: "driver" },                              //6
                            { data: "status" },                              //7
                            { data: "lastModified" },                        //8
                            { data: "remark" },                              //9
                            { data: "isAnonymous" },                         //10
                            { data: "buttons" },                             //11
                        ],
                        "columnDefs": [
                            { targets: 1, type: 'de_time' },
                            { width: '4%', "targets": [0, 1] },
                            { width: '6%', "targets": [2, 3] },
                            { width: '15%', "targets": [4] },
                            { width: '2%', "targets": [5] },
                            { width: '5%', "targets": [6, 7, 8, 9] },
                            { width: '0%', "targets": [10] },
                            { width: '25%', "targets": [11] },
                            {
                                targets: 5, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => { //5 is driver column

                                    cell.className += ' driver_td';
                                    if (!rowData.hasDriver) {

                                        let ridePatTime_td;
                                        if (rowData['time'] === 'אחה"צ') {

                                            ridePatTime_td = [12, 0];
                                        } else {

                                            ridePatTime_td = $.trim(rowData['time']).split(':');
                                        }

                                        const hh = parseInt(ridePatTime_td[0]);
                                        const mm = parseInt(ridePatTime_td[1]);

                                        const suitableClass = classManager.getSuitableClassS_4thisTime("datatable-tomorrow-morning", hh, mm);
                                        $(cell).addClass(suitableClass);

                                    }
                                }
                            },
                            {
                                targets: 7, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => { //6 is status column
                                    if (cellData.indexOf("הגענו ליעד") !== -1 ||
                                        cellData.indexOf("Reached destination") !== -1) {

                                        $(cell).addClass('reached2destination');
                                    } else if (cellData.includes('שובץ נהג') || cellData.includes('Driver registered')) {

                                        if (rowData["isAnonymous"]) {

                                            $(cell.parentElement).addClass('driverAssign2AnonymousRide');
                                        }
                                    }
                                }
                            },
                            {
                                targets: 8, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => {//lastModified column

                                    const thisRidePatNum = rowData.ridePatNum;
                                    const thisridePatObj = arr_rides.find((r) => r.RidePatNum === thisRidePatNum);
                                    const intValue = convert2DBDateToInt(thisridePatObj.LastModified);//the reasone why we get the origial obj is to support pc with english date
                                    const thisRidePatLastModified = new Date(intValue)
                                    const isSeenAllReady = arrayOf_IHaveSeenAllready.includes(thisRidePatNum);

                                    if (isWithin2HoursSinceChange(thisRidePatLastModified) && !isSeenAllReady) {
                                        cell.classList.add('within2HoursSinceChange');
                                        increaseCounter(tableNames.TOMORROW_MORNING, thisRidePatNum);
                                    }
                                }
                            },
                            { targets: 8, className: 'last-modified_td' },
                            { targets: 8, type: 'last_modifiedSort' },
                            { targets: 9, className: 'text-right-strong' },
                            { targets: [10], visible: false },
                            { targets: [11], orderable: false }

                        ],
                        autoWidth: false,
                        createdRow: function (row, data, dataIndex) {

                            if (data.isPatientStatusShouldPaintRow) {

                                $(row).addClass("highlightRow-after-patientStatusModal");
                            }
                        },

                    });

                    tTomorrowAfternoon = $(`#${tableNames.TOMORROW_AFTERNOON}`).DataTable({
                        rowId: 'ridePatNum',
                        dom: controllersLayout,
                        buttons: [
                            {
                                extend: 'excelHtml5',
                                text: 'ייצוא לאקסל',
                                title: `ניהול הסעות למחר ${getNext_X_DaysDateAsString(1)}`,
                            }
                        ],
                        data: tomorrowAfternoonRidePats,
                        stateSave: true,
                        destroy: true,
                        "pageLength": 100,
                        columns: [
                            //when add column be aware of columnDefs refernces [i] IMPORTANT !!!
                            { data: "date" },                                //0
                            { data: "time" },                                //1
                            { data: "origin" },                              //2
                            { data: "destination" },                         //3
                            { data: "patient" },                             //4
                            { data: "patientAge" },                          //5
                            { data: "driver" },                              //6
                            { data: "status" },                              //7
                            { data: "lastModified" },                        //8
                            { data: "remark" },                              //9
                            { data: "isAnonymous" },                         //10
                            { data: "buttons" },                             //11
                        ],
                        "columnDefs": [
                            { targets: 1, type: 'de_time' },
                            { width: '4%', "targets": [0, 1] },
                            { width: '6%', "targets": [2, 3] },
                            { width: '15%', "targets": [4] },
                            { width: '2%', "targets": [5] },
                            { width: '5%', "targets": [6, 7, 8, 9] },
                            { width: '0%', "targets": [10] },
                            { width: '25%', "targets": [11] },
                            {
                                targets: 5, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => { //5 is driver column

                                    cell.className += ' driver_td';
                                    if (!rowData.hasDriver) {

                                        let ridePatTime_td;
                                        if (rowData['time'] === 'אחה"צ') {

                                            ridePatTime_td = [12, 0];
                                        } else {

                                            ridePatTime_td = $.trim(rowData['time']).split(':');
                                        }

                                        const hh = parseInt(ridePatTime_td[0]);
                                        const mm = parseInt(ridePatTime_td[1]);

                                        const suitableClass = classManager.getSuitableClassS_4thisTime("datatable-tomorrow-morning", hh, mm);
                                        $(cell).addClass(suitableClass);

                                    }
                                }
                            },
                            {
                                targets: 7, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => { //6 is status column
                                    if (cellData.indexOf("הגענו ליעד") !== -1 ||
                                        cellData.indexOf("Reached destination") !== -1) {

                                        $(cell).addClass('reached2destination');
                                    } else if (cellData.includes('שובץ נהג') || cellData.includes('Driver registered')) {

                                        if (rowData["isAnonymous"]) {

                                            $(cell.parentElement).addClass('driverAssign2AnonymousRide');
                                        }
                                    }
                                }
                            },
                            {
                                targets: 8, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => {//lastModified column

                                    const thisRidePatNum = rowData.ridePatNum;
                                    const thisridePatObj = arr_rides.find((r) => r.RidePatNum === thisRidePatNum);
                                    const intValue = convert2DBDateToInt(thisridePatObj.LastModified);//the reasone why we get the origial obj is to support pc with english date
                                    const thisRidePatLastModified = new Date(intValue)
                                    const isSeenAllReady = arrayOf_IHaveSeenAllready.includes(thisRidePatNum);

                                    if (isWithin2HoursSinceChange(thisRidePatLastModified) && !isSeenAllReady) {
                                        cell.classList.add('within2HoursSinceChange');
                                        increaseCounter(tableNames.TOMORROW_MORNING, thisRidePatNum);
                                    }
                                }
                            },
                            { targets: 8, className: 'last-modified_td' },
                            { targets: 8, type: 'last_modifiedSort' },
                            { targets: 9, className: 'text-right-strong' },
                            { targets: [10], visible: false },
                            { targets: [11], orderable: false }

                        ],
                        autoWidth: false,
                        createdRow: function (row, data, dataIndex) {

                            if (data.isPatientStatusShouldPaintRow) {

                                $(row).addClass("highlightRow-after-patientStatusModal");
                            }
                        },

                    });


                    tFuture = $(`#${tableNames.FUTURE}`).DataTable({
                        rowId: 'ridePatNum',
                        dom: controllersLayoutForFutureTable,
                        fnInitComplete: function (x) {
                            buildHtmlSelectTimeInterval();
                        },
                        buttons: [
                            {
                                extend: 'excelHtml5',
                                text: 'ייצוא לאקסל',
                                title: `ניהול הסעות עתידיות ${getNext_X_DaysDateAsString(2)} - ${getNext_X_DaysDateAsString(7)}`,
                            }
                        ],
                        data: futureRidePats,
                        stateSave: true,
                        destroy: true,
                        columns: [
                            //when add column be aware of columnDefs refernces [i] IMPORTANT !!!
                            { data: "date" },                                //0
                            { data: "time" },                                //1
                            { data: "origin" },                              //2
                            { data: "destination" },                         //3
                            { data: "patient" },                             //4
                            { data: "patientAge" },                          //5
                            { data: "driver" },                              //6
                            { data: "status" },                              //7
                            { data: "lastModified" },                        //8
                            { data: "remark" },                              //9
                            { data: "isAnonymous" },                         //10
                            { data: "buttons" },                             //11
                        ],
                        pageLength: 100,
                        columnDefs: [
                            { targets: 0, type: 'de_date' },
                            { targets: 1, type: 'de_time' },
                            { targets: 7, type: 'last_modifiedSort' },
                            { width: '4%', "targets": [0, 1] },
                            { width: '6%', "targets": [2, 3] },
                            { width: '10%', "targets": [4] },
                            { width: '2%', "targets": [5] },
                            { width: '5%', "targets": [6, 7, 8, 9] },
                            { width: '0%', "targets": [10] },
                            { width: '25%', "targets": [11] },
                            { targets: 5, className: 'driver_td' },
                            {
                                targets: 7, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => {//lastModified column

                                    const thisRidePatNum = rowData.ridePatNum;
                                    const thisridePatObj = arr_rides.find((r) => r.RidePatNum === thisRidePatNum);
                                    const intValue = convert2DBDateToInt(thisridePatObj.LastModified);
                                    const thisRidePatLastModified = new Date(intValue)
                                    const isSeenAllReady = arrayOf_IHaveSeenAllready.includes(thisRidePatNum);

                                    if (isWithin2HoursSinceChange(thisRidePatLastModified) && !isSeenAllReady) {
                                        cell.classList.add('within2HoursSinceChange');
                                        increaseCounter(tableNames.FUTURE, thisRidePatNum);
                                    }
                                }
                            },
                            { targets: 8, className: 'last-modified_td' },
                            { targets: 8, type: 'last_modifiedSort' },
                            { targets: [10], visible: false },
                            { targets: [11], orderable: false }
                        ],
                        autoWidth: false,
                        createdRow: function (row, data, dataIndex) {

                            if (data.isPatientStatusShouldPaintRow) {

                                $(row).addClass("highlightRow-after-patientStatusModal");
                            }
                        },
                    });

                    //            ============================
                    //            || ↑DATATABLES PROPERTIES↑||
                    //            ============================

                    //colorRowWithDriver(listRowstoColor);
                    colorRowBeige(listRowstoColor);
                    $(".dataTables_empty").html("אין הסעות لا توجد سفريات No drives");


                },
                error: function (err) {
                    $('#wait').hide();
                    alert("Error in GetRidePatView: " + err.responseText);
                }
            });
        }

        function refreshTable(timeInterval = 7) {
            $('#wait').show();

            morningRidePats = [];
            afterNoonRidePats = [];
            tomorrowMorningRidePats = [];
            tomorrowAfternoonRidePats = [];
            futureRidePats = [];

            let areasToShow_arr = JSON.parse(localStorage.getItem('areasToShow_arr'));
            let allSortsSwitch = JSON.parse(localStorage.getItem('allSortsSwitch'));

            checkCookie();

            if (areasToShow_arr !== null && areasToShow_arr.length === 0 && allSortsSwitch) { //dont show any
                $('#wait').hide();

                tMorning = $(`#${tableNames.MORNING}`).DataTable({ data: [], destroy: true });

                tAfternoon = $(`#${tableNames.AFTERNOON}`).DataTable({ data: [], destroy: true });

                tTomorrowMorning = $(`#${tableNames.TOMORROW_MORNING}`).DataTable({ data: [], destroy: true });

                tTomorrowAfternoon = $(`#${tableNames.TOMORROW_AFTERNOON}`).DataTable({ data: [], destroy: true });

                tFuture = $(`#${tableNames.FUTURE}`).DataTable({ data: [], destroy: true });
                return;
            }

            var volunteerId = -1 // VolunteerId - 1 means get ALL FUTURE ridePats // VolunteerId -2 means get ALL ridePats
            //gilad check
            //console.log('Gilad check this regular refresh* -->', volunteerId, timeInterval)
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/GetRidePatView",
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Content-Encoding", "gzip");
                },
                type: "POST",
                data: JSON.stringify({ volunteerId: volunteerId, maxDays: timeInterval }),
                success: function (data) {
                    $('#wait').hide();
                    arr_rides = JSON.parse(data.d);
                    //console.log('Gilad check this -->', arr_rides)
                    GENERAL.RIDEPAT.setRidePatList(JSON.stringify(arr_rides));

                    let thisRidePatDate;
                    let thisRidePat = {};
                    let editBtn;
                    let deleteBtn;
                    let messageToCopyBtn;
                    let candidateBtn;
                    let btnStr = '';
                    //     let lastModified = convertDBDate2FrontEndDate(arr_rides[i].LastModified).toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" });
                    let numOfRealEscorts = 0; //not anonymous
                    let driverColumnContent = '';
                    let englishStatus = '';
                    let patientHTML;
                    let driverHTML;
                    let status2render;
                    let timeHTML;
                    let patientGender = null;
                    let patientAge = null;
                    let isPatientStatusShouldPaintRow = false;
                    let remarkHTML = '';
                    listRowstoColor = [];

                    
                    for (let i = 0; i < arr_rides.length; i++) {
                        if (arr_rides[i].Status=='שובץ נהג') {
                            //console.log(arr_rides[i], document.getElementById(arr_rides[i].RidePatNum), $(`#${arr_rides[i].RidePatNum}`));
                            listRowstoColor.push(arr_rides[i].RidePatNum);
        
                        }

                        if (allSortsSwitch && areasToShow_arr !== null) {
                            if (areasToShow_arr.length !== 0) {
                                if (!areasToShow_arr.includes(arr_rides[i].Area)) {
                                    continue;
                                }
                            }
                        }
                        thisRidePatDate = convertDBDate2FrontEndDate(arr_rides[i].Date);
                        timeHTML = buildTimeHTML(thisRidePatDate, arr_rides[i].RidePatNum);
                        numOfEscorts = arr_rides[i].Escorts.length;

                        //#region adjust patient column
                        patientHTML = buildPatientHTML(arr_rides[i]);
                        //#endregion

                        //#region adjust driver column
                        driverHTML = '';

                        if (arr_rides[i].Drivers.length > 0) {

                            driverHTML = buildDriverHTML(arr_rides[i].RidePatNum, arr_rides[i].Drivers[0], arr_rides[i].RideNum);
                        } else {

                            driverHTML = buildDriverHTML(arr_rides[i].RidePatNum);
                        }
                        //#endregion adjust driver column

                        //#region Status
                        status2render = buildStatusString(arr_rides[i].Pat.RidePatPatientStatus, arr_rides[i].RidePatNum);
                        //#endregion Status

                        //#region remarkHTML
                        remarkHTML = buildRemarkHTML(arr_rides[i].Remark, arr_rides[i].RidePatNum);
                        //#endregion remarkHTML

                        //#region patient age
                        patientAge = buildPatientAgeHTML(arr_rides[i].Pat);
                        //#endregion


                        //#region buttons
                        btnStr = buildAcionsButtonsHTML(arr_rides[i].RidePatNum, arr_rides[i].Drivers)
                        //#endregion buttons

                        //#region isPatientStatusShouldPaintRow
                        isPatientStatusShouldPaintRow = callIfPatientStatusShouldPaintRow(arr_rides[i]);
                        //#endregion isPatientStatusShouldPaintRow

                        thisRidePat = {
                            ridePatNum: arr_rides[i].RidePatNum,
                            time: timeHTML,
                            origin: isAssistant ? arr_rides[i].Origin.EnglishName : arr_rides[i].Origin.Name,
                            destination: isAssistant ? arr_rides[i].Destination.EnglishName : arr_rides[i].Destination.Name,
                            patient: patientHTML,
                            patientAge: patientAge,
                            driver: driverHTML,
                            status: status2render,
                            lastModified: convertDBDate2FrontEndDate(arr_rides[i].LastModified).toLocaleString('he-IL', { dateStyle: "short", timeStyle: "short" }),
                            remark: remarkHTML,
                            isAnonymous: arr_rides[i].Pat.IsAnonymous === 'True',
                            hasDriver: arr_rides[i].Drivers.length > 0,
                            buttons: btnStr,
                            isPatientStatusShouldPaintRow: isPatientStatusShouldPaintRow,
                        }

                        if (thisRidePatDate.toLocaleDateString() === new Date().toLocaleDateString()) {                         //<---- today
                            if (thisRidePatDate.getHours() < 12) {                                                              //<---- today morning

                                morningRidePats.push(thisRidePat);
                            } else {                                                                                           //<---- today afternoon

                                afterNoonRidePats.push(thisRidePat);
                            }

                        } else if (thisRidePatDate.toLocaleDateString() === tomorrowDate.toLocaleDateString()) {              //<---- tomorrow

                            if (thisRidePatDate.getHours() < 12) {                                                           //<---- tomorrow morning
                                thisRidePat.date = thisRidePatDate.toLocaleString('he-IL', { dateStyle: 'short' });

                                tomorrowMorningRidePats.push(thisRidePat);
                            } else {                                                                                         //<---- tomorrow afternoon
                                thisRidePat.date = thisRidePatDate.toLocaleString('he-IL', { dateStyle: 'short' });

                                tomorrowAfternoonRidePats.push(thisRidePat);
                            }

                        } else if (thisRidePatDate > tomorrowDate) {                                                         //<---- future

                            thisRidePat.date = thisRidePatDate.toLocaleString('he-IL', { dateStyle: 'short' });
                            futureRidePats.push(thisRidePat);
                        }

                    }
                    let arrayOf_IHaveSeenAllready = localStorage.getItem('arrayOf_IHaveSeenAllready') ?
                        JSON.parse(localStorage.getItem('arrayOf_IHaveSeenAllready'))
                        :
                        [];

                    //           ============================
                    //           || ↓DATATABLES PROPERTIES↓||
                    //           ============================

                    tMorning = $(`#${tableNames.MORNING}`).DataTable({
                        data: morningRidePats,
                        rowId: 'ridePatNum',
                        dom: controllersLayout,
                        buttons: [
                            {
                                extend: 'excelHtml5',
                                text: 'ייצוא לאקסל',
                                title: `ניהול הסעות - בוקר ${getNext_X_DaysDateAsString(0)}`,
                            }
                        ],
                        pageLength: 100,
                        stateSave: true,
                        destroy: true,
                        autoWidth: false,
                        columns: [
                            //when add column be aware of columnDefs refernces [i] IMPORTANT !!!
                            { data: "time" },                                //0
                            { data: "origin" },                              //1
                            { data: "destination" },                         //2
                            { data: "patient" },                             //3
                            { data: "patientAge" },                          //4
                            { data: "driver" },                              //5
                            { data: "status" },                              //6
                            { data: "lastModified" },                        //7
                            { data: "remark" },                              //8
                            { data: "isAnonymous" },                         //9
                            { data: "buttons" },                             //10
                        ],
                        columnDefs: [
                            { width: '5%', "targets": [0, 1, 2, 5, 6, 7] },
                            { width: '2%', "targets": [4] },
                            { width: '15%', "targets": [3] },
                            { width: '25%', "targets": [9] },
                            { targets: 0, type: 'de_time' },
                            {
                                targets: [1, 2, 3, 5, 6, 7], createdCell: (cell, cellData, rowData, rowIndex, colIndex) => {
                                    if (isAssistant) {
                                        cell.className += ' ltr';
                                    }

                                    switch (colIndex) {
                                        case 5: //driver column

                                            $(cell).addClass('driver_td');
                                            if (!rowData.hasDriver) {
                                                const suitableClass = classManager.getSuitableClassS_4thisTime("datatable-morning");
                                                $(cell).addClass(suitableClass);
                                            }
                                            break;

                                        case 6://status column
                                            if (
                                                cellData.indexOf("הגענו ליעד") !== -1 ||
                                                cellData.indexOf("Reached destination") !== -1
                                            ) {
                                                cell.style.backgroundColor = "green";
                                                cell.style.color = "white";
                                            }
                                            else if (cellData.includes('שובץ נהג') || cellData.includes('Driver registered')) {

                                                if (rowData["isAnonymous"]) {
                                                    $(cell.parentElement).addClass('driverAssign2AnonymousRide');
                                                }
                                            }
                                            break;
                                        case 7://lastModified column

                                            const thisRidePatNum = rowData.ridePatNum;
                                            const thisridePatObj = arr_rides.find((r) => r.RidePatNum === thisRidePatNum);
                                            const intValue = convert2DBDateToInt(thisridePatObj.LastModified);//the reasone why we get the origial obj is to support pc with english date
                                            const thisRidePatLastModified = new Date(intValue)
                                            const isSeenAllReady = arrayOf_IHaveSeenAllready.includes(thisRidePatNum);

                                            if (isWithin2HoursSinceChange(thisRidePatLastModified) && !isSeenAllReady) {
                                                cell.classList.add('within2HoursSinceChange');
                                                increaseCounter(tableNames.MORNING, thisRidePatNum);
                                            }
                                            break;

                                    }

                                }
                            },
                            { targets: 7, className: 'last-modified_td' },
                            { targets: 7, type: 'last_modifiedSort' },
                            { "targets": [9], visible: false },
                            { targets: [10], orderable: false }

                        ],
                        createdRow: function (row, data, dataIndex) {

                            if (data.isPatientStatusShouldPaintRow) {

                                $(row).addClass("highlightRow-after-patientStatusModal");
                            }
                        },
                    });

                    tAfternoon = $(`#${tableNames.AFTERNOON}`).DataTable({
                        rowId: 'ridePatNum',
                        dom: controllersLayout,
                        buttons: [
                            {
                                extend: 'excelHtml5',
                                text: 'ייצוא לאקסל',
                                title: `ניהול הסעות -  אחה"צ ${getNext_X_DaysDateAsString(0)}`,
                            }
                        ],
                        pageLength: 100,
                        data: afterNoonRidePats,
                        stateSave: true,
                        destroy: true,
                        columns: [
                            //when add column be aware of columnDefs refernces [i] IMPORTANT !!!
                            { data: "time" },                                //0
                            { data: "origin" },                              //1
                            { data: "destination" },                         //2
                            { data: "patient" },                             //3
                            { data: "patientAge" },                          //4
                            { data: "driver" },                              //5
                            { data: "status" },                              //6
                            { data: "lastModified" },                        //7
                            { data: "remark" },                              //8
                            { data: "isAnonymous" },                         //9
                            { data: "buttons" },                             //10
                        ],
                        columnDefs: [
                            { width: '5%', "targets": [0, 1, 2, 5, 6, 7, 8] },
                            { width: '2%', "targets": [4] },
                            { width: '15%', "targets": [3] },
                            { width: '25%', "targets": [10] },
                            { targets: 0, type: 'de_time' },
                            { targets: [0], createdCell: (td) => { $(td).attr('id', 'rideTiming') } },
                            {
                                targets: [1, 2, 3, 5, 6, 7], createdCell: (cell, cellData, rowData, rowIndex, colIndex) => {
                                    if (isAssistant) {
                                        cell.className += ' ltr';
                                    }

                                    switch (colIndex) {

                                        case 1: //origin
                                            $(cell).attr('id', 'OriginName');
                                            if (cellData.indexOf('מרכז') !== -1
                                                || cellData.indexOf('center') !== -1
                                                || rowData['destination'].indexOf('מרכז') !== -1
                                                || rowData['destination'].indexOf('center') !== -1
                                            ) {
                                                $(cell.parentElement).addClass('driverAssign2AnonymousRide');
                                            }
                                            break;

                                        case 2://destination
                                            createdCell: (td) => { $(td).attr('id', 'DestinationName') }
                                            break;

                                        case 5: //driver
                                            //this code is identical to the one in datatable-tomorrow-morning when can need to change to 1 function
                                            $(cell).addClass('driver_td');
                                            if (!rowData.hasDriver) {

                                                let ridePatTime_td;
                                                if (rowData['time'] === 'אחה"צ') {

                                                    ridePatTime_td = [12, 0];
                                                } else {

                                                    ridePatTime_td = $.trim(rowData['time']).split(':');
                                                }

                                                const hh = parseInt(ridePatTime_td[0]);
                                                const mm = parseInt(ridePatTime_td[1]);

                                                const suitableClass = classManager.getSuitableClassS_4thisTime("datatable-afternoon", hh, mm);
                                                $(cell).addClass(suitableClass);

                                            }
                                            break;

                                        case 6://status
                                            if (cellData.indexOf("הגענו ליעד") !== -1 ||
                                                cellData.indexOf("Reached destination") !== -1) {

                                                $(cell).addClass('reached2destination');
                                            } else if (cellData.includes('שובץ נהג') || cellData.includes('Driver registered')) {

                                                if (rowData["isAnonymous"]) {

                                                    $(cell.parentElement).addClass('driverAssign2AnonymousRide');
                                                }
                                            }
                                            break;
                                        case 7://lastModified column

                                            const thisRidePatNum = rowData.ridePatNum;
                                            const thisridePatObj = arr_rides.find((r) => r.RidePatNum === thisRidePatNum);
                                            const intValue = convert2DBDateToInt(thisridePatObj.LastModified);//the reasone why we get the origial obj is to support pc with english date
                                            const thisRidePatLastModified = new Date(intValue)
                                            const isSeenAllReady = arrayOf_IHaveSeenAllready.includes(thisRidePatNum);

                                            if (isWithin2HoursSinceChange(thisRidePatLastModified) && !isSeenAllReady) {
                                                cell.classList.add('within2HoursSinceChange');
                                                increaseCounter(tableNames.AFTERNOON, thisRidePatNum);
                                            }
                                            break;

                                    }

                                }
                            },
                            { targets: 7, className: 'last-modified_td' },
                            { targets: 7, type: 'last_modifiedSort' },
                            { targets: [9], visible: false },
                            { targets: [10], orderable: false }
                        ],
                        autoWidth: false,
                        createdRow: function (row, data, dataIndex) {

                            if (data.isPatientStatusShouldPaintRow) {

                                $(row).addClass("highlightRow-after-patientStatusModal");
                            }
                        },
                    });

                    tTomorrowMorning = $(`#${tableNames.TOMORROW_MORNING}`).DataTable({
                        rowId: 'ridePatNum',
                        dom: controllersLayout,
                        buttons: [
                            {
                                extend: 'excelHtml5',
                                text: 'ייצוא לאקסל',
                                title: `ניהול הסעות למחר ${getNext_X_DaysDateAsString(1)}`,
                            }
                        ],
                        data: tomorrowMorningRidePats,
                        stateSave: true,
                        destroy: true,
                        "pageLength": 100,
                        columns: [
                            //when add column be aware of columnDefs refernces [i] IMPORTANT !!!
                            { data: "date" },                                //0
                            { data: "time" },                                //1
                            { data: "origin" },                              //2
                            { data: "destination" },                         //3
                            { data: "patient" },                             //4
                            { data: "patientAge" },                          //5
                            { data: "driver" },                              //6
                            { data: "status" },                              //7
                            { data: "lastModified" },                        //8
                            { data: "remark" },                              //9
                            { data: "isAnonymous" },                         //10
                            { data: "buttons" },                             //11
                        ],
                        "columnDefs": [
                            { targets: 1, type: 'de_time' },
                            { width: '4%', "targets": [0, 1] },
                            { width: '6%', "targets": [2, 3] },
                            { width: '15%', "targets": [4] },
                            { width: '2%', "targets": [5] },
                            { width: '5%', "targets": [6, 7, 8, 9] },
                            { width: '0%', "targets": [10] },
                            { width: '25%', "targets": [11] },
                            {
                                targets: 5, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => { //5 is driver column

                                    cell.className += ' driver_td';
                                    if (!rowData.hasDriver) {

                                        let ridePatTime_td;
                                        if (rowData['time'] === 'אחה"צ') {

                                            ridePatTime_td = [12, 0];
                                        } else {

                                            ridePatTime_td = $.trim(rowData['time']).split(':');
                                        }

                                        const hh = parseInt(ridePatTime_td[0]);
                                        const mm = parseInt(ridePatTime_td[1]);

                                        const suitableClass = classManager.getSuitableClassS_4thisTime("datatable-tomorrow-morning", hh, mm);
                                        $(cell).addClass(suitableClass);

                                    }
                                }
                            },
                            {
                                targets: 7, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => { //6 is status column
                                    if (cellData.indexOf("הגענו ליעד") !== -1 ||
                                        cellData.indexOf("Reached destination") !== -1) {

                                        $(cell).addClass('reached2destination');
                                    } else if (cellData.includes('שובץ נהג') || cellData.includes('Driver registered')) {

                                        if (rowData["isAnonymous"]) {

                                            $(cell.parentElement).addClass('driverAssign2AnonymousRide');
                                        }
                                    }
                                }
                            },
                            {
                                targets: 8, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => {//lastModified column

                                    const thisRidePatNum = rowData.ridePatNum;
                                    const thisridePatObj = arr_rides.find((r) => r.RidePatNum === thisRidePatNum);
                                    const intValue = convert2DBDateToInt(thisridePatObj.LastModified);//the reasone why we get the origial obj is to support pc with english date
                                    const thisRidePatLastModified = new Date(intValue)
                                    const isSeenAllReady = arrayOf_IHaveSeenAllready.includes(thisRidePatNum);

                                    if (isWithin2HoursSinceChange(thisRidePatLastModified) && !isSeenAllReady) {
                                        cell.classList.add('within2HoursSinceChange');
                                        increaseCounter(tableNames.TOMORROW_MORNING, thisRidePatNum);
                                    }
                                }
                            },
                            { targets: 8, className: 'last-modified_td' },
                            { targets: 8, type: 'last_modifiedSort' },
                            { targets: 9, className: 'text-right-strong' },
                            { targets: [10], visible: false },
                            { targets: [11], orderable: false }

                        ],
                        autoWidth: false,
                        createdRow: function (row, data, dataIndex) {

                            if (data.isPatientStatusShouldPaintRow) {

                                $(row).addClass("highlightRow-after-patientStatusModal");
                            }
                        },

                    });

                    tTomorrowAfternoon = $(`#${tableNames.TOMORROW_AFTERNOON}`).DataTable({
                        rowId: 'ridePatNum',
                        dom: controllersLayout,
                        buttons: [
                            {
                                extend: 'excelHtml5',
                                text: 'ייצוא לאקסל',
                                title: `ניהול הסעות למחר ${getNext_X_DaysDateAsString(1)}`,
                            }
                        ],
                        data: tomorrowAfternoonRidePats,
                        stateSave: true,
                        destroy: true,
                        "pageLength": 100,
                        columns: [
                            //when add column be aware of columnDefs refernces [i] IMPORTANT !!!
                            { data: "date" },                                //0
                            { data: "time" },                                //1
                            { data: "origin" },                              //2
                            { data: "destination" },                         //3
                            { data: "patient" },                             //4
                            { data: "patientAge" },                          //5
                            { data: "driver" },                              //6
                            { data: "status" },                              //7
                            { data: "lastModified" },                        //8
                            { data: "remark" },                              //9
                            { data: "isAnonymous" },                         //10
                            { data: "buttons" },                             //11
                        ],
                        "columnDefs": [
                            { targets: 1, type: 'de_time' },
                            { width: '4%', "targets": [0, 1] },
                            { width: '6%', "targets": [2, 3] },
                            { width: '15%', "targets": [4] },
                            { width: '2%', "targets": [5] },
                            { width: '5%', "targets": [6, 7, 8, 9] },
                            { width: '0%', "targets": [10] },
                            { width: '25%', "targets": [11] },
                            {
                                targets: 5, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => { //5 is driver column

                                    cell.className += ' driver_td';
                                    if (!rowData.hasDriver) {

                                        let ridePatTime_td;
                                        if (rowData['time'] === 'אחה"צ') {

                                            ridePatTime_td = [12, 0];
                                        } else {

                                            ridePatTime_td = $.trim(rowData['time']).split(':');
                                        }

                                        const hh = parseInt(ridePatTime_td[0]);
                                        const mm = parseInt(ridePatTime_td[1]);

                                        const suitableClass = classManager.getSuitableClassS_4thisTime("datatable-tomorrow-morning", hh, mm);
                                        $(cell).addClass(suitableClass);

                                    }
                                }
                            },
                            {
                                targets: 7, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => { //6 is status column
                                    if (cellData.indexOf("הגענו ליעד") !== -1 ||
                                        cellData.indexOf("Reached destination") !== -1) {

                                        $(cell).addClass('reached2destination');
                                    } else if (cellData.includes('שובץ נהג') || cellData.includes('Driver registered')) {

                                        if (rowData["isAnonymous"]) {

                                            $(cell.parentElement).addClass('driverAssign2AnonymousRide');
                                        }
                                    }
                                }
                            },
                            {
                                targets: 8, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => {//lastModified column

                                    const thisRidePatNum = rowData.ridePatNum;
                                    const thisridePatObj = arr_rides.find((r) => r.RidePatNum === thisRidePatNum);
                                    const intValue = convert2DBDateToInt(thisridePatObj.LastModified);//the reasone why we get the origial obj is to support pc with english date
                                    const thisRidePatLastModified = new Date(intValue)
                                    const isSeenAllReady = arrayOf_IHaveSeenAllready.includes(thisRidePatNum);

                                    if (isWithin2HoursSinceChange(thisRidePatLastModified) && !isSeenAllReady) {
                                        cell.classList.add('within2HoursSinceChange');
                                        increaseCounter(tableNames.TOMORROW_MORNING, thisRidePatNum);
                                    }
                                }
                            },
                            { targets: 8, className: 'last-modified_td' },
                            { targets: 8, type: 'last_modifiedSort' },
                            { targets: 9, className: 'text-right-strong' },
                            { targets: [10], visible: false },
                            { targets: [11], orderable: false }

                        ],
                        autoWidth: false,
                        createdRow: function (row, data, dataIndex) {

                            if (data.isPatientStatusShouldPaintRow) {

                                $(row).addClass("highlightRow-after-patientStatusModal");
                            }
                        },

                    });


                    tFuture = $(`#${tableNames.FUTURE}`).DataTable({
                        rowId: 'ridePatNum',
                        dom: controllersLayoutForFutureTable,
                        fnInitComplete: function (x) {
                            buildHtmlSelectTimeInterval();
                        },
                        buttons: [
                            {
                                extend: 'excelHtml5',
                                text: 'ייצוא לאקסל',
                                title: `ניהול הסעות עתידיות ${getNext_X_DaysDateAsString(2)} - ${getNext_X_DaysDateAsString(7)}`,
                            }
                        ],
                        data: futureRidePats,
                        stateSave: true,
                        destroy: true,
                        columns: [
                            //when add column be aware of columnDefs refernces [i] IMPORTANT !!!
                            { data: "date" },                                //0
                            { data: "time" },                                //1
                            { data: "origin" },                              //2
                            { data: "destination" },                         //3
                            { data: "patient" },                             //4
                            { data: "patientAge" },                          //5
                            { data: "driver" },                              //6
                            { data: "status" },                              //7
                            { data: "lastModified" },                        //8
                            { data: "remark" },                              //9
                            { data: "isAnonymous" },                         //10
                            { data: "buttons" },                             //11
                        ],
                        pageLength: 100,
                        columnDefs: [
                            { targets: 0, type: 'de_date' },
                            { targets: 1, type: 'de_time' },
                            { targets: 7, type: 'last_modifiedSort' },
                            { width: '4%', "targets": [0, 1] },
                            { width: '6%', "targets": [2, 3] },
                            { width: '10%', "targets": [4] },
                            { width: '2%', "targets": [5] },
                            { width: '5%', "targets": [6, 7, 8, 9] },
                            { width: '0%', "targets": [10] },
                            { width: '25%', "targets": [11] },
                            { targets: 5, className: 'driver_td' },
                            {
                                targets: 7, createdCell: (cell, cellData, rowData, rowIndex, colIndex) => {//lastModified column

                                    const thisRidePatNum = rowData.ridePatNum;
                                    const thisridePatObj = arr_rides.find((r) => r.RidePatNum === thisRidePatNum);
                                    const intValue = convert2DBDateToInt(thisridePatObj.LastModified);
                                    const thisRidePatLastModified = new Date(intValue)
                                    const isSeenAllReady = arrayOf_IHaveSeenAllready.includes(thisRidePatNum);

                                    if (isWithin2HoursSinceChange(thisRidePatLastModified) && !isSeenAllReady) {
                                        cell.classList.add('within2HoursSinceChange');
                                        increaseCounter(tableNames.FUTURE, thisRidePatNum);
                                    }
                                }
                            },
                            { targets: 8, className: 'last-modified_td' },
                            { targets: 8, type: 'last_modifiedSort' },
                            { targets: [10], visible: false },
                            { targets: [11], orderable: false }
                        ],
                        autoWidth: false,
                        createdRow: function (row, data, dataIndex) {

                            if (data.isPatientStatusShouldPaintRow) {

                                $(row).addClass("highlightRow-after-patientStatusModal");
                            }
                        },
                    });

                    //            ============================
                    //            || ↑DATATABLES PROPERTIES↑||
                    //            ============================

                    colorRowWithDriver(listRowstoColor);
                    $(".dataTables_empty").html("אין הסעות لا توجد سفريات No drives");


                },
                error: function (err) {
                    $('#wait').hide();
                    alert("Error in GetRidePatView: " + err.responseText);
                }
            });
        }
        function findRideByNumber(rideNumber) {
            // Iterate through each ride object in the array
            for (let i = 0; i < arr_rides.length; i++) {
                const ride = arr_rides[i];
                // Check if the ride number matches the provided rideNumber
                if (ride.RidePatNum === rideNumber) {
                    // Return the ride object if found
                    return ride;
                }
            }
            // If the ride is not found, return null or handle it as needed
            return null;
        }

        //gilad
        const colorRowWithDriver = (rideArray) => {
            
            if (rideArray.length==0) {
                return;
            }
            rideArray.forEach(rideID => {
                //console.log('Gilad--->', document.getElementById(rideID), rideID);
                if (document.getElementById(rideID) == null) {
                    return
                }
                let timespan = ''
                let PatientNameSpan = '';
                if (document.getElementById(rideID).children[0].children.length == 0) {
                    timespan = document.getElementById(rideID).children[1].children[0].children[0].innerHTML
                    PatientNameSpan = document.getElementById(rideID).children[4].children[0].innerHTML

                  
                }
                else {
                    timespan = document.getElementById(rideID).children[0].children[0].children[0].innerHTML;
                    PatientNameSpan = document.getElementById(rideID).children[3].children[0].innerHTML

                }
                let thisRide = findRideByNumber(rideID);

                console.log('checking:', 'timespan:', timespan, 'PatientNameSpan: ', PatientNameSpan, 'The Ride:', thisRide);
                if (timespan != 'אחה"צ' && PatientNameSpan != 'חולה' && thisRide.MainDriver!=-1) {
                    $(`#${rideID}`).addClass('statusComplete');
                }
                else if (timespan == 'אחה"צ' || PatientNameSpan == 'חולה' || thisRide.MainDriver==-1) {
                    $(`#${rideID}`).removeClass('statusComplete');

                }
            })
        }
        const colorRowBeige = (rideArray) => {
            rideArray.forEach(rideID => {
                $(`#${rideID}`).addClass('statusComplete');
            })
        }

        const callIfPatientStatusShouldPaintRow_AfterUnited = (ride) => {

            let result = false;
            //const status = ride.Pat.RidePatPatientStatus.Status;
            const status = ride.PatientStatus == 'Finished' ? 1 : -1;
            treatmentFinished = status === patientStatus.Finished;

            //const driverIsAssigned = ride.Drivers.length > 0;
            const driverIsAssigned = ride.MainDriver != -1;

            const thisRidePatDate = convertDBDate2FrontEndDate(ride.PickupTime);
            let isAfterNoonRide = false;

            if (typeof thisRidePatDate !== undefined) {

                if (isDate(thisRidePatDate)) {
                    isAfterNoonRide = thisRidePatDate.getMinutes() === afternoonIndicator;
                }
            }

            if (treatmentFinished && ((!driverIsAssigned) || (driverIsAssigned && isAfterNoonRide))) {

                result = true;
            }

            return result;
        }
        
        const callIfPatientStatusShouldPaintRow = (ride) => {

            let result = false;
            const status = ride.Pat.RidePatPatientStatus.Status;
            treatmentFinished = status === patientStatus.Finished;

            const driverIsAssigned = ride.Drivers.length > 0;

            const thisRidePatDate = convertDBDate2FrontEndDate(ride.Date);
            let isAfterNoonRide = false;

            if (typeof thisRidePatDate !== undefined) {

                if (isDate(thisRidePatDate)) {
                    isAfterNoonRide = thisRidePatDate.getMinutes() === afternoonIndicator;
                }
            }

            if (treatmentFinished && ((!driverIsAssigned) || (driverIsAssigned && isAfterNoonRide))) {

                result = true;
            }

            return result;
        }


        const buildPatientAgeHTML_AfterUnited = (patient) => {

            let age = '';
            const boy = 'בן ', girl = 'בת ';
            const gender = GetPatientGender(patient.GenderAsEnum, isAssistant)
            const isMaleHebrew = gender === maleInHebrew;
            const isMaleEnglish = gender === male;

            if (gender.length === 0 && IsNullOrUndefined(patient.Age)) {
                return '';
            }

            if (IsNullOrUndefined(patient.Age)) {

                let result = '';

                if (!isAssistant) {

                    result = isMaleHebrew ? boy : girl;
                } else {

                    result = isMaleEnglish ? male : female;
                }

                return result;
            }

            if (patient.IsAnonymous !== true) {
                const isGenderEmpty = gender === '';
                age = '<span>'

                if (!isAssistant) {

                    age += isMaleHebrew ? boy : gender === femaleInHebrew ? girl : '';
                }
                else {

                    age += isMaleEnglish ? 'his age ' : gender === female ? 'her age ' : '';
                }

                age += patient.Age;
                age += '</span>';
            }
            //let ageNumber = patient.Age == 0 ? '' : patient.Age;
            if (patient.GenderAsEnum == -1 && !patient.IsAnonymous) {

                
                    age = `<span>בגיל ${patient.Age}</span>`;
               
            }

            if (patient.Age == 1) {
                
                if (patient.GenderAsEnum == -1) {
                    age = `<span>בגיל שנה</span>`;
                }
                else if (patient.GenderAsEnum == 0) {
                    age = `<span>בת שנה</span>`;
                }
                else if (patient.GenderAsEnum == 1) {
                    age = `<span>בן שנה</span>`;
                }

            }
            if (patient.Age == 0 || patient.IsAnonymous) {
                age = `<span></span>`;
            }
            //console.log(patient)

            return age;
        }
        const buildPatientAgeHTML = (patient) => {
            console.log('use me ? ');

            let age = '';
            const boy = 'בן ', girl = 'בת ';
            const gender = GetPatientGender(patient.GenderAsEnum, isAssistant)
            const isMaleHebrew = gender === maleInHebrew;
            const isMaleEnglish = gender === male;

            if (gender.length === 0 && IsNullOrUndefined(patient.Age)) {
                return '';
            }

            if (IsNullOrUndefined(patient.Age)) {

                let result = '';

                if (!isAssistant) {

                    result = isMaleHebrew ? boy : girl;
                } else {

                    result = isMaleEnglish ? male : female;
                }

                return result;
            }

            if (patient.IsAnonymous !== 'True') {
                const isGenderEmpty = gender === '';
                age = '<span>'

                if (!isAssistant) {

                    age += isMaleHebrew ? boy : gender === femaleInHebrew ? girl : '';
                }
                else {

                    age += isMaleEnglish ? 'his age ' : gender === female ? 'her age ' : '';
                }

                age += patient.Age;
                age += '</span>';
            }


            return age;
        }

        const buildHtmlSelectTimeInterval = () => {

            const container = document.querySelector('#future-table-time-interval-container');
            const intervals = ["טווח זמן", "שבוע", "שבועיים", "חודש"];
            const selectList = document.createElement("select");
            selectList.id = 'future-table-time-interval-select';
            $(selectList).addClass('select-box');

            for (var i = 0; i < intervals.length; i++) {
                const option = document.createElement("option");
                option.value = intervals[i];
                option.text = intervals[i];
                selectList.appendChild(option);
            }
            selectList.onchange = loadFutureTable;
            container.appendChild(selectList);
            selectList.value = _timeinterval_G;

        }

        const loadFutureTable = () => {
           
            const selectList = document.querySelector('#future-table-time-interval-select');
            let timeInterval = selectList.value;
            _timeinterval_G = timeInterval;
            switch (timeInterval) {
                case 'שבוע':
                    timeInterval = 7;
                    break;
                case 'שבועיים':
                    timeInterval = 14;
                    break;
                case 'חודש':
                    timeInterval = 30;
                    break;
                case 'טווח זמן':
                    timeInterval = 7;
                    break;
                default:
                    timeInterval = 7;
                    break
            }
            localStorage.setItem('timeInterval', _timeinterval_G);

            refreshTable_UnityRide(timeInterval);
        }

       


        const buildDriverHTML = (ridePatNum, driver, rideNum) => {
            let driverWrapper = '';
            let isDriverReplacement;
            //console.log('this is what i got -->', ridePatNum, driver, rideNum)
            if (typeof driver !== 'undefined' && typeof rideNum !== 'undefined') {

                isDriverReplacement = true;
                let driverInnerContent = '';
                const { Id, DisplayName, EnglishFN, EnglishLN, CellPhone, NoOfDocumentedRides, IsNewDriver } = driver;

                if (!isAssistant) {                         //hebrew

                    driverInnerContent = DisplayName;
                } else {                                    //english

                    driverInnerContent = EnglishFN.length + EnglishLN.length > 0 ?
                        `${EnglishFN} ${EnglishLN}`
                        :
                        DisplayName
                }

                driverWrapper = IsNewDriver ? `<span class='purpleFont boldFont'>${newVolunteerText}</span>` : ``;
                driverWrapper += `<a href="volunteerform.html" data-obj="volunteer" class="showMe driverName clickable blueFont boldFont"`;
                driverWrapper += `id='${Id}'>${driverInnerContent}</a>`;
                driverWrapper += `<span class="driverCellPhone">${addSeperator2MobileNum(CellPhone, '-')}</span>`;
                driverWrapper += `<button onclick="prepreparationAssignDriverModal(this, ${ridePatNum}, ${isDriverReplacement}, ${rideNum}, ${Id})" data-toggle="modal" data-target="#assignDriverModal" class='btn add-driver'>עדכון נהג</button>`;
                driverWrapper += '</div>';
            } else {

                isDriverReplacement = false;
                driverWrapper = `<div class='elementsInSameLine'>`;
                //let nodriverSpan = '<span class="verticalAllign">';
                //nodriverSpan += isAssistant ? noDriver.english : noDriver.hebrew;
                //nodriverSpan += '</span>';
                //driverWrapper += nodriverSpan;
                driverWrapper += `<buttond onclick="prepreparationAssignDriverModal(this, ${ridePatNum}, ${isDriverReplacement})"  data-toggle="modal" data-target="#assignDriverModal" class='btn add-driver'>שיבוץ נהג</button></div>`;
            }

            return driverWrapper;
        }

        //this is for check after gilad changes to united tabels with new api 3/12
        const buildPatientHTML_AfterUnited = (ridepat) => {

            let patientPhone2render = "";
            let numOfEscorts = ridepat.AmountOfEscorts;
            let numOfPassengers = '<span class="numOfPassengers">נוסע יחיד</span>';
            let numOfPassengers_English =
                '<span class="numOfPassengers">single passenger</span>';
            let escortsPhone2render = "";
            let equipmentsAndnumOfPassengers = "";

            if (validateMobileNumFullVersion(ridepat.PatientCellPhone)) {
                patientPhone2render = `<span class="patientPhone2render">${addSeperator2MobileNum(
                    ridepat.PatientCellPhone,
                    "-"
                )}</span>`;
            }

            if (numOfEscorts > 0) {

                numOfPassengers = `<span class="numOfPassengers">${numOfEscorts + (ridepat.OnlyEscort ? 0 : 1)//+1 is the patient himself
                    } נוסעים</span>`;
                numOfPassengers_English = `<span class="numOfPassengers">${numOfEscorts + (ridepat.OnlyEscort ? 0 : 1)
                    } passengers</span>`;



                // Gilad comment out it --> avraham doesnt want the phone Number of Escorts its no needed !!
                //escortsPhone2render = '<span class="escortsPhone2render block">מלווים: ';
                numOfRealEscorts = 0;

                //ridepat.Escorts.map((es, i) => {
                //    if (validateMobileNumFullVersion(es.CellPhone)) {
                //        numOfRealEscorts++;
                //        escortsPhone2render += `${addSeperator2MobileNum(
                //            es.CellPhone,
                //            "-"
                //        )}, `;

                //        if (i === numOfEscorts - 1) {
                //            escortsPhone2render = escortsPhone2render.substring(
                //                0,
                //                escortsPhone2render.length - 2
                //            );
                //            escortsPhone2render += "</span>";
                //        }

                //    }
                //});
                if (numOfRealEscorts === 0) escortsPhone2render = "";
            } else {
                numOfPassengers = `<span class="numOfPassengers">נוסע יחיד</span>`;
                numOfPassengers_English = `<span class="numOfPassengers">single pasnger</span>`;
            }

            if (ridepat.PatientEquipments!=null) {
                equipmentsAndnumOfPassengers = `<div class="equipmentsAndnumOfPassengers">`;
                equipmentsAndnumOfPassengers += isAssistant
                    ? numOfPassengers_English
                    : numOfPassengers;
                equipmentsAndnumOfPassengers += `<div>`;
                ridepat.PatientEquipments.map((eq) => {
                    equipmentsAndnumOfPassengers += `<img class="equipments-img" src="../../Media/${eq}.png" />`;
                });
                equipmentsAndnumOfPassengers += `</div>`;
                equipmentsAndnumOfPassengers += `</div>`;
            } else {
                equipmentsAndnumOfPassengers = `<div class="equipmentsAndnumOfPassengers block">`;
                equipmentsAndnumOfPassengers += isAssistant
                    ? numOfPassengers_English
                    : numOfPassengers;
                equipmentsAndnumOfPassengers += `</div>`;
            }

            let patientAddons =
                equipmentsAndnumOfPassengers + patientPhone2render + escortsPhone2render;
            let patientName2render = "";
            let patient_English_Name2render = "";

            if (ridepat.PatientName.includes("אנונימי")) {
                patientName2render = "<span class='boldFont'>חולה</span>";
                patient_English_Name2render = "<span class='boldFont'>patient</span>";
            } else {
                patientName2render = `<a href="patientform.html" data-obj="patient" class='showMe blueFont clickable boldFont' id='${ridepat.PatientId}'>${ridepat.PatientName}</a>`;
                patient_English_Name2render = `<a href="patientform.html" data-obj="patient" class='showMe blueFont clickable boldFont' id='${ridepat.PatientId}'>${ridepat.PatientName}</a>`;
            }


            let result = null;
            if (isAssistant) {

                result = patient_English_Name2render;
            } else {

                result = patientName2render
            }

            result = result.concat(' ' + patientAddons);

            return result;
        };

        const buildPatientHTML = (ridepat) => {

            let patientPhone2render = "";
            let numOfEscorts = ridepat.Escorts.length;
            let numOfPassengers = '<span class="numOfPassengers">נוסע יחיד</span>';
            let numOfPassengers_English =
                '<span class="numOfPassengers">single passenger</span>';
            let escortsPhone2render = "";
            let equipmentsAndnumOfPassengers = "";

            if (validateMobileNumFullVersion(ridepat.Pat.CellPhone)) {
                patientPhone2render = `<span class="patientPhone2render">${addSeperator2MobileNum(
                    ridepat.Pat.CellPhone,
                    "-"
                )}</span>`;
            }

            if (numOfEscorts > 0) {

                numOfPassengers = `<span class="numOfPassengers">${numOfEscorts + (ridepat.OnlyEscort ? 0 : 1)//+1 is the patient himself
                    } נוסעים</span>`;
                numOfPassengers_English = `<span class="numOfPassengers">${numOfEscorts + (ridepat.OnlyEscort ? 0 : 1)
                    } passengers</span>`;



                // Gilad comment out it --> avraham doesnt want the phone Number of Escorts its no needed !!
                //escortsPhone2render = '<span class="escortsPhone2render block">מלווים: ';
                numOfRealEscorts = 0;

                //ridepat.Escorts.map((es, i) => {
                //    if (validateMobileNumFullVersion(es.CellPhone)) {
                //        numOfRealEscorts++;
                //        escortsPhone2render += `${addSeperator2MobileNum(
                //            es.CellPhone,
                //            "-"
                //        )}, `;

                //        if (i === numOfEscorts - 1) {
                //            escortsPhone2render = escortsPhone2render.substring(
                //                0,
                //                escortsPhone2render.length - 2
                //            );
                //            escortsPhone2render += "</span>";
                //        }

                //    }
                //});
                if (numOfRealEscorts === 0) escortsPhone2render = "";
            } else {
                numOfPassengers = `<span class="numOfPassengers">נוסע יחיד</span>`;
                numOfPassengers_English = `<span class="numOfPassengers">single pasnger</span>`;
            }

            if (ridepat.Pat.Equipment.length > 0) {
                equipmentsAndnumOfPassengers = `<div class="equipmentsAndnumOfPassengers">`;
                equipmentsAndnumOfPassengers += isAssistant
                    ? numOfPassengers_English
                    : numOfPassengers;
                equipmentsAndnumOfPassengers += `<div>`;
                ridepat.Pat.Equipment.map((eq) => {
                    equipmentsAndnumOfPassengers += `<img class="equipments-img" src="../../Media/${eq}.png" />`;
                });
                equipmentsAndnumOfPassengers += `</div>`;
                equipmentsAndnumOfPassengers += `</div>`;
            } else {
                equipmentsAndnumOfPassengers = `<div class="equipmentsAndnumOfPassengers block">`;
                equipmentsAndnumOfPassengers += isAssistant
                    ? numOfPassengers_English
                    : numOfPassengers;
                equipmentsAndnumOfPassengers += `</div>`;
            }

            let patientAddons =
                equipmentsAndnumOfPassengers + patientPhone2render + escortsPhone2render;
            let patientName2render = "";
            let patient_English_Name2render = "";

            if (ridepat.Pat.DisplayName.includes("אנונימי")) {
                patientName2render = "<span class='boldFont'>חולה</span>";
                patient_English_Name2render = "<span class='boldFont'>patient</span>";
            } else {
                patientName2render = `<a href="patientform.html" data-obj="patient" class='showMe blueFont clickable boldFont' id='${ridepat.Pat.Id}'>${ridepat.Pat.DisplayName}</a>`;
                patient_English_Name2render = `<a href="patientform.html" data-obj="patient" class='showMe blueFont clickable boldFont' id='${ridepat.Pat.Id}'>${ridepat.Pat.EnglishName}</a>`;
            }


            let result = null;
            if (isAssistant) {

                result = patient_English_Name2render;
            } else {

                result = patientName2render
            }

            result = result.concat(' ' + patientAddons);

            return result;
        };

        const buildStatusString = (statusObj, ridePatNum) => {

            
            let statusWrapper = `<div class="elementsInSameLine">`;
            //console.log('statusObj', statusObj, 'statusObj.Status', statusObj.Status)
            const status = GetPatientStatus(statusObj.Status, isAssistant);
            //console.log('status', status, 'ridePatNum', ridePatNum)

            const editTimeStamp = convertDBDate2FrontEndDate(statusObj.EditTimeStamp);
            const editBtn = `<button type='button' data-toggle="modal" data-target="#editPatientStatusModal" onclick="prepreparationEditPatientStatusModal(this, ${ridePatNum})" class='btn btn-icon waves-effect waves-light btn-secondary' title='עריכה'><i class='ti-pencil'></i></button>`;

            statusHTML = `<span>${status}</span>`;

            statusWrapper += '<div class="column">';
            statusWrapper += statusHTML;
            if (statusObj.Status === patientStatus.Finished) {

                statusWrapper += editTimeStamp ? '<div class="timeUnderStatus">' + editTimeStamp.toLocaleTimeString('he-IL', { timeStyle: 'short' }) + '</div>' : '';
            } else {

            }

            statusWrapper += `</div>`;

            statusWrapper += editBtn;

            statusWrapper += `</div>`;

            return statusWrapper;
        }

        const buildRemarkHTML = (remark, ridePatNum) => {

            let wrapper = '<div class="ToRight elementsInSameLine">';

            const editBtn = `<button type='button' data-toggle="modal" onclick="prepreparationEditRemark(this, ${ridePatNum})" data-target="#editRemarkModal" class='fix-flex-scretch btn btn-icon waves-effect waves-light btn-secondary' title='עריכה'><i class='ti-pencil'></i></button>`;

            wrapper += editBtn;
            wrapper += `<div class="m-l-10">${remark}</div>`;

            wrapper += '</div>';

            return wrapper;
        }

        const buildAcionsButtonsHTML = (ridePatNum, drivers) => {

            const editBtn = `<button type='button' class='edit                   btn btn-icon waves-effect waves-light btn-secondary' id='${ridePatNum}'  name='${ridePatNum}' title='עריכה'>         <i class='ti-pencil'></i></button>`;
            const deleteBtn = `<button type='button' class='remove               btn btn-icon waves-effect waves-light btn-secondary' id='${ridePatNum}'  name='${ridePatNum}' title='מחיקה'>         <i class='fa fa-remove'></i></button>`;
            const messageToCopyBtn = `<button type='button' class='copyMessage   btn btn-icon waves-effect waves-light btn-secondary' id='${ridePatNum}'  name='${ridePatNum}' title='העתקת הודעה'>   <i class='fa fa-envelope'></i></button>`;
            const candidateBtn = `<button type='button' title="בשיפוצים"   class='candidatesBtn btn btn-icon waves-effect waves-light btn-secondary'     id='${ridePatNum}'  name='${ridePatNum}' title='מועמדים להסעה'> <i class='fa fa-car'></i></button>`;
            let thisRide = findRideByNumber(ridePatNum);
            let timeNum = thisRide.PickupTime.replace('/', '').replace('/', '').replace('Date(', '').replace(')', '');
            timeNum = parseInt(timeNum);
            let time = new Date(timeNum);
            //console.log("time,", timeNum, time.getHours(), ridePatNum)
            let buttonsWrapper = `<div class='elementsInSameLine'>${editBtn} ${deleteBtn} ${(drivers.length > 0)? messageToCopyBtn : candidateBtn}</div>`;
            //let buttonsWrapper = `<div class='elementsInSameLine'>${editBtn} ${deleteBtn} ${(drivers.length > 0 && time.getHours() <= 23) ? messageToCopyBtn : candidateBtn}</div>`;

            return buttonsWrapper;
        }

        const buildTimeHTML = (thisRidePatDate, ridePatNum) => {

            let timeWrapper = `<div class="elementsInSameLine">`;

            let time = '<span class="time">';
            time += thisRidePatDate.getMinutes() === 14 ? 'אחה"צ' : thisRidePatDate.toLocaleTimeString('he-IL', { timeStyle: 'short' });
            time += '</span>';
            timeWrapper += time;

            const editBtn = `<button type='button' data-toggle="modal" data-target="#editTimeModal" onclick="prepreparationEditTimeModal(this, ${ridePatNum})" class='btn btn-icon waves-effect waves-light btn-secondary' title='עריכה'><i class='ti-pencil'></i></button>`;
            timeWrapper += editBtn;
            timeWrapper += `</div>`;

            return timeWrapper;
        }

        function prepreparationAssignDriverModal(thisBtn, ridePatNum, isDriverReplacement, rideNum, driverId) {
            _ridepatToManipulate = ridePatNum;
            _assignDriverToRideNum = rideNum
            _isDriverReplacement = isDriverReplacement;
            _driverId = driverId
            highLightRow(thisBtn);

            if (typeof driverId === 'undefined' || !driverId || driverId === null) {
                $('#removeDriverBtn').prop("disabled", true);
            } else {
                $('#removeDriverBtn').prop("disabled", false);
            }

            if (isDriverReplacement) {
                $('#driverModalTitle').text('עדכון נהג');
            } else {
                $('#driverModalTitle').text('שיבוץ נהג');
            }
        }

        //gilad change here the date to PickupTime
        function prepreparationEditTimeModal(thisBtn, ridepatNum) {
            _ridepatToManipulate = ridepatNum
            highLightRow(thisBtn);

            $('#editTimeModalTitle').text('עדכון שעת הסעה');
            BuildTimeDDLs('hours', 'minutes');

            const ridepatObject = arr_rides.find(r => r.RidePatNum === ridepatNum);
            const ridePatTime = convertDBDate2FrontEndDate(ridepatObject.PickupTime);

            let hoursAsDoubleDigits = createDoubleDigit(ridePatTime.getHours());
            let minutesAsDoubleDigits = createDoubleDigit(ridePatTime.getMinutes());
            let isAfterNoon = parseInt(minutesAsDoubleDigits) === afternoonIndicator;
            let $hoursSelect = $('#hours');
            let $minutesSelect = $('#minutes');

            if (!isAfterNoon) {

                $hoursSelect.val(hoursAsDoubleDigits);
                $minutesSelect.val(minutesAsDoubleDigits);
                checkeditTimeAfterNoonCB(false);
            } else {

                retrieveDDLToInitial('#hours');
                retrieveDDLToInitial('#minutes');
                checkeditTimeAfterNoonCB(true);
            }
        }

        const BuildTimeDDLs = (hoursId, minutesId) => {

            
            const minutesArr = [0, 15, 30, 45];
            let $hoursSelect = $(`#${hoursId}`);
            let $minutesSelect = $(`#${minutesId}`);
            let doubleDigitsValue = '';


            // Clear existing options
            $hoursSelect.empty();
            $minutesSelect.empty();
            $minutesSelect.html('<option disabled="" selected="">דקות</option>');
            $hoursSelect.html('<option disabled="" selected="">שעות</option>')
            for (let i = 0; i < 46; i++) {

                if (i < 24) {

                    doubleDigitsValue = createDoubleDigit(i);
                    $('<option>', { value: doubleDigitsValue, text: doubleDigitsValue }).appendTo($hoursSelect);
                    if (minutesArr.includes(i)) {
                        $('<option>', { value: doubleDigitsValue, text: doubleDigitsValue }).appendTo($minutesSelect);
                    }
                } else if (minutesArr.includes(i)) {
                    doubleDigitsValue = createDoubleDigit(i);
                    $('<option>', { value: doubleDigitsValue, text: doubleDigitsValue }).appendTo($minutesSelect);
                }
            }
            $hoursSelect.val('');
            $minutesSelect.val('');



        }

        function prepreparationEditPatientStatusModal(thisBtn, ridepatNum, EditTimeStamp, status) {
            _ridepatToManipulate = ridepatNum
            highLightRowSpecifcCSSClass(thisBtn, 'highlightRow');

            $('#editPatientStatusModalTitle').text('עדכון סטטוס חולה');
            BuildTimeDDLs("editPatientStatusModalHours", "editPatientStatusModalMinutes");
            let $hoursSelect = $('#editPatientStatusModalHours');
            let $minutesSelect = $('#editPatientStatusModalMinutes');

            let ridepatObject = arr_rides.find(r => r.RidePatNum === ridepatNum);
            //console.log('before!!!', ridepatObject)
            ridepatObject = CustomRideObject(ridepatObject);
            //console.log('after!!!', ridepatObject)
            const ridePatPatientStatus = ridepatObject.Pat.RidePatPatientStatus.Status;
            let editTimeStamp = ridepatObject.Pat.RidePatPatientStatus.EditTimeStamp;
            //console.log('test ', editTimeStamp)
            //ridePatPatientStatus == -1 ? editTimeStamp = null : editTimeStamp = editTimeStamp;
            if (ridePatPatientStatus != -1) {

                editTimeStamp = convertDBDate2FrontEndDate(editTimeStamp);
                let hoursAsDoubleDigits = createDoubleDigit(editTimeStamp.getHours());
                let minutesAsDoubleDigits = createDoubleDigit(editTimeStamp.getMinutes());
                //console.log('editTimeStamp???', editTimeStamp);
                $hoursSelect.val(hoursAsDoubleDigits);
                $minutesSelect.val(minutesAsDoubleDigits);
                if (ridePatPatientStatus==-1) {
                    $hoursSelect.val('');
                    $minutesSelect.val('');
                }
            } else {

                retrieveDDLToInitial('#editPatientStatusModalMinutes');
                retrieveDDLToInitial('#editPatientStatusModalHours');
                checkeditTimeNotFinishedCB(true);

            }
        }

        function prepreparationEditRemark(thisBtn, ridepatNum) {
            _ridepatToManipulate = ridepatNum
            highLightRow(thisBtn);

            const ridepatObject = arr_rides.find(r => r.RidePatNum === ridepatNum);
            const remarkToRender = ridepatObject.Remark;
            $('#editRemarkTextEditor').val(remarkToRender);
        }

        const editRemarkModalHasShown = () => {

            let inputField = document.getElementById('editRemarkTextEditor');
            let textLength = inputField.value.length;
            let endOfRemark = 0;

            if (textLength > 0) {

                inputField.value = inputField.value.trim();
                inputField.value = inputField.value += '\n';
                textLength = inputField.value.length;
                endOfRemark = textLength;
                inputField.value = inputField.value.replace(/<br>/g, "\n");
            }

            inputField.selectionStart = endOfRemark;
            inputField.selectionEnd = endOfRemark;

            focusOnElement('editRemarkTextEditor');
        }

        const checkeditTimeNotFinishedCB = (NotFinishedIsChecked) => {

            $('#editPatientStatusNotFinishedCB').prop('checked', NotFinishedIsChecked);
            $('#editPatientStatusModalHours').prop('disabled', NotFinishedIsChecked);
            $('#editPatientStatusModalMinutes').prop('disabled', NotFinishedIsChecked);
        }

        const checkeditTimeAfterNoonCB = (afterNoonIsChecked) => {

            $('#editTimeAfterNoonCB').prop('checked', afterNoonIsChecked);
            $('#hours').prop('disabled', afterNoonIsChecked);
            $('#minutes').prop('disabled', afterNoonIsChecked);
        }

        const retrieveDDLToInitial = (id) => {
            $(id).get(0).selectedIndex = 0;
        }

        const createDoubleDigit = (value) => {

            let result = value < 10 ? '0' + value : value;

            return result;
        }

        function highLightRow(thisBtn) {
            _trToHighLight = thisBtn.closest('tr');
            _trToHighLight.classList.add('highlightRow');
        }

        function highLightRowSpecifcCSSClass(thisBtn, className) {
            _trToHighLight = thisBtn.closest('tr');
            _trToHighLight.classList.add(className);
        }

        const add2IhaveSeenAllready = () => {

            $('.ContextMenu_dropdown').addClass('hidden');//hide floating button
            $($(`#${candidate4IhaveSeen}`).children('.last-modified_td')[0]).removeClass('within2HoursSinceChange');//remove marker

            increaseCounter($($(`#${candidate4IhaveSeen}`)).closest('table')[0].id, candidate4IhaveSeen, true);

            let arrayOf_IHaveSeenAllready = JSON.parse(localStorage.getItem('arrayOf_IHaveSeenAllready'));

            if (arrayOf_IHaveSeenAllready) {

                arrayOf_IHaveSeenAllready.push(parseInt(candidate4IhaveSeen));
                localStorage.setItem('arrayOf_IHaveSeenAllready', JSON.stringify(arrayOf_IHaveSeenAllready));
            } else {

                let newArr = [];
                newArr.push(parseInt(candidate4IhaveSeen))
                localStorage.setItem('arrayOf_IHaveSeenAllready', JSON.stringify(newArr));
            }

        }

        const increaseCounter = (tableName, ridePatNum, isDecrease = false) => {

            if (!allReadyCountedRidePats.includes(ridePatNum)) {

                let counterValue_asTxt = $(`#${tableName}_lastModified_counter`).text();
                let previosValue = parseInt(counterValue_asTxt);
                isDecrease ? previosValue-- : previosValue++;
                $(`#${tableName}_lastModified_counter`).html(previosValue)

                allReadyCountedRidePats.push(ridePatNum);
            }
        }

        const sortTable_LastModifiedFirst = (tableName) => {
            switch (tableName) {
                case tableNames.MORNING:
                    tMorning.order([6, 'desc']).draw();
                    break;
                case tableNames.AFTERNOON:
                    tAfternoon.order([6, 'desc']).draw();
                    break;
                case tableNames.TOMORROW_MORNING:
                    tTomorrowMorning.order([7, 'desc']).draw();
                    break;
                case tableNames.FUTURE:
                    tFuture.order([7, 'desc']).draw();
                    break;
            }
        }

        const editTimeModal_bsModalHasShown = () => {

        }

        const bsModalHasShown = async () => {
            await activateAutoComplteToModalsInput();

            const thisRideDriver = drivers.find(d => d.Id === _driverId);
            if (typeof thisRideDriver === 'undefined' || !thisRideDriver) {
                $('#driver').val('');
            } else {
                $('#driver').val(thisRideDriver.DisplayName);
            }

            focusOnElement('driver');
        }

        const activateAutoComplteToModalsInput = async () => {

            if (typeof driverNames === 'undefined' || !driverNames) {
                driverNames = await getDrivers();
            }

            $('#driver').autocomplete({ source: driverNames });
        }

        const focusOnElement = (id) => {
            $(`#${id}`).focus();
        }

    </script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <link href="assets/css/manageRidePats.css" rel="stylesheet" />
</head>


<body class="fixed-left">
    <!-- Begin page -->
    <div id="wrapper">
        <!-- Top Bar Start -->
        <div class="topbar">
            <!-- Navbar -->
            <div id="na" class="navbar navbar-default" role="navigation">
                <div class="container">
                    <div class="">
                        <!--Expend/Collaps Side Menue-->
                        <div class="pull-left">
                            <button class="button-menu-mobile open-left waves-effect">
                                <i class="md md-menu"></i>
                            </button>
                            <span class="clearfix"></span>
                        </div>

                        <!-- LOGO -->
                        <div class="pull-left">
                            <div class="text-center">
                                <a href="manageRidePats.html" class="logo"><span>בדרך להחלמה</span>&nbsp&nbsp&nbsp</a>
                            </div>
                        </div>

                        <div class="pull-right">
                            <a href="passwordForm.html">
                                <span class="logo" id="userName"></span>&nbsp;<span style="color:#3BAFDA" class="logo" id="databaseType"></span>
                                <span class="logo" id="userName"></span>&nbsp;<span style="color:#3BAFDA" class="logo"
                                                                                    id="databaseType"></span>
                            </a>
                        </div>
                    </div>
                    <!--/.nav-collapse -->
                </div>
            </div>
        </div>
        <!-- Top Bar End -->
        <!-- ========== Right Sidebar Start ========== -->
        <div id="menuType"></div>
        <div id="wait">
            <img src="../../Media/Wedges-3s-200px.gif" width="64" height="64" />
        </div>
        <!--<div w3-include-html="HelperMenu.html"></div>-->
        <!-- Right Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start page Content here -->
        <!-- ============================================================== -->
        <div class="content-page">
            <!-- Start content -->
            <div class="content">
                <div class="container">

                    <!-- Page-Title -->
                    <div class="row">
                        <div class="col-sm-2">
                            <div class="page-title-box">
                                <h4 class="page-title">
                                    ניהול ההסעות &nbsp&nbsp&nbsp<i data-toggle="tooltip"
                                                                   title="My Rides تنسيق السفريات الخاصة بي">
                                        <img src="../../Media/הסעות להיום.png" height="25" width="25" />
                                    </i>
                                </h4>
                            </div>
                        </div>
                        <div class="col-sm-10  text-right">

                            <span id="allSortsLabel"></span>
                            <label class="switch">
                                <input id="allSortsSwitch" type="checkbox" checked onchange="allSortsSwitch_changed()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div id="overRideBS_card-box" class="card-box table-responsive">
                                <div class="row">
                                    <div class="col-sm-6 text-left">
                                        <label for="refreshTime">בחירת קצב רענון:</label>
                                        <select id="refreshTime" name="refreshTime" class="input-sm">
                                            <option value="300000">5 דקות</option>
                                            <option value="600000">10 דקות</option>
                                            <option value="1800000">30 דקות</option>
                                            <option value="3600000">60 דקות</option>
                                        </select>
                                    </div>

                                    <div class="col-sm-6 text-right">
                                        <button data-toggle="tooltip" id="openSortsControllers" data-placement="top"
                                                title="filters window" onclick="showFiltersModal()"
                                                class="btn btn-success waves-effect w-md waves-light m-b-5">
                                            <span class="glyphicon glyphicon-filter m-r-5">
                                            </span>
                                            סינון אזורים
                                        </button>

                                        <button data-placement="top" data-toggle="tooltip" title="New Ride جديد "
                                                type="button" id="createCustomer" onclick="newRidePatForm()"
                                                class="btn btn-success waves-effect w-md waves-light m-b-5">
                                            <span class="glyphicon glyphicon-plus-sign m-r-5"></span>
                                            חדש
                                        </button>

                                        <!--<button onclick="MessageToPalestinianCoor()" class="btn btn-success waves-effect w-md waves-light m-b-5">
                                            <span class="glyphicon glyphicon-copy m-r-5"></span>
                                                    הודעה למתאמות
                                        </button>-->

                                    </div>
                                </div>

                                <div id="accordion" class="panel-group">
                                    <div onclick="assignTable2lastOne(tableNames.MORNING)" class="panel panel-primary">
                                        <div class="panel-heading blue1" id="col1">
                                            <h4 data-toggle="tooltip" data-placement="top"
                                                title="Morning Rides  سفريات الصباح" class="panel-title">
                                                <a id="collapsed1_aTag" href="#collapse1" data-parent="#accordion"
                                                   data-toggle="collapse" class="dropdown active open collapsed">
                                                    <span class="m-l-15">
                                                        נסיעות לבוקר
                                                        <span class="lastModified_counter">
                                                            <span class="lastModified_Records"
                                                                  onclick="sortTable_LastModifiedFirst(tableNames.MORNING)">
                                                                רשומות שעודכנו לאחרונה:
                                                                <span id="datatable-morning_lastModified_counter">0</span>
                                                            </span>
                                                        </span>
                                                    </span>
                                                </a>
                                            </h4>
                                        </div>
                                        <div class="panel-collapse collapse" id="collapse1">
                                            <div class="panel-body">
                                                <table id="datatable-morning"
                                                       class="table table-striped table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th class="middle" title="Time  الساعة">שעה</th>
                                                            <th class="middle" title="Origin  نقطة الانطلاق">מוצא</th>
                                                            <th class="middle" title="Destination  نقطة الوصول">יעד</th>
                                                            <th class="customWidth4column middle"
                                                                title="Patient  المريض">החולה</th>
                                                            <th class="middle" title="Patient's Name">גיל</th>
                                                            <th class="middle" title="Driver  السائق">המסיע</th>
                                                            <th class="middle" title="Status  حالة السفرية">
                                                                סטטוס החולה
                                                            </th>
                                                            <th class="customWidth middle" title="Last modified">
                                                                עודכן
                                                                לאחרונה
                                                            </th>
                                                            <th class="customWidth  middle" title="Remarks  ملاحظات">
                                                                הערות
                                                            </th>
                                                            <th title="isAnonymous"></th> <!-- hidden to the user -->
                                                            <th class="SmallcustomWidth  middle" title="Actions  اعمال">
                                                                פעולות
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div onclick="assignTable2lastOne(tableNames.AFTERNOON)"
                                         class="panel panel-primary ">
                                        <div class="panel-heading blue2" id="col2">
                                            <h4 data-toggle="tooltip" data-placement="top"
                                                title="Afternoon Rides  سفريات المساء" class="panel-title">
                                                <a id="collapsed2_aTag" href="#collapse2" data-parent="#accordion"
                                                   data-toggle="collapse" class="dropdown active open collapsed" />
                                                <span class="m-l-15">
                                                    נסיעות לאחה"צ
                                                    <span class="lastModified_counter">
                                                        <span class="lastModified_Records"
                                                              onclick="sortTable_LastModifiedFirst(tableNames.AFTERNOON)">
                                                            רשומות שעודכנו לאחרונה:
                                                            <span id="datatable-afternoon_lastModified_counter">0</span>
                                                        </span>
                                                    </span>
                                                </span>
                                                </a>
                                            </h4>
                                        </div>
                                        <div class="panel-collapse collapse" id="collapse2">
                                            <div class="panel-body">
                                                <table id="datatable-afternoon"
                                                       class="table table-striped table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th class="middle" title="Time  الساعة">שעה</th>
                                                            <th class="middle" title="Origin  نقطة الانطلاق">מוצא</th>
                                                            <th class="middle" title="Destination  نقطة الوصول">יעד</th>
                                                            <th class="customWidth4column middle"
                                                                title="Patient  المريض">החולה</th>
                                                            <th class="middle" title="Patient's Name">גיל</th>
                                                            <th class="middle" title="Driver  السائق">המסיע</th>
                                                            <th class="middle" title="Status  حالة السفرية">
                                                                סטטוס החולה
                                                            </th>
                                                            <th class="customWidth middle" title="Last modified">
                                                                עודכן
                                                                לאחרונה
                                                            </th>
                                                            <th class="customWidth  middle" title="Remarks  ملاحظات">
                                                                הערות
                                                            </th>
                                                            <th title="isAnonymous"></th> <!-- hidden to the user -->
                                                            <th class="SmallcustomWidth middle" title="Actions  اعمال">
                                                                פעולות
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div onclick="assignTable2lastOne(tableNames.TOMORROW_MORNING)"
                                         class="panel panel-primary ">
                                        <div class="panel-heading blue3" id="col4">
                                            <h4 data-toggle="tooltip" data-placement="bottom" title="Tomorrow Rides"
                                                class="panel-title">
                                                <a id="collapsed3_aTag" href="#collapse3" data-parent="#accordion"
                                                   data-toggle="collapse" class="dropdown active open collapsed">
                                                    <span class="m-l-15">
                                                        נסיעות למחר בבוקר
                                                        <span class="lastModified_counter">
                                                            <span class="lastModified_Records"
                                                                  onclick="sortTable_LastModifiedFirst(tableNames.TOMORROW_MORNING)">
                                                                רשומות שעודכנו לאחרונה:
                                                                <span id="datatable-tomorrow_lastModified_counter">0</span>
                                                            </span>
                                                        </span>
                                                    </span>
                                                </a>
                                            </h4>
                                        </div>
                                        <div class="panel-collapse collapse" id="collapse3">
                                            <div class="panel-body">
                                                <table id="datatable-tomorrow-morning"
                                                       class="table table-striped table-bordered hover">
                                                    <thead>
                                                        <tr>
                                                            <th class="middle" title="Date  الساعة">תאריך</th>
                                                            <th class="middle" title="Time  الساعة">שעה</th>
                                                            <th class="middle" title="Origin  نقطة الانطلاق">מוצא</th>
                                                            <th class="middle" title="Destination  نقطة الوصول">יעד</th>
                                                            <th class="customWidth4column middle"
                                                                title="Patient  المريض">החולה</th>
                                                            <th class="middle" title="Patient's Name">גיל</th>
                                                            <th class="middle" title="Driver  السائق">המסיע</th>
                                                            <th class="middle" title="Status  حالة السفرية">
                                                                סטטוס החולה
                                                            </th>
                                                            <th class="customWidth middle" title="Last modified">
                                                                עודכן
                                                                לאחרונה
                                                            </th>
                                                            <th class="customWidth  middle" title="Remarks  ملاحظات">
                                                                הערות
                                                            </th>
                                                            <th title="isAnonymous"></th> <!-- hidden to the user -->
                                                            <th class="SmallcustomWidth middle" title="Actions  اعمال">
                                                                פעולות
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div onclick="assignTable2lastOne(tableNames.TOMORROW_AFTERNOON)"
                                         class="panel panel-primary">
                                        <div class="panel-heading blue4" id="col4">
                                            <h4 data-toggle="tooltip" data-placement="bottom" title="Tomorrow Rides"
                                                class="panel-title">
                                                <a id="collapsed3_aTag" href="#collapse4" data-parent="#accordion"
                                                   data-toggle="collapse" class="dropdown active open collapsed">
                                                    <span class="m-l-15">
                                                        נסיעות למחר אחה"צ
                                                        <span class="lastModified_counter">
                                                            <span class="lastModified_Records"
                                                                  onclick="sortTable_LastModifiedFirst(tableNames.TOMORROW_MORNING)">
                                                                רשומות שעודכנו לאחרונה:
                                                                <span id="datatable-tomorrow_lastModified_counter">0</span>
                                                            </span>
                                                        </span>
                                                    </span>
                                                </a>
                                            </h4>
                                        </div>
                                        <div class="panel-collapse collapse" id="collapse4">
                                            <div class="panel-body">
                                                <table id="datatable-tomorrow-afternoon"
                                                       class="table table-striped table-bordered hover">
                                                    <thead>
                                                        <tr>
                                                            <th class="middle" title="Date  الساعة">תאריך</th>
                                                            <th class="middle" title="Time  الساعة">שעה</th>
                                                            <th class="middle" title="Origin  نقطة الانطلاق">מוצא</th>
                                                            <th class="middle" title="Destination  نقطة الوصول">יעד</th>
                                                            <th class="customWidth4column middle"
                                                                title="Patient  المريض">החולה</th>
                                                            <th class="middle" title="Patient's Name">גיל</th>
                                                            <th class="middle" title="Driver  السائق">המסיע</th>
                                                            <th class="middle" title="Status  حالة السفرية">
                                                                סטטוס החולה
                                                            </th>
                                                            <th class="customWidth middle" title="Last modified">
                                                                עודכן
                                                                לאחרונה
                                                            </th>
                                                            <th class="customWidth  middle" title="Remarks  ملاحظات">
                                                                הערות
                                                            </th>
                                                            <th title="isAnonymous"></th> <!-- hidden to the user -->
                                                            <th class="SmallcustomWidth middle" title="Actions  اعمال">
                                                                פעולות
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div onclick="assignTable2lastOne(tableNames.FUTURE)" class="panel panel-primary">
                                        <div class="panel-heading blue5" id="col3">
                                            <h4 data-toggle="tooltip" data-placement="bottom"
                                                title="Future Rides  سفريات مستقبلية" class="panel-title">
                                                <a id="collapsed4_aTag" href="#collapse5" data-parent="#accordion"
                                                   data-toggle="collapse" class="dropdown active open collapsed">
                                                    <span class="m-l-15">
                                                        נסיעות עתידיות
                                                    </span>
                                                    <span class="lastModified_counter">
                                                        <span class="lastModified_Records"
                                                              onclick="sortTable_LastModifiedFirst(tableNames.FUTURE)">
                                                            רשומות שעודכנו לאחרונה:
                                                            <span id="datatable-future_lastModified_counter">0</span>
                                                        </span>
                                                    </span>
                                                </a>
                                            </h4>
                                        </div>
                                        <div class="panel-collapse collapse" id="collapse5">
                                            <div class="panel-body">
                                                <table id="datatable-future"
                                                       class="table table-striped table-bordered hover">
                                                    <thead>
                                                        <tr>
                                                            <th class="middle" title="Date  الساعة">תאריך</th>
                                                            <th class="middle" title="Time  الساعة">שעה</th>
                                                            <th class="middle" title="Origin  نقطة الانطلاق">מוצא</th>
                                                            <th class="middle" title="Destination  نقطة الوصول">יעד</th>
                                                            <th class="customWidth4column middle"
                                                                title="Patient  المريض">החולה</th>
                                                            <th class="middle" title="Patient's Name">גיל</th>

                                                            <th class="middle" title="Driver  السائق">המסיע</th>
                                                            <th class="middle" title="Status  حالة السفرية">
                                                                סטטוס ההסעה
                                                            </th>
                                                            <th class="customWidth middle" title="Last modified">
                                                                עודכן
                                                                לאחרונה
                                                            </th>
                                                            <th class="customWidth  middle" title="Remarks  ملاحظات">
                                                                הערות
                                                            </th>
                                                            <th title="isAnonymous"></th> <!-- hidden to the user -->
                                                            <th class="SmallcustomWidth middle" title="Actions  اعمال">
                                                                פעולות
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- end container -->

            </div>


            <!-- end content -->
            <!-- FOOTER -->
            <footer id="rights" data-toggle="tooltip" data-placement="top"
                    title="© All rights reserved The Road to Recovery.  جميع الحقوق محفوظة لجمعية الطريق الى الشفاء"
                    class="footer text-right">
            </footer>
            <!-- End FOOTER -->

        </div>
        <!-- ============================================================== -->
        <!-- End page content here -->
        <!-- ============================================================== -->

    </div>
    <!-- END wrapper -->



    <script>
        var resizefunc = [];
    </script>

    <!-- side menu toggle functiolity is from here -->
    <script src="assets/js/jquery.app.js"></script>

    <div class="modal fade" id="messagesModal" tabindex="-1" role="dialog" aria-labelledby="messagesModalTitle"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title centerHeader" id="messagesModalTitle">נמצאה הסעה חזור</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h5 id="returnRidePatMsg" class="centerHeader"></h5>
                    <h5 id="DriverReturnRidePatMsg" class="centerHeader"></h5>
                </div>
                <div class="modal-footer">
                    <!--<button type="button" class="btn btn-secondary" data-dismiss="modal">ביטול</button>-->
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">ביטול</button>
                    <button type="button" class="btn btn-warning" onclick="deleteReturn_unityRide()">מחיקה</button>
                </div>
            </div>
        </div>
    </div>



    <div class="modal fade" id="assignDriverModal" role="dialog" data-keyboard="false" data-backdrop="static" aria-labelledby="documentedRidesTitle" aria-hidden="true"></div>
    <div class="modal fade" id="editTimeModal" role="dialog" data-keyboard="false" data-backdrop="static" aria-labelledby="editTimeTitle" aria-hidden="true"></div>
    <div class="modal fade" id="editPatientStatusModal" role="dialog" data-keyboard="false" data-backdrop="static" aria-labelledby="editPatientStatusTitle" aria-hidden="true"></div>
    <div class="modal fade" id="editRemarkModal" role="dialog" data-keyboard="false" data-backdrop="static" aria-labelledby="" aria-hidden="true"></div>


    <div class="modal fade" id="filtersModal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" id="overRideBS_modal-dialog">
                <div class="modal-header">
                    <h2 class="modal-title">ניהול הסעות - סינון מידע</h2>
                    <h4>רק אזורים מסומנים יופיעו בתצוגה</h4>
                </div>
                <div id="filtersModal_placeHolder" class="modal-body"></div>
                <div class="text-right modal-footer">
                    <button type="button" onclick="saveFilters()" class="btn btn-secondary" data-dismiss="modal">
                        שמירה
                        וסגירה
                    </button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">ביטול</button>
                </div>
            </div>
        </div>
    </div>
    <div class="ContextMenu_dropdown hidden">
        להסיר סימון עודכן לאחרונה מתא זה?
        <input onclick="add2IhaveSeenAllready()" class="dropbtn" type="button" value="כן" />
    </div>
</body>

</html>
