<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="KSMoving">
    <meta name="author" content="Coderthemes">

    <link rel="shortcut icon" href="assets/images/favicon_1.ico">

    <title>פרטי מתנדב.ת</title>

    <link href="assets/css/viewVolunteer.css" rel="stylesheet" type="text/css" />
    <!-- DataTables -->
    <link href="../plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/datatables/buttons.bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/datatables/fixedHeader.bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/datatables/responsive.bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/datatables/scroller.bootstrap.min.css" rel="stylesheet" type="text/css" />

    <!-- Sweet Alert css -->
    <link href="../plugins/bootstrap-sweetalert/sweet-alert.css" rel="stylesheet" type="text/css" />

    <link href="../plugins/switchery/switchery.min.css" rel="stylesheet" />
    <link href="assets/css/bootstrap-rtl.min.css" rel="stylesheet" type="text/css">
    <link href="assets/css/core.css" rel="stylesheet" type="text/css">
    <link href="assets/css/icons.css" rel="stylesheet" type="text/css">
    <link href="assets/css/components.css" rel="stylesheet" type="text/css">
    <link href="assets/css/pages.css" rel="stylesheet" type="text/css">
    <link href="assets/css/menu.css" rel="stylesheet" type="text/css">
    <link href="assets/css/responsive.css" rel="stylesheet" type="text/css">

    <script src="assets/js/CookiesFunctions.js"></script>

    <script src="assets/js/modernizr.min.js"></script>

    <!--GENERAL object and additional functions-->
    <script src="lib/lz-string.js"></script>
    <script src="lib/master.js"></script>

    <script src="assets/js/jquery.min.js"></script>

    <!-- Select2 css+js -->
    <link href="assets/css/select2.css" rel="stylesheet" />
    <script src="assets/js/select2.min.js"></script>
    <script src="lib/includeHTML.js"></script>
    <script></script>

    <script>

        var cleanPhoneNumber;
        var msgTable;
        let historyTable;
        let DocumentedCallsTable;
        let preDefinedContents = [
            { key: 0, value: '&lt;בחר מהרשימה או הכנס.י מלל חופשי בשדה הבא&gt;' },
            { key: 1, value: 'ירשם להסעה' },
            { key: 2, value: 'לא נרשם להסעה' },
            { key: 3, value: 'לא פנוי לשיחה' },
            { key: 4, value: 'להתקשר במועד מאוחד יותר' },
            { key: 5, value: 'לא מסיע.ה בתקופה הקרובה' },
            { key: 6, value: 'נא למחוק מהאפליקציה' }
        ];

        let thisVolunteerId = 0;

        checkCookie();
        var allVolunteersFromDb = [];

        $(document).ready(function () {

            if (localStorage.activeVol == "undefined" || localStorage.activeVol === undefined)
                localStorage.activeVol = true;

            if (localStorage.driveVol == "undefined" || localStorage.driveVol === undefined)
                localStorage.driveVol = true;

            if (window.location.hostname.toString() == 'localhost' || window.location.pathname.indexOf('test') != -1) {
                $("#na").css("background-color", "#ffde89");
            }
            if (window.location.href.indexOf('http://40.117.122.242/Road%20to%20Recovery/') != -1) {
                window.location.href = "notAvailable.html";
            }
            includeHTML();
            var userName = GENERAL.USER.getUserDisplayName();
            $("#userName").html(userName);
            $("#closeModal").click(function () {

            });
            //adds menu.html content into any "#menu" element
            //$('#menu').load('menu.html');
            //var userName = GENERAL.USER.getUserName();
            //$("#userName").html(userName);

            //Create a DataTable from the Table
            t = $('#datatable-buttons').DataTable({
                //bProcessing: true,
                //bServerSide:true,
                //ajax: function (data, callback, settings) {
                //    $.ajax({
                //        url: '/your/url',
                //        type: 'POST',
                //        data: data,
                //        success: function (data) {
                //            callback(data);
                //            // Do whatever you want.
                //        }
                //    });
                //},
                "bDeferRender": true,
                columnDefs: [
                    {
                        targets: 5,
                        className: 'dt-body-left'
                    }
                ],
                "autoWidth": true,


            });

            refreshTable();

            //var pastePhone = document.getElementById('pastePhone');

            //cleanPhoneNumber = function (e) {
            //    e.preventDefault();
            //    var pastedText = '';
            //    if (window.clipboardData && window.clipboardData.getData) { // IE
            //        pastedText = window.clipboardData.getData('Text');
            //    } else if (e.clipboardData && e.clipboardData.getData) {
            //        pastedText = e.clipboardData.getData('text/plain');
            //    }
            //    var patt = /(\d{1,3},\d{3}(,\d{3})*)(\.\d*)?|\d+\.?\d*/;
            //    var res = patt.test(pastedText);
            //    if (res) {
            //        this.value = pastedText.replace(/\D/g, '');
            //    } else {
            //        this.value = pastedText;
            //    }
            //};


        });

        function ActiveMode() {
            localStorage.activeVol = $("#activeCustomers").prop('checked');
            refreshTable();
        }

        const driveMode = () => {
            localStorage.driveVol = $('#drivingVolunteers').prop('checked');
            refreshTable();

        }

        function refreshTable() {
            var activeVol = JSON.parse(localStorage.activeVol);
            $("#activeCustomers").prop('checked', activeVol);

            let driveVol = JSON.parse(localStorage.driveVol);
            $("#drivingVolunteers").prop('checked', driveVol);


            allVolunteersFromDb = [];
            $('#wait').show();
            checkCookie();
            var active = $("#activeCustomers").prop('checked');
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getVolunteers",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({ active: active }),
                success: function (data) {

                    $('#wait').hide();
                    var arr_volunteers = JSON.parse(data.d);
                    GENERAL.VOLUNTEERS.setVolunteersList(JSON.stringify(arr_volunteers));

                    for (i in arr_volunteers) {
                        if (driveVol === true && (!arr_volunteers[i].IsDriving)) continue;
                        var btnStr = ""
                        //כפתור צפייה כרגע מוסתר
                        //var showBtn = "<button type='button' class='btn btn-icon waves-effect waves-light btn-success btn-sm m-b-5' id='show' title='צפייה'><i class='fa fa-wpforms'></i></button>";
                        var editBtn = "<button type='button' class='btn btn-icon waves-effect waves-light btn-primary btn-sm m-b-5' id='edit' title='עריכה'><i class='ti-pencil'></i></button>";

                        btnStr += /*showBtn + " " +*/ editBtn;

                        if (arr_volunteers[i].IsActive == false) {
                            btnStr = "";
                            var reactiveBtn = "<button type='button' class='btn btn-icon waves-effect waves-light btn-warning btn-sm m-b-5' id='reactive' title='שחזור'><i class='fa fa-undo' ></i></button>";
                            btnStr += " " + reactiveBtn;
                        }
                        else {
                            var deleteBtn = "<button type='button' class='btn btn-icon waves-effect waves-light btn-danger btn-sm m-b-5' id='remove' title='מחיקה'><i class='fa fa-remove' ></i></button>";
                            btnStr += " " + deleteBtn;

                            var messagesBtn = "<button type='button' class='btn btn-icon waves-effect waves-light btn-light btn-sm m-b-5' id='messages' title='הודעות' data-toggle='modal' data-target='#messagesModal'><i class='fa fa-envelope-o' ></i></button>";
                            btnStr += " " + messagesBtn;
                        }
                        var cellphone2 = "";
                        if (arr_volunteers[i].CellPhone2 != "") {
                            cellphone2 = arr_volunteers[i].CellPhone2;
                        }
                        else cellphone2 = arr_volunteers[i].HomePhone;

                        let showDocumentedRidesBtn = '';
                        showDocumentedRidesBtn += arr_volunteers[i].NoOfDocumentedRides < 10 ? '&nbsp' : '';
                        showDocumentedRidesBtn += '<span><span class="badge badge-pill badge-default">' + arr_volunteers[i].NoOfDocumentedRides + '</span>';
                        showDocumentedRidesBtn += '<button type="button" class="btn btn-icon waves-effect waves-light btn-primary btn-sm m-b-5" id ="showDocumentedRidesBtn" title="תיעוד הסעות" data-toggle="modal" data-target="#documentedRidesModal"><i class="fa fa-car" aria-hidden="true"></i></button>';
                        showDocumentedRidesBtn += '</span>';
                        btnStr += showDocumentedRidesBtn;

                        let showDocumentedCallsBtn = '<span><span class="badge badge-pill badge-default">' + arr_volunteers[i].NoOfDocumentedCalls + '</span>';
                        showDocumentedCallsBtn += '<button type="button" class="btn btn-icon waves-effect waves-light btn-primary btn-sm m-b-5" id ="showDocumentedCallsBtn" title="שיחות מתועדות" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#DocumentedCallsModal"><i class="fa fa-phone" aria-hidden="true"></i></button>';
                        showDocumentedCallsBtn += '</span>';
                        btnStr += showDocumentedCallsBtn;

                        var Volunteer = {
                            Id: arr_volunteers[i].Id,
                            DisplayName: arr_volunteers[i].DisplayName,
                            TypeVol: arr_volunteers[i].TypeVol,
                            CellPhone: arr_volunteers[i].CellPhone,
                            CellPhone2: cellphone2,
                            City: arr_volunteers[i].City,
                            Remarks: arr_volunteers[i].Remarks,
                            Buttons: btnStr,
                            LastModified: arr_volunteers[i].LastModified,
                            EnglishName: arr_volunteers[i].EnglishName

                        }
                        allVolunteersFromDb.push(Volunteer);
                    }

                    tbl = $('#datatable-buttons').DataTable({
                        data: allVolunteersFromDb,
                        rowId: 'Id',
                        "autoWidth": false,
                        "destroy": true,
                        dom: 'Bfrtip',
                        buttons: [
                            {
                                extend: 'excel',
                                title: 'מתנדבים'
                            }
                        ],
                        columnDefs: [
                            {
                                targets: 5,
                                className: 'dt-body-left'
                            },
                            {
                                targets: 3,
                                className: 'text-left-strong'
                            },
                            { "targets": [7], "orderable": false },


                        ],
                        columns: [
                            { data: "DisplayName", width: "10%" },
                            { data: "TypeVol", width: "5%" },
                            { data: "CellPhone", width: "5%" },

                            { data: "EnglishName", width: "10%" },

                            { data: "City", width: "7%" },
                            { data: "Remarks", width: "20%" },
                            { data: "LastModified", width: "15%" },
                            { data: "Buttons", width: "28%" },
                        ],
                    });

                    buttonsEvents();
                },
                error: function (err) {
                    alert("Error in getVolunteers: " + err.responseText);
                    $('#wait').hide();
                }
            });
        }

        const ConvertDBDate2UIDate = (fullTimeStempStr) => {
            if (fullTimeStempStr === undefined) return;
            let startTrim = fullTimeStempStr.indexOf('(') + 1;
            let endTrim = fullTimeStempStr.indexOf(')');
            let fullTimeStempNumber = fullTimeStempStr.substring(startTrim, endTrim);
            let fullTimeStemp = new Date(parseInt(fullTimeStempNumber));

            //Note: in getMOnth function 0=January, 1=February etc...

            let dd = fullTimeStemp.getDate() < 10 ? "0" + fullTimeStemp.getDate() : fullTimeStemp.getDate();
            dd += ".";
            let mm = fullTimeStemp.getMonth() < 9 ? "0" + parseInt(fullTimeStemp.getMonth() + 1) : fullTimeStemp.getMonth() + 1;
            mm += ".";
            let yyyy = fullTimeStemp.getFullYear();

            return dd + mm + yyyy;
        }

        const ConvertDBDate2UIFullStempDate = (dateAsStr) => {
            if (dateAsStr === undefined) return;
            let startTrim = dateAsStr.indexOf('(') + 1;
            let endTrim = dateAsStr.indexOf(')');
            let fullTimeStempNumber = dateAsStr.substring(startTrim, endTrim);
            let fullTimeStemp = new Date(parseInt(fullTimeStempNumber));
            return fullTimeStemp;
        }

        function buttonsEvents() {
            pastePhone.onpaste = cleanPhoneNumber;
            $('#datatable-buttons tbody').on('click', '#edit', function () {
                var data = tbl.row($(this).parents('tr')).data();
                arr_details = { displayName: data.DisplayName, func: "edit" };
                GENERAL.VOLUNTEERS.setVolunteersList(JSON.stringify(arr_details));
                location.href = "volunteerForm.html";
            });

            $('#datatable-buttons tbody').on('click', '#show', function () {
                var data = tbl.row($(this).parents('tr')).data();
                arr_details = { displayName: data.DisplayName, func: "show" };
                GENERAL.VOLUNTEERS.setVolunteersList(JSON.stringify(arr_details));
                location.href = "volunteerForm.html";
            });

            $('#datatable-buttons tbody').on('click', '#remove', function () {
                var data = tbl.row($(this).parents('tr')).data();
                swal({
                    title: "האם אתם בטוחים?",
                    type: "warning",
                    text: "הפיכת המתנדב " + data.DisplayName + " ללא פעיל",
                    showCancelButton: true,
                    cancelButtonText: "בטל",
                    confirmButtonClass: 'btn-warning',
                    confirmButtonText: "מחיקה",
                    closeOnConfirm: false
                }, function () {
                    deactivateVolunteer(data.DisplayName, 'false');
                    swal({
                        title: "המתנדב הפך ללא פעיל",
                        timer: 1000,
                        type: "success",
                        showConfirmButton: false
                    });
                    setTimeout(function () { refreshTable() }, 1001);
                });
            });

            $('#datatable-buttons tbody').on('click', '#reactive', function () {
                var data = tbl.row($(this).parents('tr')).data();
                swal({
                    title: "האם אתם בטוחים?",
                    type: "warning",
                    text: "שחזור המתנדב " + data.DisplayName,
                    showCancelButton: true,
                    cancelButtonText: "בטל",
                    confirmButtonClass: 'btn-warning',
                    confirmButtonText: "שחזר",
                    closeOnConfirm: false
                }, function () {
                    deactivateVolunteer(data.DisplayName, 'true');
                    swal({
                        title: "המתנדב הפך לפעיל",
                        timer: 1000,
                        type: "success",
                        showConfirmButton: false
                    });
                    setTimeout(function () { refreshTable() }, 1001);
                });

            });

            $('#datatable-buttons tbody').on('click', '#showDocumentedCallsBtn', function () {

                $('#wait').show();

                let rowData = tbl.row($(this).parents('tr')).data();
                thisVolunteerId = rowData.Id; //this variable is goobal to this page & used also in documentAcall2DB !!!

                $('#DocumentedCallsTitle').text("שיחות עם - " + rowData.DisplayName)

                $.ajax({
                    dataType: "json",
                    url: "WebService.asmx/GetDocumentedCallsByDriverId",
                    contentType: "application/json; charset=utf-8",
                    type: "POST",
                    data: JSON.stringify({ driverId: thisVolunteerId }),
                    success: function (data) {
                        data = JSON.parse(data.d)
                        if (DocumentedCallsTable != null) {
                            DocumentedCallsTable.destroy();
                        }
                        DocumentedCallsTable = $('#DocumentedCallTable').DataTable({
                            order: [[4, "desc"]],
                            pageLength: 5,
                            data: data,
                            columns: [
                                {
                                    data: (data) => {
                                        return ConvertDBDate2UIDate(data.CallRecordedDate);
                                    }
                                },
                                {
                                    data: (data) => {
                                        if (data.CallRecordedTime === undefined) return;
                                        let time = data.CallRecordedTime;
                                        time = time.Hours + ":" + time.Minutes;
                                        return time;
                                    }
                                },
                                {
                                    data: "CoordinatorName"
                                },
                                {
                                    data: "CallContent"
                                }
                                ,
                                {
                                    data: (data) => {
                                        return ConvertDBDate2UIFullStempDate(data.FullDateStemp);
                                    }
                                }
                            ],
                            columnDefs: [
                                { "targets": [4], visible: false },
                                /*
                                 Amir wanted a seperated columns to date and time but still sort by the full time stemps (or the acctual ticks)
                                 so my (Yogev) soolution was to
                                 1. fetch the fulltime stemp from the back-end
                                 2. render and sort by this column
                                 3. not showing it to the user
                                 */
                            ]

                        });
                        $('#wait').hide();

                    },
                    error: function (err) {
                        alert("Error in GetVolunteersRideHistory: " + err.responseText);
                        $('#wait').hide();
                    }
                });


            });

            $('#datatable-buttons tbody').on('click', '#showDocumentedRidesBtn', function () {

                $('#wait').show();

                let rowData = tbl.row($(this).parents('tr')).data();

                $('#documentedRidesTitle').text("תיעוד הסעות - " + rowData.DisplayName)
                $.ajax({
                    dataType: "json",
                    url: "WebService.asmx/GetVolunteersDocumentedRides",
                    contentType: "application/json; charset=utf-8",
                    type: "POST",
                    data: JSON.stringify({ volunteerId: rowData.Id }),
                    success: function (data) {
                        data = JSON.parse(data.d)

                        if (historyTable != null) {
                            historyTable.destroy();
                        }


                        historyTable = $('#documentedRidesTable').DataTable({
                            order: [[5, "desc"]],
                            pageLength: 5,
                            data: data,
                            columns: [
                                {
                                    data: (data) => {
                                        // if (data.Date === undefined) return;
                                        return ConvertDBDate2UIDate(data.Date);
                                    }
                                },
                                {
                                    data: (data) => {
                                        if (data.Date === undefined) return;

                                        let fullTimeStempStr = data.Date;
                                        let startTrim = fullTimeStempStr.indexOf('(') + 1;
                                        let endTrim = fullTimeStempStr.indexOf(')');
                                        let fullTimeStempNumber = fullTimeStempStr.substring(startTrim, endTrim);
                                        let fullTimeStemp = new Date(parseInt(fullTimeStempNumber));

                                        let hh = fullTimeStemp.getHours() < 10 ? "0" + fullTimeStemp.getHours() : fullTimeStemp.getHours();
                                        hh += ":";
                                        let mm = fullTimeStemp.getMinutes() < 10 ? "0" + fullTimeStemp.getMinutes() : fullTimeStemp.getMinutes();
                                        return hh + mm;
                                    }
                                },
                                {
                                    data: (data) => {
                                        if (data.Origin === undefined || data.Destination === undefined) return;

                                        let fullPath = data.Origin.Name + " ← " + data.Destination.Name;
                                        return fullPath;
                                    }
                                },
                                { data: "Pat.DisplayName" },
                                { data: "Remark" },
                                {
                                    data: (data) => {
                                        return ConvertDBDate2UIFullStempDate(data.Date);
                                    }
                                },

                            ],
                            columnDefs: [
                                { "targets": [5], visible: false },
                                /*
                                 Amir wanted a seperated columns to date and time but still sort by the full time stemps (or the acctual ticks)
                                 so my (Yogev) soolution was to
                                 1. fetch the fulltime stemp from the back-end
                                 2. render and sort by this column
                                 3. not showing it to the user
                                 */
                                {
                                    "targets": [0],
                                    render: function (data, type, full, meta) {
                                        let now = new Date();
                                        if (ConvertDBDate2UIFullStempDate(full.Date) > now) {
                                            var rowIndex = meta.row + 1;
                                            $('#documentedRidesTable tbody tr:nth-child(' + rowIndex + ')').addClass('futureRide');
                                            return data;
                                        } else {
                                            return data;
                                        }
                                    }
                                },
                            ]
                        });
                        $('#wait').hide();

                    },
                    error: function (err) {
                        alert("Error in GetVolunteersRideHistory: " + err.responseText);
                        $('#wait').hide();
                    }
                });


            });

            $('#datatable-buttons tbody').on('click', '#messages', function () {

                $('#wait').show();

                var rowData = tbl.row($(this).parents('tr')).data();
                //console.log(rowData);


                $('#messagesModalTitle').text("היסטוריית הודעות - " + rowData.DisplayName)
                $.ajax({
                    dataType: "json",
                    url: "WebService.asmx/getMessages",
                    contentType: "application/json; charset=utf-8",
                    type: "POST",
                    data: JSON.stringify({ displayName: rowData.DisplayName }),
                    success: function (data) {
                        var data = JSON.parse(data.d)
                        //console.log(data)
                        if (msgTable != null) {

                            msgTable.destroy();
                        }

                        msgTable = $('#messagesTable').DataTable({
                            columnDefs: [
                                { "targets": 3, className: 'text-left-strong' }
                            ],
                            order: [[1, "desc"]],
                            pageLength: 5,
                            data: data,
                            columns: [
                                { data: "DateTime" },
                                { data: "MsgID" },
                                { data: "ParentID" },
                                { data: "Type" },
                                { data: "Title" },
                                { data: "MsgContent" },
                                { data: "Sender" },
                            ]
                        });
                        $('#wait').hide();

                    },
                    error: function (err) {
                        alert("Error in getVolunteer: " + err.responseText);
                        $('#wait').hide();
                    }
                });

            });
        }

        function deactivateVolunteer(displayName, active) {
            checkCookie();


            $.ajax({
                dataType: "json",
                url: "WebService.asmx/deactivateVolunteer",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({ displayName: displayName, active: active }),
                success: function (data) { },
                error: function (err) { alert("Error in deactivateVolunteer: " + err.responseText); }
            });

        }

        function newVolunteerForm() {
            displayName = " ";
            arr_details = { displayName: displayName, func: "new" };
            GENERAL.VOLUNTEERS.setVolunteersList(JSON.stringify(arr_details));
            location.href = "volunteerForm.html";
        }

        const openDocumentAcallModal = () => {

            //get a list of all coordinators ()
            let allCordinatorsFromDB = [];
            let loggedInUser = {};
            loggedInUser.DisplayName = localStorage.getItem('userCell');
            loggedInUser.UserType = localStorage.getItem('userType');
            $('#DocumentAcall_writeContent').val('');
            $('#DocumentAcall_contentErrorMsg').hide();
            $('#DocumentAcall_CoordinatorErrorMsg').hide();


            $('#wait').show();
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/GetCoordinatorsList",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                success: function (data) {
                    $('#wait').hide();
                    allCordinatorsFromDB = JSON.parse(data.d);
                    let cordinatorsOptions = '<option value="not selected">בחר רכז.ת</option>';

                    for (var i = 0; i < allCordinatorsFromDB.length; i++) {
                        cordinatorsOptions += `<option value="${allCordinatorsFromDB[i].Id}"`;
                        cordinatorsOptions += loggedInUser.UserType === 'רכז' &&
                            allCordinatorsFromDB[i].DisplayName === loggedInUser.DisplayName ? 'selected>' : '>';
                        cordinatorsOptions += `${allCordinatorsFromDB[i].DisplayName}</option >`;
                    }
                    document.getElementById('DocumentAcall_choooseCoordinator').innerHTML = cordinatorsOptions;


                    let contentOptions;
                    for (var i = 0; i < preDefinedContents.length; i++) {
                        contentOptions += `<option value="${preDefinedContents[i].key}">${preDefinedContents[i].value}</option>`;
                    }
                    document.getElementById('DocumentAcall_choooseContent').innerHTML = contentOptions;



                    let now = new Date();
                    document.getElementById('DocumentAcallDatePicker').valueAsDate = now; //sets the default date for today

                    let time = new Object();
                    time.hours = now.getHours() < 10 ? '0' + now.getHours() : now.getHours();
                    time.minutes = now.getMinutes() < 10 ? '0' + now.getMinutes() : now.getMinutes();

                    document.getElementById('DocumentAcallTime').value = `${time.hours}:${time.minutes}`;
                    $('.closeBtn_DocumentAcallsModal').prop('disabled', true);
                    /*
                     beacuse you cant disable the + btn right away (it will prevent to popup from show)
                     you make js wait for one hundredth of a second before disabling it
                     */
                    setTimeout(() => $('#documentAcallPlusBtn').prop('disabled', true), 100);
                },
                error: function (err) {
                    alert("Error in GetCoordinatorsList: " + err.responseText);
                    $('#wait').hide();
                }
            });




        }



        const cancelCallDocument = () => {
            $('.closeBtn_DocumentAcallsModal').prop('disabled', false);
            $('#documentAcallPlusBtn').prop('disabled', false);

        }

        const documentAcall2DB = () => {
            let documentedCall = {};
            documentedCall.DriverId = thisVolunteerId;
            documentedCall.CoordinatorId = parseInt($('#DocumentAcall_choooseCoordinator').val());
            documentedCall.CallRecordedDate = $('#DocumentAcallDatePicker').val();
            documentedCall.CallRecordedTime = $('#DocumentAcallTime').val();

            let preDefinedContents_key = parseInt($('#DocumentAcall_choooseContent').val());
            let content2pass2DB;
            if (preDefinedContents_key === 0) {
                content2pass2DB = $('#DocumentAcall_writeContent').val();
            } else {
                content2pass2DB = $('#DocumentAcall_writeContent').val().length !== 0 ? $('#DocumentAcall_writeContent').val() + " - " : "";
                content2pass2DB += preDefinedContents[preDefinedContents_key].value;
            }
            documentedCall.CallContent = content2pass2DB;

            if (!documentedCall.CoordinatorId) {
                $('#DocumentAcall_CoordinatorErrorMsg').show()
                $('#DocumentAcall_contentErrorMsg').hide();
                return;
            }
            if (documentedCall.CallContent.length === 0) {
                $('#DocumentAcall_contentErrorMsg').show();
                $('#DocumentAcall_CoordinatorErrorMsg').hide()
                return;
            }



            $.ajax({
                dataType: "json",
                url: "WebService.asmx/DocumentNewCall",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({ documentedCall }),
                success: function (data) {
                    swal({
                        title: "ההודעה תועדה, תודה",
                        timer: 1500,
                        type: "success",
                        showConfirmButton: false
                    }, function () {
                        location.reload();
                    }
                    );
                },
                error: function (err) { alert("Error in DocumentNewCall: " + err.responseText); }
            });





            $('#DocumentAcallsModal').modal('toggle')  //both of them should be toggled
            $('#DocumentedCallsModal').modal('toggle') //both of them should be toggled

            $('.closeBtn_DocumentAcallsModal').prop('disabled', false);
            $('#documentAcallPlusBtn').prop('disabled', false);

        }


    </script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->


</head>


<body class="fixed-left">

    <!-- Begin page -->
    <div id="wrapper">

        <!-- Top Bar Start -->
        <div class="topbar">



            <!-- Navbar -->
            <div id="na" class="navbar navbar-default" role="navigation">
                <div class="container">
                    <div class="">
                        <!--Expend/Collaps Side Menue-->
                        <div class="pull-left">
                            <button class="button-menu-mobile open-left waves-effect">
                                <i class="md md-menu"></i>
                            </button>
                            <span class="clearfix"></span>
                        </div>

                        <!-- LOGO -->
                        <div class="pull-left">
                            <div class="text-center">
                                <a href="manageRidePats.html" class="logo"><span>בדרך להחלמה</span></a>
                            </div>
                        </div>
                        <div class="pull-right">
                            <a href="passwordForm.html"> <span class="logo" id="userName"></span></a>
                        </div>


                        <!--Search-->
                        <!--<form role="search" class="navbar-right app-search pull-right hidden-xs">
                            <input type="text" placeholder="חיפוש..." class="form-control app-search-input">
                            <a href=""><i class="fa fa-search"></i></a>
                        </form>-->
                    </div>
                    <!--/.nav-collapse -->
                </div>
            </div>
        </div>
        <!-- Top Bar End -->
        <!-- ========== Right Sidebar Start ========== -->
        <div w3-include-html="menu.html"></div>
        <!-- Right Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start page Content here -->
        <!-- ============================================================== -->
        <div class="content-page">
            <!-- Start content -->
            <div class="content">
                <div class="container">

                    <!-- Page-Title -->
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="page-title-box">
                                <ol class="breadcrumb pull-right">

                                    <li class="active">ניהול מתנדבים</li>
                                </ol>
                                <h4 class="page-title">
                                    ניהול מתנדבים&nbsp&nbsp
                                    <i>
                                        <img src="../../Media/רשימת מתנדבים.png" height="25" width="25" />
                                    </i>
                                </h4>
                            </div>
                        </div>
                    </div>



                    <div class="row">
                        <div class="col-sm-12">
                            <div class="card-box table-responsive">

                                <!--<div class="row">
                                    <div class="col-sm-8">
                                        <h4 class="m-t-0 header-title"><b>טבלת מתנדבים</b></h4>
                                        <p class="text-muted font-13 m-b-30">
                                            מבט כללי על המתנדבים שבוצעו, ניתן לצפות בפרטים נוספים בלחיצה על כפתור ההרחבה.
                                        </p>
                                    </div>
                                    <div class="col-sm-4 text-right">
                                        <button type='button' class='btn btn-icon waves-effect waves-light btn-success btn-sm m-b-5' id='show' title='צפייה'><i class='fa fa-wpforms'></i></button> צפייה
                                        <button type='button' class='btn btn-icon waves-effect waves-light btn-primary btn-sm m-b-5' id='edit' title='עריכה'><i class='ti-pencil'></i></button> עריכה
                                        <button type='button' class='btn btn-icon waves-effect waves-light btn-danger btn-sm m-b-5' id='remove' title='מחיקה'><i class='fa fa-remove'></i></button> מחיקה
                                        <button type='button' class='btn btn-icon waves-effect waves-light btn-warning btn-sm m-b-5' id='reactive' title='שחזור'><i class='fa fa-undo'></i></button> שחזור
                                    </div>
                                </div>-->
                                <div class="row">
                                    <div class="col-sm-3 checkbox checkbox-primary text-left">
                                        <input id="activeCustomers" type="checkbox" onchange="ActiveMode()" checked>
                                        <label for="activeCustomers">
                                            מתנדבים פעילים בלבד
                                        </label>
                                        <input id="drivingVolunteers" type="checkbox" onchange="driveMode()" checked>
                                        <label for="drivingVolunteers">
                                            מתנדבים נוהגים בלבד
                                        </label>
                                    </div>

                                    <div class="col-sm-9 text-right ">
                                        <button type="button" id="createCustomer" onclick="newVolunteerForm()" class="btn btn-success waves-effect w-md waves-light m-b-5"><span class="glyphicon glyphicon-plus-sign m-r-5"></span>חדש</button>
                                    </div>
                                </div>
                                <table id="datatable-buttons" class="table table-striped table-bordered">
                                    <thead>
                                        <tr dir="rtl">
                                            <th>המתנדב/ת</th>
                                            <th>סוג משתמש/ת</th>
                                            <th>טלפון</th>
                                            <th>שם באנגלית</th>
                                            <th>יישוב</th>
                                            <th style="text-align:right">הערות</th>
                                            <th>עודכן לאחרונה</th>
                                            <th>פעולות</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>






                                </table>
                                <div id="wait" style="display:none;width:69px;height:89px;position:absolute;top:50%;left:50%;padding:2px;">
                                    <img src="../../Media/Wedges-3s-200px.gif" width="64" height="64" />
                                </div>
                            </div>
                        </div>
                    </div>




                </div>
                <!-- end container -->

            </div>
            <!-- end content -->
            <!-- FOOTER -->
            <footer class="footer text-right">
                2020 - 2018 © כל הזכויות שמורות לעמותת בדרך להחלמה
            </footer>
            <!-- End FOOTER -->

        </div>
        <!-- ============================================================== -->
        <!-- End page content here -->
        <!-- ============================================================== -->

    </div>
    <!-- END wrapper -->



    <script>
        var resizefunc = [];
    </script>

    <!-- jQuery  -->
    <script src="assets/js/bootstrap-rtl.min.js"></script>
    <script src="assets/js/detect.js"></script>
    <script src="assets/js/fastclick.js"></script>
    <script src="assets/js/jquery.slimscroll.js"></script>
    <script src="assets/js/jquery.blockUI.js"></script>
    <script src="assets/js/waves.js"></script>
    <script src="assets/js/wow.min.js"></script>
    <script src="assets/js/jquery.nicescroll.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="../plugins/switchery/switchery.min.js"></script>

    <!-- Datatables-->
    <script src="../plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="../plugins/datatables/dataTables.bootstrap.js"></script>
    <script src="../plugins/datatables/dataTables.buttons.min.js"></script>
    <script src="../plugins/datatables/buttons.bootstrap.min.js"></script>
    <script src="../plugins/datatables/jszip.min.js"></script>
    <script src="../plugins/datatables/pdfmake.min.js"></script>
    <script src="../plugins/datatables/vfs_fonts.js"></script>
    <script src="../plugins/datatables/buttons.html5.min.js"></script>
    <script src="../plugins/datatables/buttons.print.min.js"></script>
    <script src="../plugins/datatables/dataTables.fixedHeader.min.js"></script>
    <script src="../plugins/datatables/dataTables.keyTable.min.js"></script>
    <script src="../plugins/datatables/dataTables.responsive.min.js"></script>
    <script src="../plugins/datatables/responsive.bootstrap.min.js"></script>
    <script src="../plugins/datatables/dataTables.scroller.min.js"></script>

    <!-- Datatable init js -->
    <script src="assets/pages/datatables.init.js"></script>

    <!-- Sweet Alert js -->
    <script src="../plugins/bootstrap-sweetalert/sweet-alert.min.js"></script>
    <script src="assets/pages/jquery.sweet-alert.init.js"></script>

    <script src="assets/js/jquery.core.js"></script>
    <script src="assets/js/jquery.app.js"></script>

    <script type="text/javascript">

        TableManageButtons.init();

    </script>
    <!-- ↓ Message Modal ↓   -->
    <div class="modal fade" id="messagesModal" tabindex="-1" role="dialog" aria-labelledby="messagesModalTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h2 class="modal-title" id="messagesModalTitle">הודעות</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table id="messagesTable" class="table table-striped table-bordered">
                        <thead>
                            <tr dir="rtl">
                                <th>זמן</th>
                                <th>מספר הודעה</th>
                                <th>הודעת אב</th>
                                <th>סוג</th>
                                <th>כותרת</th>
                                <th>תוכן</th>
                                <th>שולח</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">סגירה</button>

                </div>
            </div>
        </div>
    </div>
    <!-- ↑ Message Modal ↑ -->
    <!-- ↓ documentedRidesModal ↓ -->
    <div class="modal fade" id="documentedRidesModal" tabindex="-1" role="dialog" aria-labelledby="documentedRidesitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h2 class="modal-title" id="documentedRidesTitle">היסטורית הסעות</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table id="documentedRidesTable" class="table table-striped table-bordered">
                        <thead>
                            <tr dir="rtl">
                                <th>תאריך</th>
                                <th>שעה</th>
                                <th>קו</th>
                                <th>חולה</th>
                                <th>הערות</th>
                                <th id="invisible">z</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">סגירה</button>

                </div>
            </div>
        </div>
    </div>
    <!-- ↑ documentedRidesModal ↑  -->
    <!-- ↓ DocumentedCallsModal ↓ -->
    <div class="modal fade" id="DocumentedCallsModal" tabindex="-1" role="dialog" aria-labelledby="DocumentedCallsTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h2 class="modal-title" id="DocumentedCallsTitle">שיחות עם</h2>
                    <button type="button" class="close closeBtn_DocumentAcallsModal" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="text-right">
                        <button type="button" id="documentAcallPlusBtn" class="btn btn-default"
                                data-keyboard="false"
                                data-toggle="modal" data-target="#DocumentAcallsModal" onclick="openDocumentAcallModal()">
                            <i class="fa fa-plus"></i>
                        </button>
                    </div>
                    <table id="DocumentedCallTable" class="table table-striped table-bordered">
                        <thead>
                            <tr dir="rtl">
                                <th>תאריך</th>
                                <th>שעה</th>
                                <th>רכז.ת</th>
                                <th>פרטים</th>
                                <th id="invisible">z</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <!-- ↓ DocumentAcallsModal ↓ -->

                <div class="modal fade" id="DocumentAcallsModal" tabindex="-1" role="dialog" aria-hidden="true">
                    <div id="overRideBS_modal-dialog" class="modal-dialog" role="document">
                        <div id="overRideBS_modal_4changeBg" class="modal-content">
                            <div class="modal-header">
                                <h2 class="modal-title">תיעוד שיחה</h2>
                            </div>
                            <div id="overRideBS_modal_4changelinesColor" class="modal-body">
                                <span class="redTxt">* שדה חובה</span>
                                <br />
                                <br />
                                <table id="DocumentAcallTable">
                                    <tr>
                                        <td class="rightCol">בתאריך</td>
                                        <td class="leftCol">
                                            <input id="DocumentAcallDatePicker" type="date" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="rightCol">שעה <span class="redTxt">*</span></td>
                                        <td class="leftCol">
                                            <input id="DocumentAcallTime" type="time" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="rightCol">רכז.ת <span class="redTxt">*</span></td>
                                        <td class="leftCol">
                                            <select id="DocumentAcall_choooseCoordinator">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="rightCol">תוכן השיחה <span class="redTxt">*</span></td>
                                        <td class="leftCol">
                                            <select id="DocumentAcall_choooseContent">
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="rightCol"></td>
                                        <td class="leftCol">
                                            <textarea id="DocumentAcall_writeContent" maxlength="400" placeholder="&lt;מלל חופשי עד 400 תווים&gt;"></textarea>
                                        </td>
                                    </tr>
                                </table>
                                <span id="DocumentAcall_contentErrorMsg" class="redTxt">יש למלא לפחות אחד מהשדות של תוכן השיחה</span>
                                <span id="DocumentAcall_CoordinatorErrorMsg" class="redTxt">יש לבחור רכז.ת מהרשימה</span>

                            </div>
                            <div class="text-right modal-footer">
                                <!-- for some reason right in bs means left -->
                                <button type="button" class="fixWidth btn btn-secondary" onclick="documentAcall2DB()">שמירה</button>
                                <button type="button" class="fixWidth btn btn-secondary" data-dismiss="modal" onclick="cancelCallDocument()">ביטול</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ↑ DocumentAcallsModal ↑ -->
                <div class="text-right modal-footer">
                    <!-- for some reason right in bs means left -->
                    <button type="button" class="btn btn-secondary closeBtn_DocumentAcallsModal" data-dismiss="modal">סגירה</button>
                </div>
            </div>
        </div>
    </div>
    <!-- ↑ DocumentedCallsModal ↑  -->





</body>
</html>