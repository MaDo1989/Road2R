<!DOCTYPE html>

<html lang="en" dir=rtl>
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="KSMoving">
    <meta name="author" content="Coderthemes">

    <link rel="shortcut icon" href="assets/images/favicon_1.ico">

    <title>הסעת חולה</title>

    <link href="../plugins/switchery/swiFtchery.min.css" rel="stylesheet" />
    <link href="assets/css/bootstrap-rtl.min.css" rel="stylesheet" type="text/css">
    <link href="assets/css/core.css" rel="stylesheet" type="text/css">
    <link href="assets/css/icons.css" rel="stylesheet" type="text/css">
    <link href="assets/css/components.css" rel="stylesheet" type="text/css">
    <link href="assets/css/pages.css" rel="stylesheet" type="text/css">
    <link href="assets/css/menu.css" rel="stylesheet" type="text/css">
    <link href="assets/css/responsive.css" rel="stylesheet" type="text/css">

    <script src="assets/js/CookiesFunctions.js"></script>

    <script src="assets/js/modernizr.min.js"></script>

    <script src="assets/js/jquery.min.js"></script>

    <!-- The jQuery library is a prerequisite for all jqSuite products -->
    <script type="text/ecmascript" src="assets/js/jquery.min.js"></script>
    <!-- This is the Javascript file of jqGrid -->
    <script type="text/ecmascript" src="Guriddo_jqGrid_JS_5.2.0/js/jquery.jqGrid.min.js"></script>
    <!-- We support more than 40 localizations -->
    <script type="text/ecmascript" src="Guriddo_jqGrid_JS_5.2.0/js/i18n/grid.locale-he.js"></script>
    <!-- A link to a Boostrap  and jqGrid Bootstrap CSS siles-->
    <link href="Guriddo_jqGrid_JS_5.2.0/css/ui.jqgrid-bootstrap.css" rel="stylesheet" />

    <!-- Sweet Alert css -->
    <link href="../plugins/bootstrap-sweetalert/sweet-alert.css" rel="stylesheet" type="text/css" />

    <!--GENERAL object and additional functions-->
    <script src="lib/master.js"></script>

    <!-- Select2 css+js -->
    <link href="assets/css/select2.css" rel="stylesheet" />
    <script src="assets/js/select2.min.js"></script>

    <!--DatePicker css+js-->
    <!--<link href="../plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" rel="stylesheet">
    <link href="../plugins/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
    <script src="../plugins/moment/moment.js"></script>
    <script src="../plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="../plugins/bootstrap-daterangepicker/daterangepicker.js"></script>-->

    <!--timePicker css+js-->

    <!--<link href="../plugins/timepicker/bootstrap-timepicker.min.css" rel="stylesheet" />
    <script src="../plugins/timepicker/bootstrap-timepicker.min.js"></script>-->

    <!--Patient Autocomplete-->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <style>
        .ui-autocomplete {
            max-height: 100px;
            overflow-y: auto;
            /* prevent horizontal scrollbar */
            overflow-x: hidden;
        }
        /* IE 6 doesn't support max-height
        * we use height instead, but this forces the menu to always be this tall
        */
        * html .ui-autocomplete {
            height: 100px;
        }
    </style>
    <!--<script src="https://code.jquery.com/jquery-1.12.4.js"></script>-->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script>
        var resizefunc = [];
    </script>

    <!--Validators-->
    <script src="../plugins/jquery-validation/dist/jquery.validate.min.js"></script>


    <!-- jQuery  -->
    <script src="assets/js/bootstrap-rtl.min.js"></script>
    <script src="assets/js/detect.js"></script>
    <script src="assets/js/fastclick.js"></script>
    <script src="assets/js/jquery.slimscroll.js"></script>
    <script src="assets/js/jquery.blockUI.js"></script>
    <script src="assets/js/waves.js"></script>
    <script src="assets/js/wow.min.js"></script>
    <script src="assets/js/jquery.nicescroll.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="../plugins/switchery/switchery.min.js"></script>

    <!-- Sweet Alert js -->
    <script src="../plugins/bootstrap-sweetalert/sweet-alert.min.js"></script>
    <script src="assets/pages/jquery.sweet-alert.init.js"></script>

    <script src="assets/js/jquery.core.js"></script>
    <script src="assets/js/jquery.app.js"></script>
    <!--<script src="lib/datepicker-he.js"></script>-->

    <script>
        checkCookie();
        arr_addressRows = [];
        $.jgrid.defaults.responsive = true;
        $.jgrid.defaults.styleUI = 'Bootstrap';

        $(document).ready(function () {

            //datePicker();

            loadPage();

            $("#pat").blur(function () {
                fillData();
            });

            $("#pat").keyup(function () {
                $("#patArabic").val("");
            });

            $("#patArabic").blur(function () {
                fillData();
            });

            $("#patArabic").keyup(function () {
                $("#pat").val("");
            });


            // DO NOT REMOVE : GLOBAL FUNCTIONS!
            var errorClass = 'invalid';
            var errorElement = 'em';
            var $serviceForm = $('#customerForm').validate({

                highlight: function (element) {
                    jQuery(element).closest('.form-group').addClass('has-error');
                },
                unhighlight: function (element) {
                    jQuery(element).closest('.form-group').removeClass('has-error');
                },

                // Rules for form validation
                rules: {
                    dateRide: {
                        required: true
                    },
                    pat: {
                        required: true
                    },
                    //patArabic: {
                    //    required: true
                    //},
                    Origin: {
                        required: true
                    },
                    Destination: {
                        required: true
                    },
                    coordinator: {
                        required: true
                    },
                },

                submitHandler: function (form, event) {
                    event.preventDefault();
                    debugger;

                    var valid = validateInputs();
                    if (!valid) return false;

                    var RidePatNum = $("#ridePatNum").val();
                    var Pat = new Object();
                    Pat.DisplayName = $("#pat").val();
                    Pat.Id = localStorage.PatID;
                    var Origin = new Object();
                    Origin.Name = $("#Origin").val();
                    var Destination = new Object();
                    Destination.Name = $("#Destination").val();
                    var Remark = $("#remark").val();
                    var dateRide = $("#dateRide").val();
                    var hours = $("#hour").val();
                    var minutes = $("#minute").val();
                    //dateRide + " " + hours + ":" + minutes;
                    var Day = parseInt(dateRide.substring(8));
                    var Month = parseInt(dateRide.substring(5,7)) - 1;
                    var Year = parseInt(dateRide.substring(0,4));
                    var Hour = parseInt(hours);
                    var Minute = parseInt(minutes);
                    if ($("#afterNoon").is(':checked')) { //22:14 is the default time that means afternoon אחה''צ
                        Hour = 22;
                        Minute = 14;
                    }
                    var date = new Date(Year, Month, Day, Hour, Minute);
                    var func = arr_customer.func;
                    var Coordinator = new Object();
                    Coordinator.DisplayName = $("#coordinator").val();
                    var OnlyEscort = false;
                    if ($("#onlyEscort").is(':checked')) {
                        OnlyEscort = true;
                    }


                    //set Escorts
                    var selected = [];
                    $('#selectEscort input:checked').each(function () {
                        selected.push($(this).attr('name'));
                    });

                    var Escorts = [];
                    for (i in arr_escort) {
                        for (j in selected) {
                            if (arr_escort[i].DisplayName.replace("'", "") == selected[j]) {
                                var Escorted = new Object();
                                Escorted = arr_escort[i];
                                Escorts.push(Escorted);
                            }
                        }
                    }



                    if (func == "new") {
                        RidePat = {
                            Pat: Pat, Origin: Origin, Destination: Destination, Coordinator: Coordinator, Remark: Remark, Escorts: Escorts, Date: date, OnlyEscort: OnlyEscort
                        }
                    }
                    else {
                        RidePat = {
                            RidePatNum: RidePatNum, Pat: Pat, Origin: Origin, Destination: Destination, Coordinator: Coordinator, Date: date, Remark: Remark,
                            Escorts: Escorts, OnlyEscort: OnlyEscort
                        }
                    }
                    var request = { RidePat: RidePat, func: func }
                    var dataString = JSON.stringify(request);
                    $.ajax({
                        dataType: "json",
                        url: "WebService.asmx/setRidePat",
                        contentType: "application/json; charset=utf-8",
                        type: "POST",
                        async: false,
                        data: dataString,
                        success: function (data) {
                            //SaveAddresses(0, numberOfRecords, customerID);

                            swal({
                                title: "נשמר",
                                type: "success",
                                timer: 1000,
                                showConfirmButton: false
                            });
                            setTimeout(function () { returnRidePat() }, 1001);

                        },
                        error: function (err) {
                            alert("Error in setRidePat: " + err.responseText);
                        }
                    });

                    return false;
                },

                // Messages for form validation
                messages: {
                    dateRide: {
                        required: "יש להכניס תאריך"
                    },
                    pat: {
                        required: "יש לבחור חולה"
                    },
                    patArabic: {
                        required: "يجب عليك اختيار مريض"
                    },
                    Origin: {
                        required: "יש לבחור מוצא"
                    },
                    Destination: {
                        required: "יש לבחור יעד"
                    },
                    coordinator: {
                        required: "יש לבחור רכז אחראי"
                    },
                },


            });
        });


        function generatePat() {
            var $select = $("#pat");
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getPatients",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                async: false,
                data: JSON.stringify({ active: true }),
                success: function (data) {
                    arr_pat = JSON.parse(data.d);
                    ////$('<option>', { value: "", text: "בחר" }).attr({ 'selected': '', 'disabled': '' }).appendTo($select);
                    //for (i in arr_pat) {
                    //    $('<option>', { value: arr_pat[i].DisplayName, text: arr_pat[i].DisplayName }).appendTo($select);
                    //}
                    patients = [];
                    arr_arabNames = [];

                    for (i in arr_pat) {
                        patients.push(arr_pat[i].DisplayName);
                        arr_arabNames.push(arr_pat[i].DisplayNameA);
                    }

                    $("#pat").autocomplete({
                        source: patients
                    });

                    $("#patArabic").autocomplete({
                        source: arr_arabNames
                    });


                },
                error: function (err) { alert("Error in generatePat"); }
            });
        }


        //function generatePat1(ridePat) {
        //    var $select = $("#pat");
        //    $.ajax({
        //        dataType: "json",
        //        url: "WebService.asmx/getPatients",
        //        contentType: "application/json; charset=utf-8",
        //        type: "POST",
        //        async: false,
        //        data: JSON.stringify({ active: true }),
        //        success: function (data) {
        //            var arr_pat = JSON.parse(data.d);
        //            //if (ridePat.Pat.DisplayName != "") {
        //            //  //  $('<option>', { value: ridePat.Pat.DisplayName, text: ridePat.Pat.DisplayName }).appendTo($select);

        //            //}
        //            $('<option>', { value: "", text: "בחר" }).appendTo($select);
        //            for (i in arr_pat) {
        //                $('<option>', { value: arr_pat[i].DisplayName, text: arr_pat[i].DisplayName }).appendTo($select);
        //            }
        //            $("#pat option[value='" + ridePat.Pat.DisplayName + "']").prop('selected', true);
        //        },
        //        error: function (err) { alert("Error in generatePat1"); }
        //    });
        //}

        function getCoor() {
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getCoor",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                //async: false,
                data: JSON.stringify({ userName: GENERAL.USER.getUserName() }),
                success: getCoorSuccessCB,
                error: getCoorErrorCB
            });
        }

        function getCoorSuccessCB(data) {
            var $select = $("#coordinator");
            var coor = JSON.parse(data.d);
            //$('<option>', { value: "", text: "בחר" }).attr({ 'selected': '', 'disabled': '' }).appendTo($select);
            //for (i in arr_coor)

            //{
            //    // $('<option>', { value: arr_coor[i].DisplayName, text: arr_coor[i].DisplayName }).appendTo($select);
            //    //
            //}

            $select.val(coor.DisplayName);
        }

        function getCoorErrorCB(e) {
            alert("Error in getCoor: " + e.responseText);
        }


        //function generateCoor() {
        //    var $select = $("#coordinator");
        //    $.ajax({
        //        dataType: "json",
        //        url: "WebService.asmx/getCoorList",
        //        contentType: "application/json; charset=utf-8",
        //        type: "POST",
        //        async: false,
        //        data: JSON.stringify({}),
        //        success: function (data) {
        //            var arr_coor = JSON.parse(data.d);
        //            $('<option>', { value: "", text: "בחר" }).attr({ 'selected': '', 'disabled': '' }).appendTo($select);
        //            for (i in arr_coor) {
        //                $('<option>', { value: arr_coor[i].DisplayName, text: arr_coor[i].DisplayName }).appendTo($select);
        //            }
        //        },
        //        error: function (err) { alert("Error generateCoor"); }
        //    });
        //}

        //function generateCoor1(ridePat) {
        //    var $select = $("#coordinator");
        //    $.ajax({
        //        dataType: "json",
        //        url: "WebService.asmx/getCoorList",
        //        contentType: "application/json; charset=utf-8",
        //        type: "POST",
        //        async: false,
        //        data: JSON.stringify({}),
        //        success: function (data) {
        //            var arr_coor = JSON.parse(data.d);
        //            if (ridePat.Coordinator.DisplayName != "") {
        //                $('<option>', { value: ridePat.Coordinator.DisplayName, text: ridePat.Coordinator.DisplayName }).appendTo($select);
        //            }
        //            $('<option>', { value: "", text: "בחר" }).appendTo($select);
        //            for (i in arr_coor) {
        //                $('<option>', { value: arr_coor[i].DisplayName, text: arr_coor[i].DisplayName }).appendTo($select);
        //            }
        //        },
        //        error: function (err) { alert("Error in generateCoor1"); }
        //    });
        //}

        function generateEsc() {

            var displayName = $("#pat").val();
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getPatientEscorted",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                async: false,
                data: JSON.stringify({ displayName: displayName, caller: "ridePatForm" }),
                success: generateEscSuccessCB,
                error: generateEscErrorCB
            });
        }

        function generateEscSuccessCB(data) {
            arr_escort = JSON.parse(data.d);

            var str = "";

            for (i in arr_escort) {
                var escort1 = arr_escort[i].DisplayName;
                var escort = arr_escort[i].DisplayName.replace("'", "");
                var id = arr_escort[i].Id;
                str += "<input id='escortCB" + id + "' type=checkbox name='" + escort + "'>&nbsp";
                str += "<label for='escortCB" + id + "'>" + escort1 + "</label>&nbsp&nbsp";
            }
            if (arr_escort.length == 0) str = "<label>אין מלווים</label>";
            $("#selectEscort").html(str);

            if (arr_customer.func == "show") {
                var select = $("#selectEscort input");
                for (var i = 0; i < select.length; i++) {
                    $("#selectEscort input").eq(i).prop('disabled', true);
                }
            }

        }

        function generateEscErrorCB() {
            alert("Error in generateEsc");
        }

        function generateStatus() {

            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getAllStatus",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                //async: false,
                //data: JSON.stringify({ patient: dataString }),
                success: generateStatusSuccessCB,
                error: generateStatusErrorCB
            });

            function generateStatusSuccessCB(data) {
                var $select = $("#statusRidePat");
                var arr_status = JSON.parse(data.d);
                for (i in arr_status) {
                    var status = arr_status[i].Name;
                    $('<option>', { value: status, text: status }).appendTo($select);
                }
                if (arr_customer.func == "new") {
                    $("#statusRidePat option[value='ממתינה לשיבוץ']").prop('selected', true);
                }

            }

            function generateStatusErrorCB() {
                alert("Error in generateStatus");
            }
        }

        function generateLocation() {
            var $select = $("#Origin");
            var $select1 = $("#Destination");
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getDestinationView",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                async: false,
                data: JSON.stringify({ active: true }),
                success: function (data) {
                    var arr_locations = JSON.parse(data.d);
                    
                    for (i in arr_locations) {

                        $('<option>', { value: arr_locations[i].Name, text: arr_locations[i].Name }).appendTo($select);
                        $('<option>', { value: arr_locations[i].Name, text: arr_locations[i].Name }).appendTo($select1);

                    }
                },
                error: function (err) { alert("Error in generateLocation"); }
            });
        }

        function generateHour() {
            var $select = $("#hour");
            for (var i = 0; i < 24; i++) {
                if (i < 10) i = "0" + i;
                $('<option>', { value: i, text: i }).appendTo($select);
            }
            $select.val("06");
        }

        function generateMinute() {
            var $select = $("#minute");
            for (var i = 0; i < 60; i += 15) {
                if (i < 10) var j = "0" + i; else j = i;
                $('<option>', { value: j, text: j }).appendTo($select);
            }
            $select.val("00");
        }

        function validateInputs() {

            var patientExists = false;
            var patientAExists = false;
            var Origin = true;
            var Dest = true;
            var pat = document.forms["customerForm"]["pat"].value;
            for (i in patients) {
                if (pat == patients[i]) {
                    patientExists = true;
                    break;
                }
            }

            var patA = document.forms["customerForm"]["patArabic"].value;
            for (i in arr_arabNames) {
                if (patA == arr_arabNames[i]) {
                    patientAExists = true;
                    break;
                }
            }

            if (!patientExists) {
                alert("יש לבחור חולה מתוך הרשימה");
            }

            if (!patientAExists) {
                alert("يجب عليك اختيار مريض من القائمة");
            }

            var Origin = $("#Origin").val();
            if (Origin == "בחר מוצא") {
                Origin = false
                alert("יש לבחור מוצא מתוך הרשימה");
            }

            var Destination = $("#Destination").val();
            if (Destination == "בחר יעד") {
                Dest = false;
                alert("יש לבחור יעד מתוך הרשימה");
            }

            //var date = $("#dateRide").val();
            var date = document.getElementById("dateRide").value;
          //var reg = new RegExp("[0-9]{2}\/[0-9]{2}\/[0-9]{4}");
            //var dateMatch = reg.test(date);
            //if (!dateMatch) alert("התאריך שהוזן אינו חוקי");
            var Day = parseInt(date.substring(8));
            var Month = parseInt(date.substring(5, 7)) - 1;
            var Year = parseInt(date.substring(0,4));
           date = new Date(Year,Month,Day, $("#hour").val(), $("#minute").val());
            futureDate = checkFutureDate(date);
            if (!futureDate) alert("יש לבחור תאריך עתידי");



            var timeMatch = true;
            var aN = $("#afterNoon").is(':checked');
            if (!aN) {
                if ($("#hour").val() == "שעות" || $("#minute").val() == "דקות") {
                    alert("השעה שנבחרה אינה חוקית");
                    timeMatch = false;
                }
            }



            if ($("#onlyEscort").is(':checked')) {
                var atLeastOneIsChecked = 0;
                $('#selectEscort input:checked').each(function () {
                    atLeastOneIsChecked++;
                });
                if (atLeastOneIsChecked == 0) alert("יש לבחור לפחות מלווה אחד");
            }

            if (!patientExists || !Origin || !Dest  || !timeMatch || atLeastOneIsChecked == 0 || !futureDate) { //|| !dateMatch
                return false;
            } else return true;
        }

        function fillData() {

            if ($("#pat").val() != "") {
                var i = patients.indexOf($("#pat").val());
                localStorage.PatID = arr_pat[i].Id;
            }
            else if ($("#patArabic").val() != "") {
                var i = arr_arabNames.indexOf($("#patArabic").val());
                $("#pat").val(patients[i]);
                localStorage.PatID = arr_pat[i].Id;
            }

            try {
                $("#Origin option[value ='" + arr_pat[i].Barrier.Name.replace("'", "\\'") + "']").prop('selected', true);
                $("#Destination option[value ='" + arr_pat[i].Hospital.Name.replace("'", "\\'") + "']").prop('selected', true);
                getEquipmentForPatient();
                generateEsc();
                $("#patArabic").val(arr_arabNames[i]);
            } catch (e) {
                alert(e.responseText);
            }

        }

        function checkFutureDate(date) {
            //if ($("#afterNoon").is(':checked')) { //22:14 is the default time that means afternoon אחה''צ
            //    Hour = 22;
            //    Minute = 14;
            //}

            checkDate = Date.parse(date); //parameter datetime to compare with today
            if ($("#afterNoon").is(':checked')) { //22:14 is the default time that means afternoon אחה''צ
                checkDate = Date.parse(new Date(date.getFullYear(), date.getMonth(), date.getDate(), 23, 59));
            }
            var d2 = new Date(); //now
            currentDate = Date.parse(d2);

            if (checkDate < currentDate) return false //past datetime
            else return true; //future datetime
        }

        function getEquipmentForPatient() {

            var dataString = document.forms["customerForm"]["pat"].value;

            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getEquipmentForPatient",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                //async: false,
                data: JSON.stringify({ patient: dataString }),
                success: getEquipmentForPatientSuccessCB,
                error: getEquipmentForPatientErrorCB
            });
        }

        function getEquipmentForPatientSuccessCB(data) {
            var arr_equipment = JSON.parse(data.d)
            var str = "";
            for (i in arr_equipment) {
                str += arr_equipment[i] + ", ";
            }
            str = str.substring(0, str.lastIndexOf(", "));
            if (str == "") str = "אין";
            $("#Equipment").text(str);
        }

        function getEquipmentForPatientErrorCB(err) {
            alert("Error in getEquipmentForPatient: "+ err.responseText);
        }

        function switchDir() {
            var a = $("#Origin").val();
            var b = $("#Destination").val()

            $("#Origin option[value ='" + b + "']").prop('selected', true);
            $("#Destination option[value ='" + a + "']").prop('selected', true);
        }


        function loadPage() {
            var userType = GENERAL.USER.getUserType();
            if (userType != "מנהל") {
                $("#coorDiv").hide();
                $("#ph").show();
            } else {
                $("#coorDiv").show();
                $("#ph").hide();
            }
            if (JSON.parse(GENERAL.RIDEPAT.getRidePatList()).length != 0) {
                arr_customer = JSON.parse(GENERAL.RIDEPAT.getRidePatList());
                $("#ridePatNum").attr('disabled', 'disabled');
                $("#coordinator").attr('disabled', 'disabled');
                $("#statusRidePat").attr('disabled', 'disabled');
                $("#Equipment").attr('disabled', 'disabled');
                if (arr_customer.func == "edit" || arr_customer.func == "show") {
                    uploadData(arr_customer.RidePatNum);

                    if (arr_customer.func == "show") {

                        $("#afterNoon").attr('disabled', 'disabled');
                        $("#pat").attr('disabled', 'disabled');
                        $("#Origin").attr('disabled', 'disabled');
                        $("#remark").attr('disabled', 'disabled');
                        $("#Destination").attr('disabled', 'disabled');
                        $("#dateRide").attr('disabled', 'disabled');
                        $("#hour").attr('disabled', 'disabled');
                        $("#minute").attr('disabled', 'disabled');
                        $("#dirBTN").attr('disabled', 'disabled');
                        $("#patArabic").attr('disabled', 'disabled');
                        $("#saveCustomer").attr('disabled', 'disabled');
                        $("#onlyEscort").prop('disabled', true);

                    }
                }
                else {
                    generateStatus();
                    generatePat();
                    getCoor();
                    generateLocation();
                    generateHour();
                    generateMinute();
                }
            }
        }

        //function to fill form for edit
        function uploadData(ridePatNum) {
            generatePat();
            generateLocation();
            generateHour();
            generateMinute();
            generateStatus();

            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getRidePat",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({ ridePatNum: ridePatNum }),
                success: function (data) {
                    var ridePat = JSON.parse(data.d);
                    GENERAL.RIDEPAT.setRidePatList(JSON.stringify(ridePat));

                    var temp = ridePat.Date.substring(ridePat.Date.indexOf("(") + 1, ridePat.Date.indexOf(")"))
                    var date = new Date(parseInt(temp));
                    day = date.getDay();
                    var dayArr = ["ראשון", "שני", "שלישי", "רביעי", "חמישי", "שישי", "שבת"];
                    var dayName = dayArr[day];
                    var day = date.getDate();
                    var month = date.getMonth() + 1;
                    var year = date.getFullYear();
                    var hours = date.getHours();
                    var minutes = date.getMinutes();
                    if (hours < 10) hours = "0" + hours;
                    if (minutes < 10) minutes = minutes + "0";
                    if (day < 10) day = "0" + day;
                    if (month < 10) month = "0" + month;
                    date = year + "-" + month + "-" + day;
                    
                    //rdate = ryear + "-" + rmonth + "-" + rday;
                    document.getElementById("dateRide").value = date;

                    if (hours + ":" + minutes == "22:14") {
                        $("#afterNoon").attr('checked', 'checked');
                        checkAfternoon();

                    } else {
                        $("#hour option[value='" + hours + "']").prop('selected', true);
                        $("#minute option[value='" + minutes + "']").prop('selected', true);
                    }


                    if (ridePat.OnlyEscort) $("#onlyEscort").prop('checked', true);
                    $("#ridePatNum").val(ridePat.RidePatNum);
                    $("#pat").val(ridePat.Pat.DisplayName);
                    $("#pat").blur();
                    if (typeof arr_escort !== "undefined") {

                        for (i in arr_escort) {
                            for (j in ridePat.Escorts) {
                                if (arr_escort[i].DisplayName == ridePat.Escorts[j].DisplayName) {
                                    $("#escortCB" + arr_escort[i].Id).prop('checked', true);
                                }
                            }
                        }
                    } else ($("#selectEscort").html("<label>אין מלווים</label>"));

                    ridePat.Origin.Name = ridePat.Origin.Name.replace("'", "\\'");
                    $("#selectOrigin option[value='" + ridePat.Origin.Name + "']").prop('selected', true);
                    ridePat.Destination.Name = ridePat.Destination.Name.replace("'", "\\'");
                    $("#selectDestination option[value='" + ridePat.Destination.Name + "']").prop('selected', true);

                    //$("#dateRide").val(date);
                    

                    $("#coordinator").val(ridePat.Coordinator.DisplayName);

                    $("#remark").val(ridePat.Remark);

                    $("#statusRidePat option[value='" + ridePat.Status + "']").prop('selected', true);

                },
                error: function (err) { alert("Error in uploadData: "+ err.responseText); }
            });
        }

        function returnRidePat() {
            location.href = "viewRidePats.html"
        }

        function checkAfternoon() {
            if ($("#afterNoon").is(':checked')) {
                $("#hour").val("");
                $("#minute").val("");
                $("#hour").attr('disabled', 'disabled');
                $("#minute").attr('disabled', 'disabled');
            } else {
                $("#hour").val("06");
                $("#minute").val("00");
                $("#hour").attr('disabled', false);
                $("#minute").attr('disabled', false);
            }
        }

    </script>
</head>
<body class="fixed-left">

    <!-- Begin page -->
    <div id="wrapper">

        <!-- Top Bar Start -->
        <div class="topbar">



            <!-- Navbar -->
            <div class="navbar navbar-default" role="navigation">
                <div class="container">
                    <div class="">
                        <!--Expend/Collaps Side Menue-->
                        <div class="pull-left">
                            <button class="button-menu-mobile open-left waves-effect">
                                <i class="md md-menu"></i>
                            </button>
                            <span class="clearfix"></span>
                        </div>

                        <!-- LOGO -->
                        <div class="pull-left">
                            <div class="text-center">
                                <a href="manageRidePats.html" class="logo"><span>בדרך להחלמה</span>&nbsp&nbsp&nbsp</a>
                            </div>
                        </div>
                    </div>
                    <!--/.nav-collapse -->
                </div>
            </div>
        </div>
        <!-- Top Bar End -->
        <!-- ========== Right Sidebar Start ========== -->
        <div class="left side-menu">

            <div class="sidebar-inner slimscrollleft">

                <div id="sidebar-menu">

                    <ul>

                        <li>
                            <a href="viewVolunteer.html" class="waves-effect waves-primary">
                                <i class="md md-person"></i><span> ניהול מתנדבים</span>
                            </a>
                        </li>

                        <li>
                            <a href="viewPatient.html" class="waves-effect waves-primary">
                                <i class="md md-recent-actors"></i><span> ניהול חולים</span>
                            </a>
                        </li>
                        <li>
                            <a href="viewRidePats.html" class="waves-effect waves-primary">
                                <i class="md md-today"></i><span> כל ההסעות</span>
                            </a>
                        </li>

                        <li>
                            <a href="manageRidePats.html" class="waves-effect waves-primary">
                                <i class="md md-today"></i><span> ניהול ההסעות שלי</span>
                            </a>
                        </li>
                        <li>
                            <a class="waves-effect waves-primary" onclick="deleteCookie()">
                                <i class="md md-remove-circle-outline"></i><span>התנתקות מהמערכת</span>
                            </a>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>

                <div class="clearfix"></div>
            </div>

        </div>
        <!-- Right Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start page Content here -->
        <!-- ============================================================== -->
        <div class="content-page">
            <!-- Start content -->
            <div class="content">
                <div class="container">
                    <!-- Page-Title -->
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="page-title-box">
                                <ol class="breadcrumb pull-right">
                                    <li><a href="viewRidePats.html">כל ההסעות</a></li>
                                    <li class="active">הסעת חולה</li>
                                </ol>
                                <h4 class="page-title">הסעת חולה&nbsp&nbsp<i class="md md-recent-actors"></i></h4>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <form class="form-horizontal" role="form" id="customerForm">
                            <div class="col-sm-12">
                                <div class="card-box">
                                    <div class="row">
                                        <h4 class="m-t-0 header-title"><b>הסעת חולה</b></h4>

                                        <div class="text-right m-b-30 m-r-15">
                                            <button type="button" onclick="returnRidePat()" class="btn btn-default waves-effect w-md m-b-5"><i class="ti-back-right m-r-5"></i>חזור</button>
                                        </div>
                                        <p class="required">* שדה חובה</p>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">שם החולה&nbsp;<span class="required">*</span></label>
                                                    <div class="col-sm-6 ui-widget" id="selectPat">
                                                        <input type="text" id="pat" name="pat" class="form-control">
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <input type="checkbox" id="onlyEscort" />
                                                        <label for="onlyEscort">נסיעה למלווים בלבד</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">סטטוס</label>
                                                    <div class="col-sm-6" id="selectstatusRidePat">
                                                        <select id="statusRidePat" name="statusRidePat" class="form-control"><option>בחר סטטוס נסיעה</option></select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">اسم المريض</label>
                                                    <div class="col-sm-6 ui-widget" id="selectPat">
                                                        <input type="text" id="patArabic" name="patArabic" class="form-control"></input>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">מוצא&nbsp;<span class="required">*</span></label>
                                                    <div class="col-sm-6" id="selectOrigin">
                                                        <select id="Origin" name="Origin" class="form-control"><option>בחר מוצא</option></select>
                                                        <input id="dirBTN" type="button" value="שינוי כיוון" onclick="switchDir()" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                                <div class="form-group" id="escortDiv">
                                                    <label class="col-sm-2 control-label">מלווים</label>
                                                    <div class="col-sm-6" id="selectEscort">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">יעד&nbsp;<span class="required">*</span></label>
                                                    <div class="col-sm-6" id="selectDestination">
                                                        <select id="Destination" name="Destination" class="form-control"><option>בחר יעד</option></select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">ציוד נלווה</label>
                                                    <div class="col-sm-6" id="selectaddition">
                                                        <label id="Equipment" name="Equipment" class="control-label" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">הערות</label>
                                                    <div class="col-sm-6">
                                                        <input id="remark" name="remark" type="text" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">שעת הסעה&nbsp;<span class="required">*</span></label>
                                                    <div class="col-sm-6" id="selecthour">
                                                        <select id="minute" name="minute" class="form-control" style="width:33%;display:inline"><option>דקות</option></select>
                                                        <p style="display:inline;">:</p>
                                                        <select id="hour" name="hour" class="form-control" style="width:33%; display:inline;"><option>שעות</option></select>
                                                        <input type="checkbox" id="afterNoon" onchange="checkAfternoon()" />
                                                        <label for="afterNoon">אחה"צ</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6" id="ph">
                                            </div>
                                            <div class="col-sm-6" id="coorDiv">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">רכז</label>
                                                    <div class="col-sm-6" id="selectCoordinator">
                                                        <input type="text" id="coordinator" name="coordinator" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">תאריך הסעה&nbsp;<span class="required">*</span></label>
                                                    <div class="col-sm-6">
                                                        <!--<input type="text" class="form-control" placeholder="dd/mm/yyyy" id="dateRide" name="dateRide">-->
                                                        <input type="date" class="form-control" placeholder="dd/mm/yyyy" id="dateRide" name="dateRide"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">מספר הסעה</label>
                                                    <div class="col-sm-6">
                                                        <input id="ridePatNum" name="ridePatNum" type="text" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <hr />
                                <div class="text-right m-t-30 row">
                                    <button type="submit" id="saveCustomer" class="btn btn-success waves-effect w-md waves-light m-b-5  m-r-15"><i class="ti-save m-r-5"></i>שמור</button>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
            <!-- end container -->
        </div>
        <!-- end content -->
        <!-- FOOTER -->
        <footer class="footer text-right">
            2018 © כל הזכויות שמורות לעמותת בדרך להחלמה
        </footer>
        <!-- End FOOTER -->
    </div>
    <!-- ============================================================== -->
    <!-- End page content here -->
    <!-- ============================================================== -->
    </div>
    <!-- END wrapper -->
    <!--<script type="text/javascript">
        //DatePicker



        $(document).ready(function () {


            //if (JSON.parse(GENERAL.RIDEPAT.getRidePatList()).length != 0) {
            //    arr_customer = JSON.parse(GENERAL.RIDEPAT.getRidePatList());
            //    if (arr_customer.func != "show") {
            //    }
            //}


        });
    </script>-->
</body>
</html>
