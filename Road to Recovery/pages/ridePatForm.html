<!DOCTYPE html>

<html lang="en" dir=rtl>
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="KSMoving">
    <meta name="author" content="Coderthemes">

    <link rel="shortcut icon" href="assets/images/favicon_1.ico">

    <title>הסעת חולה</title>

    <!--<link href="../plugins/switchery/swiFtchery.min.css" rel="stylesheet" />-->
    <link href="assets/css/bootstrap-rtl.min.css" rel="stylesheet" type="text/css">
    <link href="assets/css/core.css" rel="stylesheet" type="text/css">
    <link href="assets/css/icons.css" rel="stylesheet" type="text/css">
    <link href="assets/css/components.css" rel="stylesheet" type="text/css">
    <link href="assets/css/pages.css" rel="stylesheet" type="text/css">
    <link href="assets/css/menu.css" rel="stylesheet" type="text/css">
    <link href="assets/css/responsive.css" rel="stylesheet" type="text/css">

    <script src="assets/js/CookiesFunctions.js"></script>

    <script src="assets/js/modernizr.min.js"></script>

    <script src="assets/js/jquery.min.js"></script>

    <!-- The jQuery library is a prerequisite for all jqSuite products -->
    <script type="text/ecmascript" src="assets/js/jquery.min.js"></script>
    <!-- This is the Javascript file of jqGrid -->
    <script type="text/ecmascript" src="Guriddo_jqGrid_JS_5.2.0/js/jquery.jqGrid.min.js"></script>
    <!-- We support more than 40 localizations -->
    <script type="text/ecmascript" src="Guriddo_jqGrid_JS_5.2.0/js/i18n/grid.locale-he.js"></script>
    <!-- A link to a Boostrap  and jqGrid Bootstrap CSS siles-->
    <link href="Guriddo_jqGrid_JS_5.2.0/css/ui.jqgrid-bootstrap.css" rel="stylesheet" />

    <!-- Sweet Alert css -->
    <link href="../plugins/bootstrap-sweetalert/sweet-alert.css" rel="stylesheet" type="text/css" />

    <!--GENERAL object and additional functions-->
    <script src="lib/lz-string.js"></script>
    <script src="lib/master.js"></script>

    <!-- Select2 css+js -->
    <link href="assets/css/select2.css" rel="stylesheet" />
    <script src="assets/js/select2.min.js"></script>

    <!--DatePicker css+js-->
    <!--<link href="../plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" rel="stylesheet">
    <link href="../plugins/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
    <script src="../plugins/moment/moment.js"></script>
    <script src="../plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="../plugins/bootstrap-daterangepicker/daterangepicker.js"></script>-->
    <!--timePicker css+js-->
    <!--<link href="../plugins/timepicker/bootstrap-timepicker.min.css" rel="stylesheet" />
    <script src="../plugins/timepicker/bootstrap-timepicker.min.js"></script>-->
    <!--Patient Autocomplete-->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <!-- <link rel="stylesheet" href="/resources/demos/style.css">-->
    <style>
        .sameWidthBtn {
            width: 170px;
            margin: 0;
        }

        /*override bootstrap*/
        .page-title-box {
            background: #ffffff00; /*tranparent*/
            box-shadow: none;
        }

        .ui-autocomplete {
            max-height: 100px;
            overflow-y: auto;
            /* prevent horizontal scrollbar */
            overflow-x: hidden;
        }
        /* IE 6 doesn't support max-height
        * we use height instead, but this forces the menu to always be this tall
        */
        * html .ui-autocomplete {
            height: 100px;
        }

        input[type=text]:focus {
            background-color: #FFE684;
        }

        .duplicateDisplay {
            display: none;
        }

        .duplicateDisplayOnShow {
            background-color: #F8F8B5
        }

        input[type=text], input[type=checkbox], input[type=date], #statusRidePat, #Origin, #Destination, #hour, #minute {
            border-color: #000
        }

        .saveHighlight {
            border: 10px solid yellow !important;
            color: yellow !important;
            transform: scaleY(1.25) scaleX(1.25);
        }

        .centerHeader {
            text-align: center;
        }
    </style>
    <!--<script src="https://code.jquery.com/jquery-1.12.4.js"></script>-->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script>
        var resizefunc = [];
    </script>

    <!--Validators-->
    <script src="../plugins/jquery-validation/dist/jquery.validate.min.js"></script>


    <!-- jQuery  -->
    <script src="assets/js/bootstrap-rtl.min.js"></script>
    <script src="assets/js/detect.js"></script>
    <script src="assets/js/fastclick.js"></script>
    <script src="assets/js/jquery.slimscroll.js"></script>
    <script src="assets/js/jquery.blockUI.js"></script>
    <script src="assets/js/waves.js"></script>
    <script src="assets/js/wow.min.js"></script>
    <script src="assets/js/jquery.nicescroll.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="../plugins/switchery/switchery.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>

    <!-- Sweet Alert js -->
    <script src="../plugins/bootstrap-sweetalert/sweet-alert.min.js"></script>
    <script src="assets/pages/jquery.sweet-alert.init.js"></script>

    <script src="assets/js/jquery.core.js"></script>
    <script src="assets/js/jquery.app.js"></script>
    <!--<script src="lib/datepicker-he.js"></script>-->
    <script src="lib/includeHTML.js"></script>
    <script>
        checkCookie();
        arr_addressRows = [];
        $.jgrid.defaults.responsive = true;
        $.jgrid.defaults.styleUI = 'Bootstrap';
        var currentOrigin = '';
        var currentDestination = '';
        var spaceInCar;
        var isWaiting = "";
        var checkEscorts = [];
        var checkEquipment = [];
        var checkEquipmentAnonymous = [];
        var anonymousName = "";
        var isAnonymous = false;
        var isAssistant = false;
        var driverId;
        var dateForPush = "";
        var hourForPush = "";
        var pushMsg = "";
        var arr_for_assistant = [];
        var patientsAssistent = [];
        var arr_arabNamesAssistent = [];
        var arr_englishNamesAssistent = [];
        var patientsAssistentDisplay = [];
        var patientsIdentityAssistent = [];
        var isCenterPoint = false;
        var isCenterPatient = false;
        var isRegularPatientNoCenter = false;
        var flagFirstOne = true;
        //0 means no driver is asigned to the ride
        var rideStatusForFields = 0;
        var ridePatId;
        var ridePat;
        var currentDriverId;
        var RideId;
        var driverMode = "";
        var firstDriverBeforeSwap = true;
        var drivers = [];
        var driversID = [];
        var addedEquipment = false;
        var deleteDriverFlag = false;
        var firstLoad = true;
        var hospitals = [];
        var isThisAReturnDrive = false;
        var rideNumberForNo;
        // var secondModal = false;
        var CoordinatorForReturn;
        let patients_JSONArray = [];
        let { buildStringforEquipment } = GENERAL.USEFULL_FUNCTIONS;
        let patients_Names = []
        let rideNumber = 0;
        let x_wasClicked = false;


        $(document).ready(function () {
            let { COPYWRITE } = GENERAL;
            $('#rights').html(COPYWRITE());
            //  GetCoordinatorsList();
            $('#saveCustomer').removeClass("saveHighlight");
            $('#deleteDriver').hide();
            generateDrivers()
            //$('#driversDiv').hide();

            $('#wait').hide();
            var pat = $("#pat").val();
            if (pat === "") {
                $("#patientInfo").hide();
            }
            isAssistant = JSON.parse(GENERAL.USER.getIsAssistant());
            //console.log(isAssistant);
            var assistantName = "";
            if (isAssistant) {
                $("#menuType").attr("w3-include-html", "HelperMenu.html");
                $("#duplicate").hide();
                $("#selectstatusRidePat").hide();
                $("#statuslabelRidePat").hide();
                var coorAssistant = GENERAL.USER.getCoorAssistant();
                assistantName = GENERAL.USER.getAsistantDisplayName();
            }
            else $("#menuType").attr("w3-include-html", "menu.html");
            includeHTML();
            $('[data-toggle="tooltip"]').tooltip();
            if (window.location.hostname.toString() == 'localhost' || window.location.pathname.toLowerCase().indexOf('test') != -1) {
                $("#na").css("background-color", "#ffde89");
            }
            if (window.location.href.indexOf('http://40.117.122.242/Road%20to%20Recovery/') != -1) {
                window.location.href = "notAvailable.html";
            }
            if (isAssistant) {
                var userName = GENERAL.USER.getAsistantAndCoorDisplayName();
                $("#userName").html(userName);
            }
            else {
                var userName = GENERAL.USER.getUserDisplayName();
                $("#userName").html(userName);
            }
            //datePicker();
            loadPage();
            $("#pat").blur(function () {
                // fillData();
                //getEquipmentForAnonymousPatient()

                let patientObj = patients_JSONArray.find(p => p.DisplayName === $('#pat').val());
                patientObj ? getPatientById(patientObj.Id) : "";

            });

            $("#pat").keyup(function () {
                $("#patEnglishName").val("");
                $("#patArabic").val("");
                $("#PatientIdentity").val("");
            });

            //$("#patArabic").blur(function () {
            //    fillData();
            //    getEquipmentForAnonymousPatient()
            //});
            ``
            $("#patArabic").keyup(function () {
                $("#pat").val("");
                $("#patEnglishName").val("");
                $("#PatientIdentity").val("");
            });

            $("#patEnglishName").blur(function () {
                //fillData();
                //getEquipmentForAnonymousPatient()

                let patientObj = patients_JSONArray.find(p => p.EnglishName === $('#patEnglishName').val());
                patientObj ? getPatientById(patientObj.Id) : "";

            });

            $("#patEnglishName").keyup(function () {
                $("#pat").val("");
                $("#patArabic").val("");
                $("#PatientIdentity").val("");
            });
            $("#PatientIdentity").blur(function () {
                //  fillData();
                let patientObj = patients_JSONArray.find(p => p.PatientIdentity === parseInt($('#PatientIdentity').val()));
                patientObj ? getPatientById(patientObj.Id) : "";
            });

            $("#PatientIdentity").keyup(function () {
                $("#pat").val("");
                $("#patEnglishName").val("");
                $("#patArabic").val("");
            });

            //if (JSON.parse(localStorage.getItem("PatientNameForRide")) !== null) {
            //    $("#pat").val(JSON.parse(localStorage.getItem("PatientNameForRide")));
            //    fillData();
            //    localStorage.setItem("PatientNameForRide", null);
            //}

            // DO NOT REMOVE : GLOBAL FUNCTIONS!
            var errorClass = 'invalid';
            var errorElement = 'em';
            var $serviceForm = $('#customerForm').validate({

                highlight: function (element) {
                    jQuery(element).closest('.form-group').addClass('has-error');
                },
                unhighlight: function (element) {
                    jQuery(element).closest('.form-group').removeClass('has-error');
                },

                // Rules for form validation
                rules: {
                    dateRide: {
                        required: true
                    },
                    pat: {
                        required: true
                    },
                    //patArabic: {
                    //    required: true
                    //},
                    Origin: {
                        required: true
                    },
                    Destination: {
                        required: true
                    },
                    coordinator: {
                        required: true
                    },
                },
                submitHandler: function (form, event) {
                    $('#wait').show();
                    event.preventDefault();
                    var valid = validateInputs();
                    if (!valid) return false;
                    var numberOfRides = 1;
                    var repeatRide = "";
                    if (anonymousName == "True") {
                        isAnonymous = true;
                    }
                    if ($("#duplicateRidePat").is(':checked')) {
                        numberOfRides = parseInt($("#numberOfRides").val());
                        repeatRide = $("#repeatRide").val();
                    }
                    if (numberOfRides > 1) {
                        var validRides = PrintRides(repeatRide, numberOfRides);
                        if (!validRides) return false;
                    }

                    localStorage.setItem("numberOfRides", numberOfRides);
                    localStorage.setItem("repeatRide", repeatRide);
                    localStorage.setItem("dateForReturnRepeat", $("#dateRide").val());



                    var RidePatNum = $("#ridePatNum").val();
                    var Pat = new Object();
                    Pat.DisplayName = $("#pat").val();
                    Pat.DisplayName = Pat.DisplayName.replace(/\s\s+/g, ' ');
                    Pat.Id = localStorage.PatID;
                    var Origin = new Object();
                    Origin.Name = $("#Origin").val();
                    var Destination = new Object();
                    Destination.Name = $("#Destination").val();
                    var Remark = $("#remark").val();
                    var dateRide = $("#dateRide").val();
                    var hours = $("#hour").val();
                    var minutes = $("#minute").val();
                    //dateRide + " " + hours + ":" + minutes;
                    var Day = parseInt(dateRide.substring(8));
                    var Month = parseInt(dateRide.substring(5, 7)) - 1;
                    var Year = parseInt(dateRide.substring(0, 4));
                    dateForPush = Day + "/" + Month + "/" + Year;
                    var Hour = parseInt(hours);
                    var Minute = parseInt(minutes);
                    hourForPush = hours + ":" + minutes;
                    if ($("#afterNoon").is(':checked')) { //22:14 is the default time that means afternoon אחה''צ
                        Hour = 22;
                        Minute = 14;
                        hourForPush = "אחה\"צ"
                    }
                    var date = new Date(Year, Month, Day, Hour, Minute);
                    var func = arr_customer.func;
                    //if (!flagFirstOne) {
                    //    func = "edit";
                    //}





                    var Coordinator = new Object();
                    Coordinator.DisplayName = $("#coordinator").val();
                    var OnlyEscort = false;
                    if ($("#onlyEscort").is(':checked')) {
                        OnlyEscort = true;
                    }

                    //set Escorts
                    let Escorts = [];
                    let Escort = {};
                    $('#selectEscort input:checked').each(function () {
                        Escort = {};
                        Escort.Id = parseInt($(this).attr('id'));
                        Escorts.push(Escort);
                    });

                    //in case of different equipment than declared for anonymous ridepat.
                    var str = "";
                    //if (func == "edit" && anonymousName == "True" && isWaiting != "ממתינה לשיבוץ") {
                    if (func == "edit" && checkEquipment.length != checkEquipmentAnonymous.length) {
                        if (checkEquipment.length > checkEquipmentAnonymous.length) {
                            alert("ירד ציוד מההסעה");
                        }
                        if (checkEquipment.length <= checkEquipmentAnonymous.length) {
                            //for (var j = 0; j < checkEquipmentAnonymous.length; j++) {
                            //    for (var i = 0; i < checkEquipment.length; i++) {
                            //        if (checkEquipment[i] == checkEquipmentAnonymous[j]) {
                            //            continue;
                            //        }
                            //        str += checkEquipment[i] + ", ";
                            //        addedEquipment = true;
                            //    }
                            //}
                            //if (addedEquipment) {

                            //    var answer = confirm("ציוד " + str + " נוסף לנסיעה\n האם להמשיך בעריכה? ");
                            //    if (!answer) {
                            //        location.href = "manageRidePats.html";
                            //        return false;
                            //    } else {
                            //        getEquipmentForPatient();
                            //    }

                            //}
                            for (var i = 0; i < checkEquipmentAnonymous.length; i++) {
                                str += checkEquipmentAnonymous[i] + ", ";
                            }
                            var answer = confirm("נוסף ציוד לנסיעה. \nהציוד בנסיעה יהיה: " + str + " \n האם להמשיך בעריכה? ");
                            if (!answer) {
                                location.href = "manageRidePats.html";
                                return false;
                            } else {
                                getEquipmentForPatient();
                            }

                        }
                        getEquipmentForPatient();
                    }

                    //in case of more escorts than declared for anonymous ridepat.
                    if (func == "edit" && (anonymousName == "True" || isAssistant) && isWaiting != "ממתינה לשיבוץ") {
                        if (checkEscorts.length < Escorts.length) {
                            genarteAvailbaleSeats();
                            checkSpaceInCar = spaceInCar + checkEscorts.length - Escorts.length;
                            if (checkSpaceInCar > Escorts.length) {
                                var numberOfAddedEscorts = Escorts.length - checkEscorts.length;

                                var answer = confirm("נוספו מלווים להסעה, מספר המלווים שנוספו הוא: " + numberOfAddedEscorts + ", למרות זאת, יש עדיין מקום ברכב המתנדב. האם תרצה להמשיך בעריכה? ");
                                if (!answer) {
                                    location.href = "manageRidePats.html";
                                    return false;
                                }
                            }
                            else {
                                var numberOfAddedEscorts = Escorts.length - checkEscorts.length;
                                var numberOfSeatsAv = spaceInCar + checkEscorts.length;
                                if (isAssistant) {
                                    swal({
                                        title: "Can't add escorts to the ride, not enough space in the driver car.",
                                        type: "warning",
                                        showConfirmButton: true
                                    });
                                    return false;
                                }
                                else {
                                    var answer = confirm(" נוספו " + numberOfAddedEscorts + " מלווים. מספר המקומות הפנויים ברכב הוא: " + numberOfSeatsAv + " האם תרצה להמשיך בעריכה?");
                                    if (!answer) {
                                        location.href = "manageRidePats.html";
                                        return false;
                                    }
                                }
                            }
                        }
                    }

                    if (func == "new") {
                        RidePat = {
                            Pat: Pat, Origin: Origin, Destination: Destination, Coordinator: Coordinator, Remark: Remark, Escorts: Escorts, Date: date, OnlyEscort: OnlyEscort
                        }
                        var userName = GENERAL.USER.getAsistantDisplayName();
                        pushMsg = "העוזר " + userName + " הקים נסיעה חדשה עם החולה " + $("#pat").val() + " בתאריך " + dateForPush + " בשעה " + hourForPush + " מ" + $("#Origin").val() + " ל" + $("#Destination").val();



                        //NEW 24.07.20

                        //rideBack = false;
                        //if (rideBack) {
                        //    tmpOrigin = Origin;
                        //    Origin = Destination;
                        //    Destination = tmpOrigin;
                        //    date = new Date(Year, Month, Day, 22, 14);
                        //    RidePatBack = {
                        //        Pat: Pat, Origin: Origin, Destination: Destination, Coordinator: Coordinator, Remark: Remark, Escorts: Escorts, Date: date, OnlyEscort: OnlyEscort
                        //    }
                        //    console.log(RidePat)
                        //    console.log(RidePatBack)
                        //    var requestBack = { RidePat: RidePatBack, func: func, isAnonymous: isAnonymous, numberOfRides: numberOfRides, repeatRideEvery: repeatRide }
                        //    var dataString = JSON.stringify(requestBack);

                        //    $.ajax({
                        //        dataType: "json",
                        //        url: "WebService.asmx/setRidePat",
                        //        contentType: "application/json; charset=utf-8",
                        //        type: "POST",
                        //        async: false,
                        //        data: dataString,
                        //        success: function (data) {
                        //            //SaveAddresses(0, numberOfRecords, customerID);
                        //            console.log("num: " + data.d);
                        //            if (data.d !== 1) {
                        //                swal({
                        //                    title: "נשמרה ההסעה חזור\nلقت تمت عملية الحفظ",
                        //                    type: "success",
                        //                    timer: 1000,
                        //                    showConfirmButton: false
                        //                });
                        //            }
                        //        },
                        //        error: function (err) {
                        //            swal(
                        //                "خطأ\nשגיאה",
                        //                "משהו השתבש ברישום ההסעה חזור, צא ונסה שנית",
                        //                "warning"
                        //            );

                        //        }
                        //    });
                        //}



                        //END NEW


                    }
                    else {
                        if (x_wasClicked) {
                            x_wasClicked = false;
                            RidePat = {
                                RidePatNum: rideNumber, Pat: Pat, Origin: Origin, Destination: Destination, Coordinator: Coordinator, Date: date, Remark: Remark,
                                Escorts: Escorts, OnlyEscort: OnlyEscort
                            }

                        } else {
                            RidePat = {
                                RidePatNum: RidePatNum, Pat: Pat, Origin: Origin, Destination: Destination, Coordinator: Coordinator, Date: date, Remark: Remark,
                                Escorts: Escorts, OnlyEscort: OnlyEscort
                            }
                            if (RidePat.RidePatNum === "") {
                                RidePat.RidePatNum = 0;
                            }
                        }
                    }
                    if (isThisAReturnDrive) {
                        var request = { RidePat: RidePat, func: "new", isAnonymous: isAnonymous, numberOfRides: numberOfRides, repeatRideEvery: repeatRide }
                    } else {
                        var request = { RidePat: RidePat, func: func, isAnonymous: isAnonymous, numberOfRides: numberOfRides, repeatRideEvery: repeatRide }
                    }
                    var dataString = JSON.stringify(request);
                    localStorage.setItem("PatientNameForRide", null);
                    $.ajax({
                        dataType: "json",
                        url: "WebService.asmx/setRidePat",
                        contentType: "application/json; charset=utf-8",
                        type: "POST",
                        data: dataString,
                        success: function (data) {
                            //SaveAddresses(0, numberOfRecords, customerID);
                            //    console.log("num: " + data.d);
                            if (data.d === 1) {
                                //there is such a drive and status is not נמחקה

                                data.d = data.d.toString();
                                var temp = data.d.replace(/(?!^)(\d{2})(?=(?:\d{2})*$)/g, '/$1');
                                //var dateToShow = data.d.replace(;
                                $('#wait').hide();
                                swal(
                                    "خطأ\nשגיאה",
                                    "קיימת כבר הסעה בתאריך " + date + " עם אותו החולה ואותן נקודות האיסוף\nيوجد سفرية بالتاريخ (التاريخ) مع نفس المريض ونفس نقطة الالتقاء",
                                    "warning"
                                );

                            } else if (data.d < 0) { //there is such a drive and status = נמחקה

                                let rideNumber = data.d * -1; //retriving the rideNumber back to positive number
                                rideNumberForNo = rideNumber;
                                let returnDriveExist = false;
                                tmpOrigin = Origin;
                                Origin = Destination;
                                Destination = tmpOrigin;
                                RidePatBack = {
                                    Pat: Pat, Origin: Origin, Destination: Destination, Coordinator: Coordinator, Remark: Remark, Escorts: Escorts, Date: date, OnlyEscort: OnlyEscort
                                }
                                $.ajax({
                                    dataType: "json",
                                    url: "WebService.asmx/CheckRidePat",
                                    contentType: "application/json; charset=utf-8",
                                    type: "POST",
                                    async: false,
                                    data: JSON.stringify({ RidePatBack }),
                                    success: function (data) {
                                        $('#wait').hide();
                                        let driverInput_hasValue = ($('#driver').val() !== "");

                                        returnDriveExist = JSON.parse(data.d);
                                        console.log(returnDriveExist)
                                        var DestIsHospital = hospitals.includes(request.RidePat.Destination.Name);

                                        if (driverInput_hasValue) {
                                            currentDriverId = -1;
                                            addDriver(rideNumber);
                                        }

                                        if (DestIsHospital && !returnDriveExist) {//offer a return ride
                                            document.getElementById('ModalTitle').innerHTML = 'הנסיעה שוחזרה בהצלחה';

                                            document.getElementById('modalButtons').innerHTML = '<button onclick="createNewRide()" class="btn btn-success waves-effect w-md m-b-5 sameWidthBtn"><i class="ti-plus m-r-5"></i>יצירת הסעה חדשה</button>&nbsp;';
                                            document.getElementById('modalButtons').innerHTML += '<button onclick="return2manageRidePats()" class="btn btn-default waves-effect w-md m-b-5 sameWidthBtn">חזרה לניהול ההסעות שלי<i class="ti-back-right m-r-5"></i></button>';
                                            document.getElementById('modalButtons').innerHTML += '<button onclick="createReturnRide()" class="btn btn-success waves-effect w-md m-b-5 sameWidthBtn">יצירת החזרה &nbsp;<i class="ti-car m-r-5"></i></button>';
                                            $("#Modal").modal('show');

                                        } else { // dont offer return drive
                                            document.getElementById('ModalTitle').innerHTML = 'הנסיעה שוחזרה בהצלחה';
                                            document.getElementById('modalButtons').innerHTML = '<button onclick="createNewRide()" class="btn btn-success waves-effect w-md m-b-5 sameWidthBtn"><i class="ti-plus m-r-5"></i>יצירת הסעה חדשה</button>&nbsp;';
                                            document.getElementById('modalButtons').innerHTML += '<button onclick="return2manageRidePats()" class="btn btn-default waves-effect w-md m-b-5 sameWidthBtn">חזרה לניהול ההסעות שלי<i class="ti-back-right m-r-5"></i></button>';

                                            $("#Modal").modal('show');
                                        }

                                    },
                                    error: function (err) { $('#wait').hide(); alert("Error in CheckRidePat: " + err.responseText); }
                                });
                            }
                            else {
                                rideNumber = data.d;
                                rideNumberForNo = rideNumber;
                                //$('#Modal').modal('show');
                                var returnDriveExist = false;

                                tmpOrigin = Origin;
                                Origin = Destination;
                                Destination = tmpOrigin;
                                RidePatBack = {
                                    Pat: Pat, Origin: Origin, Destination: Destination, Coordinator: Coordinator, Remark: Remark, Escorts: Escorts, Date: date, OnlyEscort: OnlyEscort
                                }

                                $.ajax({
                                    dataType: "json",
                                    url: "WebService.asmx/CheckRidePat",
                                    contentType: "application/json; charset=utf-8",
                                    type: "POST",
                                    async: false,
                                    data: JSON.stringify({ RidePatBack }),
                                    success: function (data) {
                                        $('#wait').hide();
                                        let driverInput_hasValue = ($('#driver').val() !== "");
                                        returnDriveExist = JSON.parse(data.d);
                                        console.log(returnDriveExist)
                                        var DestIsHospital = hospitals.includes(request.RidePat.Destination.Name);
                                        if (driverInput_hasValue) {
                                            currentDriverId = -1;
                                            addDriver(rideNumber);
                                        }

                                        if (DestIsHospital && !returnDriveExist) {//offer a return ride
                                            document.getElementById('ModalTitle').innerHTML = 'הנסיעה נשמרה';

                                            document.getElementById('modalButtons').innerHTML = '<button onclick="createNewRide()" class="btn btn-success waves-effect w-md m-b-5 sameWidthBtn"><i class="ti-plus m-r-5"></i>יצירת הסעה חדשה</button>&nbsp;';
                                            document.getElementById('modalButtons').innerHTML += '<button onclick="return2manageRidePats()" class="btn btn-default waves-effect w-md m-b-5 sameWidthBtn">חזרה לניהול ההסעות שלי<i class="ti-back-right m-r-5"></i></button>';
                                            document.getElementById('modalButtons').innerHTML += '<button onclick="createReturnRide()" class="btn btn-success waves-effect w-md m-b-5 sameWidthBtn">יצירת החזרה &nbsp;<i class="ti-car m-r-5"></i></button>';

                                            $("#Modal").modal('show');

                                        } else { // dont offer return drive
                                            document.getElementById('ModalTitle').innerHTML = 'הנסיעה נשמרה';
                                            document.getElementById('modalButtons').innerHTML = '<button onclick="createNewRide()" class="btn btn-success waves-effect w-md m-b-5 sameWidthBtn"><i class="ti-plus m-r-5"></i>יצירת הסעה חדשה</button>&nbsp;';
                                            document.getElementById('modalButtons').innerHTML += '<button onclick="return2manageRidePats()" class="btn btn-default waves-effect w-md m-b-5 sameWidthBtn">חזרה לניהול ההסעות שלי<i class="ti-back-right m-r-5"></i></button>';

                                            $("#Modal").modal('show');
                                        }
                                    },
                                    error: function (err) { $('#wait').hide();alert("Error in CheckRidePat: " + err.responseText); }
                                });


                            }

                        },
                        error: function (err) {
                            $('#wait').hide();
                            console.log(err);
                            swal(
                                "خطأ\nשגיאה",
                                "משהו השתבש, צא ונסה שנית\nحدث خطأ ما، الرجاء الخروج والدخول مرة اخرى",
                                "warning"
                            );
                        }
                    });



                    return false;
                },

                // Messages for form validation
                messages: {
                    dateRide: {
                        required: "יש להכניס תאריך"
                    },
                    pat: {
                        required: "יש לבחור חולה\nيجب اختيار مريض من القائمة"
                    },
                    Origin: {
                        required: "יש לבחור מוצא"
                    },
                    Destination: {
                        required: "יש לבחור יעד"
                    },
                    coordinator: {
                        required: "יש לבחור רכז אחראי"
                    },
                },


            });

            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getHospitalView",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                async: false,
                data: JSON.stringify({ active: true }),
                success: function (data) {
                    arr_hospitals = JSON.parse(data.d);
                    for (i in arr_hospitals) {
                        hospitals.push(arr_hospitals[i].Name)
                    }
                },
                error: function (err) { alert("Error in getHospitalView: " + err.responseText); }
            });

        });

        const getPatientById = (id) => {

            const getPatientById_SCB = (data) => {
                $('#wait').hide();
                fillPage_withPatientData(JSON.parse(data.d));
            }

            const getPatientById_ECB = (err) => {
                $('#wait').hide();
                alert(err);
            }

            const { ajaxCall } = GENERAL.FETCH_DATA;
            $('#wait').show();
            ajaxCall('GetPatientById', JSON.stringify({ id }), getPatientById_SCB, getPatientById_ECB);

        }

        const fillPage_withPatientData = (patient) => {
            localStorage.PatID = patient.Id;
            $('#pat').val(patient.DisplayName);
            $('#patEnglishName').val(patient.EnglishName);
            $('#patArabic').val(patient.FirstNameA + " " + patient.LastNameA);
            if (patient.EscortedList.length > 0) {
                EscortedList = patient.EscortedList;
                let str = '';

                for (var i = 0; i < EscortedList.length; i++) {
                    str += `<input id='escortCB${EscortedList[i].Id}' type=checkbox name='${EscortedList[i].EnglishName}'>&nbsp`;
                    str += `<label data-toggle='tooltip' title='${EscortedList[i].EnglishName}' for='escortCB${EscortedList[i].Id}'>${EscortedList[i].DisplayName}</label>&nbsp&nbsp</br>`;
                }
                $("#selectEscort").html(str);
            }

            $('#remark').val(patient.Remarks);
            $('#remark').prop('disabled', false);
            $('#PatientIdentity').val(patient.PatientIdentity);
            $('#Origin').val(patient.Barrier.Name);
            $('#Origin').prop('disabled', false);
            $('#Destination').val(patient.Hospital.Name);
            $('#Destination').prop('disabled', false);
            $('#Equipment').text(buildStringforEquipment(patient.Equipment));

            $('#minute').prop('disabled', false);
            $('#hour').prop('disabled', false);
            $('#dateRide').prop('disabled', false);
        }

        function returnRide() {
            ridePatNum = " ";
            arr_details = { ridePatNum: ridePatNum, func: "new" };
            GENERAL.RIDEPAT.setRidePatList(JSON.stringify(arr_details));

            switchDir();

            if (isThisAReturnDrive) {
                $("#driver").val("");
                $('#deleteDriver').hide();

            }

        }

        function addDriver(data) {

            var tmpDriverName = $('#driver').val();
            var driverIndex = drivers.indexOf($('#driver').val());
            userSelected = driversID[driverIndex];

            ridePatId = data;

            localStorage.setItem("ridePatId", ridePatId);


            //if (arr_customer.func == "new") {

            //    arr_details = { RidePatNum: ridePatId, func: "edit" }; //ridePat.name=RidePatNum
            //    GENERAL.RIDEPAT.setRidePatList(JSON.stringify(arr_details));
            //}



            if (!(ridePat == undefined)) {
                if (ridePat.Drivers.length > 0) {
                    //$('#Driver').val(ridePat.Drivers[0].Id)
                    flagFirstOne = false;
                    var driverIDindex = driversID.indexOf(ridePat.Drivers[0].Id);

                    if (!deleteDriverFlag) {
                        $('#driver').val(drivers[driverIDindex])
                        currentDriverId = ridePat.Drivers[0].Id;
                        $('#deleteDriver').show();
                        //flagFirstOne = false;
                        deleteDriverFlag = false;
                    }


                }
            } else if (!deleteDriverFlag) {
                var driverIndex = drivers.indexOf($('#driver').val());
                userSelected = driversID[driverIndex];
                deleteDriverFlag = false;
            }

            if (flagFirstOne || isThisAReturnDrive) {
                currentDriverId = -1; // There is no driver assigned to the ride
                flagFirstOne = false;

            }


            signDriverToRide()
            $('#driver').val(tmpDriverName)


            if (isAssistant && pushMsg !== "") {
                //send messege to coordinator from assistant on new ridepat creation.
                sendMessegeFromAssistant(data, pushMsg);
            }
        }

        function sendMessegeFromAssistant(ridepat, msg) {
            var user = GENERAL.USER.getUserName();
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/pushAssistant",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                async: false,
                data: JSON.stringify({ ridepat: ridepat, cellphone: user, msg: msg }),
                error: pushAssistantErrorCB,

            });
        }

        function pushAssistantErrorCB(error) {
            console.log(error);
        }

        function formatDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;

            return [day, month, year].join('/');
        }

        function PrintRides(repeatRide, num) {
            var duplicateDetails = {
                repeatRide: $('#repeatRide').val(),
                numberOfRides: $('#numberOfRides').val()
            }
            localStorage.setItem("duplicateRidePat", JSON.stringify(duplicateDetails));

            var datesToPrint = num + " הסעות חדשות יווצרו בתאריכים:\n";
            var dateRide = $("#dateRide").val();
            var hours = $("#hour").val();
            var minutes = $("#minute").val();

            var Day = parseInt(dateRide.substring(8));
            var Month = parseInt(dateRide.substring(5, 7)) - 1;
            var Year = parseInt(dateRide.substring(0, 4));
            var Hour = parseInt(hours);
            var Minute = parseInt(minutes);
            if ($("#afterNoon").is(':checked')) { //22:14 is the default time that means afternoon אחה''צ
                Hour = 22;
                Minute = 14;
            }
            var date = new Date(Year, Month, Day, Hour, Minute);

            if (repeatRide === "כל שבוע") {
                for (let i = 0; i < num; i++) {
                    datesToPrint += formatDate(date) + "\n";
                    date = new Date(date.setDate(date.getDate() + 7));
                }
            }
            else {
                for (let i = 0; i < num; i++) {
                    datesToPrint += formatDate(date) + "\n";
                    date = new Date(date.setDate(date.getDate() + 1));
                }
            }



            if (confirm(datesToPrint)) {
                return true;
            }
            return false;
        }

        const getPatients_slim = () => {

            const getPatients_slim_ECB = (err) => {
                alert(err);
            }

            const getPatients_slim_SCB = (data) => {
                patients_JSONArray = JSON.parse(data.d);

                patients_Names = [];//DisplayName
                let patients_EnglishNames = [];//EnglishName
                let patients_identityNum = [];//PatientIdentity

                for (var i = 0; i < patients_JSONArray.length; i++) {

                    if (isAssistant && patients_JSONArray[i].IsAnonymous === true) { //CHECK AND TEST
                        continue;
                    }
                    patients_Names.push(patients_JSONArray[i].DisplayName.trim());
                    patients_EnglishNames.push(patients_JSONArray[i].EnglishName.trim());
                    patients_identityNum.push(patients_JSONArray[i].PatientIdentity.toString());
                }

                $("#pat").autocomplete({
                    source: patients_Names
                });
                $("#patEnglishName").autocomplete({
                    source: patients_EnglishNames
                });
                $("#PatientIdentity").autocomplete({
                    source: patients_identityNum
                });


            }

            const { ajaxCall_WithGzipMe } = GENERAL.FETCH_DATA;
            ajaxCall_WithGzipMe('GetPatients_slim', JSON.stringify({ isActive: true }), getPatients_slim_SCB, getPatients_slim_ECB, false);
        }

        //OLD AND SLOW WAY TO GET PATIENTS FOR AUTO COMPLETE ↓ disabled by Yogev
        /*
        function generatePat() {

            var $select = $("#pat");
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getPatients",

                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Content-Encoding", "gzip");
                },
                type: "POST",
                async: false,
                data: JSON.stringify({ active: "true" }),
                //data: "",
                success: function (data) {

                    arr_pat = JSON.parse(data.d);

                    patients = [];
                    patientsIdentity = [];
                    arr_arabNames = [];
                    arr_englishNames = [];
                    patientsAssistent = [];
                    patientsAssistentDisplay = [];
                    arr_arabNamesAssistent = [];
                    arr_englishNamesAssistent = [];
                    patientsIdentityAssistent = [];
                    for (i in arr_pat) {
                        //assistant cannot create anonymouse ride.

                        if (isAssistant && arr_pat[i].IsAnonymous !== "") { //If the user is an assistant - two different lists will be made. one list of annonymous patients and one list of "regular" patients.
                            patientsIdentityAssistent.push(arr_pat[i].PatientIdentity)
                            patientsAssistent.push(arr_pat[i]); // List of annonymous patients
                            patientsAssistentDisplay.push(arr_pat[i].DisplayName.trim())
                            arr_arabNamesAssistent.push(arr_pat[i].DisplayNameA);
                            arr_englishNamesAssistent.push(arr_pat[i].EnglishName);
                            continue;
                        }
                        patients.push(arr_pat[i].DisplayName.trim());
                        patientsIdentity.push(arr_pat[i].PatientIdentity)
                        arr_arabNames.push(arr_pat[i].DisplayNameA);
                        arr_englishNames.push(arr_pat[i].EnglishName);
                        arr_for_assistant.push(arr_pat[i]);
                    }
                    if (isAssistant) {
                        arr_pat = arr_for_assistant;
                    }


                    $("#driver").autocomplete({
                        source: drivers
                    });


                    $("#patArabic").autocomplete({
                        source: arr_arabNames
                    });


                },
                error: function (err) {
                    alert("Error in generatePat");
                    console.log(err);

                }
            });
        }
        */
        //OLD AND SLOW WAY TO GET PATIENTS FOR AUTO COMPLETE ↑ disabled by Yogev

        function generatePatAnonymous(origin, destination) {
            var $select = $("#pat");
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getPatientsForAnonymous",
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Content-Encoding", "gzip");
                },
                type: "POST",
                async: false,
                data: JSON.stringify({ active: true, origin: origin, dest: destination }),
                success: function (data) {
                    arr_pat = JSON.parse(data.d);

                    patients = [];
                    arr_arabNames = [];
                    arr_englishNames = [];
                    patientsIdentity = [];
                    for (i in arr_pat) {
                        patients.push(arr_pat[i].DisplayName.trim());
                        arr_arabNames.push(arr_pat[i].DisplayNameA);
                        arr_englishNames.push(arr_pat[i].EnglishName);
                        patientsIdentity.push(arr_pat[i].PatientIdentity);
                    }

                    $("#pat").autocomplete({
                        source: patients
                    });

                    $("#patArabic").autocomplete({
                        source: arr_arabNames
                    });
                    $("#patEnglishName").autocomplete({
                        source: arr_englishNames
                    });
                    $("#PatientIdentity").autocomplete({
                        source: patientsIdentity
                    });
                },
                error: function (err) { alert("Error in getPatientsForAnonymous"); }
            });
        }

        function getAnonymousPatientsListForArea(origin, destination, area) {
            var $select = $("#pat");
            $('#wait').show();
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getAnonymousPatientsListForArea",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                async: false,
                data: JSON.stringify({ active: true, origin: origin, dest: destination, area: area }),
                success: function (data) {
                    arr_pat = JSON.parse(data.d);

                    patients = [];
                    arr_arabNames = [];
                    arr_englishNames = [];
                    patientsIdentity = [];
                    for (i in arr_pat) {
                        patients.push(arr_pat[i].DisplayName.trim());
                        arr_arabNames.push(arr_pat[i].DisplayNameA);
                        arr_englishNames.push(arr_pat[i].EnglishName);
                        patientsIdentity.push(arr_pat[i].PatientIdentity);
                    }
                    $('#wait').hide();
                    $("#pat").autocomplete({
                        source: patients
                    });

                    $("#patArabic").autocomplete({
                        source: arr_arabNames
                    });
                    $("#patEnglishName").autocomplete({
                        source: arr_englishNames
                    });
                    $("#PatientIdentity").autocomplete({
                        source: patientsIdentity
                    });
                },
                error: function (err) { alert("Error in getPatientsForAnonymous"); }
            });
        }

        function genarteAvailbaleSeats() {
            var ridePatNumber = parseInt($("#ridePatNum").val());
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getSpaceInCar",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                async: false,
                data: JSON.stringify({ ridePatNum: ridePatNumber, driverId: driverId }),
                success: function (data) {
                    spaceInCar = JSON.parse(data.d);
                },
                error: function (err) { alert("Error in getSpaceInCar"); }
            });
        }

        function getCoor() {
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getCoor",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                //async: false,
                data: JSON.stringify({ userName: GENERAL.USER.getUserName() }),
                success: getCoorSuccessCB,
                error: getCoorErrorCB
            });
        }

        function getCoorSuccessCB(data) {

            var $select = $("#coordinator");
            var coor = JSON.parse(data.d);


            $select.val(coor.DisplayName);
            if (isAnonymous === true) {
                $select.is("checked:", "checked");
            }
        }

        function getCoorErrorCB(e) {
            alert("Error in getCoor: " + e.responseText);
        }

        function generateEsc() {

            //first checking if the patient is anonymous.
            var displayName = $("#pat").val();
            displayName = displayName.replace(/\s\s+/g, ' ');
            var i = patients.indexOf($("#pat").val().trim().replace(/\s\s+/g, ' '));
            localStorage.PatID = arr_pat[i].Id;

            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getPatientEscorted",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                async: false,
                data: JSON.stringify({ displayName: displayName, caller: "ridePatForm" }),
                success: generateEscSuccessCB,
                error: generateEscErrorCB
            });
        }

        function generateEscSuccessCB(data) {
            arr_escort = JSON.parse(data.d);

            var str = "";

            var displayName = $("#pat").val().trim().replace(/\s\s+/g, ' ');

            var j = patients.indexOf($("#pat").val().trim().replace(/\s\s+/g, ' '));
            localStorage.PatID = arr_pat[j].Id;

            for (i in arr_escort) {
                var escort1 = arr_escort[i].DisplayName;
                var escort = arr_escort[i].DisplayName.replace("'", "");
                var id = arr_escort[i].Id;
                if (arr_pat[j].IsAnonymous == "True" && arr_customer.func == "new") {
                    str += "<input checked id='escortCB" + id + "' type=checkbox name='" + escort + "'>&nbsp";
                    str += "<label data-toggle='tooltip' title='" + arr_escort[i].EnglishName + "' for='escortCB" + id + "'>" + escort1 + "</label>&nbsp&nbsp</br>";
                }
                else {
                    str += "<input id='escortCB" + id + "' type=checkbox name='" + escort + "'>&nbsp";
                    str += "<label data-toggle='tooltip' title='" + arr_escort[i].EnglishName + "' for='escortCB" + id + "'>" + escort1 + "</label>&nbsp&nbsp</br>";
                }
            }
            if (arr_escort.length == 0) str = "<label data-toggle='tooltip' title='no escorts'>אין מלווים</label>";
            $("#selectEscort").html(str);

            if (arr_customer.func == "show") {
                var select = $("#selectEscort input");
                for (var i = 0; i < select.length; i++) {
                    $("#selectEscort input").eq(i).prop('disabled', true);
                }
            }

        }

        function generateEscErrorCB() {
            alert("Error in generateEsc");
        }

        function generateStatus() {

            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getAllStatus",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                //async: false,
                //data: JSON.stringify({ patient: dataString }),
                success: generateStatusSuccessCB,
                error: generateStatusErrorCB
            });

            function generateStatusSuccessCB(data) {
                var $select = $("#statusRidePat");
                var arr_status = JSON.parse(data.d);
                for (i in arr_status) {
                    var status = arr_status[i].Name;
                    $('<option>', { value: status, text: status }).appendTo($select);
                }
                if (arr_customer.func == "new") {
                    $("#statusRidePat option[value='ממתינה לשיבוץ']").prop('selected', true);
                }

            }

            function generateStatusErrorCB() {
                alert("Error in generateStatus");
            }
        }

        function generateLocation() {
            var $select = $("#Origin");
            var $select1 = $("#Destination");
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getDestinationView",
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Content-Encoding", "gzip");
                },
                type: "POST",
                async: false,
                data: JSON.stringify({ active: true }),
                success: function (data) {
                    var arr_locations = JSON.parse(data.d);
                    arr_locations.sort();
                    for (i in arr_locations) {

                        $('<option>', { value: arr_locations[i].Name, text: arr_locations[i].EnglishName }).appendTo($select);
                        $('<option>', { value: arr_locations[i].Name, text: arr_locations[i].EnglishName }).appendTo($select1);

                    }
                },
                error: function (err) { alert("Error in generateLocation"); }
            });
        }

        function generateHour() {
            var $select = $("#hour");
            for (var i = 0; i < 24; i++) {
                if (i < 10) i = "0" + i;
                $('<option>', { value: i, text: i }).appendTo($select);
            }
            $select.val("06");
        }

        function generateMinute() {
            var $select = $("#minute");
            for (var i = 0; i < 60; i += 15) {
                if (i < 10) var j = "0" + i; else j = i;
                $('<option>', { value: j, text: j }).appendTo($select);
            }
            $select.val("00");
        }

        function validateInputs() {

            let patientExists = false;
            let origin = $("#Origin").val();
            let destination = $("#Destination").val();
            let driverExist = true;

            let patientName = $("#pat").val().trim();

            for (var i = 0; i < patients_Names.length; i++) {
                patientExists = patientName === patients_Names[i].trim();
                if (patientExists) {
                    break;
                }
            }

            if (!patientExists) {
                return swal(
                    "خطأ\nשגיאה",
                    "يجب اختيار مريض من القائمة\nיש לבחור חולה מתוך הרשימה",
                    "warning"
                );
            }

            if (origin === "בחר מוצא" || origin === '') {
                return swal(
                    "خطأ\nשגיאה",
                    "يجب اختيار نقطة انطلاق من القائمة\nיש לבחור מוצא מתוך הרשימה",
                    "warning"
                );
            }

            if (destination === "בחר יעד" || destination === '') {
                return swal(
                    "خطأ\nשגיאה",
                    "يجب اختيار نقطة انطلاق من القائمة\nיש לבחור יעד מתוך הרשימה",
                    "warning"
                );
            }

            var date = document.getElementById("dateRide").value;
            var Day = parseInt(date.substring(8));
            var Month = parseInt(date.substring(5, 7)) - 1;
            var Year = parseInt(date.substring(0, 4));
            date = new Date(Year, Month, Day, $("#hour").val(), $("#minute").val());
            futureDate = checkFutureDate(date);
            if (!futureDate) {
                return confirm(" זמן ההסעה עבר, האם להמשיך?"); //yes will return true and vice verse
            }

            var timeMatch = true;
            var aN = $("#afterNoon").is(':checked');
            if (!aN) {
                if ($("#hour").val() == "שעות" || $("#minute").val() == "דקות") {
                    return swal(
                        "خطأ\nשגיאה",
                        "השעה שנבחרה אינה חוקית\nالساعة التي تم اختيارها غير ملائمة",
                        "warning"
                    );
                }
            }

            if (drivers.indexOf($('#driver').val()) == -1 && ($('#driver').val() != "")) {
                return swal(
                    "خطأ\nשגיאה",
                    "יש לבחור נהג מתוך הרשימה",
                    "warning"
                );
            }
            return true;
        }

        /*
        function fillData() {
            //.trim().replace(/\s\s+/g, ' ')
            if (isCenterPoint) {
                isCenterPatient = true;
            }
            else isCenterPatient = false;
            if ($("#pat").val() != "") {
                var fValue = $("#pat").val().trim().replace(/\s\s+/g, ' ');
                var i = patients.indexOf(fValue);
                if (i === -1) {
                    var i = patientsAssistentDisplay.indexOf(fValue);
                    if (i === -1) { // Did not find any patient with this name
                        return;
                    }
                    //try {
                    localStorage.PatID = patientsAssistent[i].Id;
                    //}
                    //catch {
                    //    alert("If you see this error - please contact Alon")
                    //}
                    $("#patArabic").val(arr_arabNamesAssistent[i]);
                    if (patientsIdentityAssistent[i] != '0') {
                        $("#PatientIdentity").val(patientsIdentityAssistent[i]);
                    }
                    else $("#PatientIdentity").val("");
                    $("#patEnglishName").val(arr_englishNamesAssistent[i]);
                    $("#patientInfo").show();
                }
                else {
                    localStorage.PatID = arr_pat[i].Id;
                    $("#patArabic").val(arr_arabNames[i]);
                    $("#patEnglishName").val(arr_englishNames[i]);
                    $("#PatientIdentity").val(patientsIdentity[i]);
                    $("#patientInfo").show();
                }

                if (rideStatusForFields == 0) {
                    $("#afterNoon").removeAttr('disabled');
                    $("#Origin").removeAttr('disabled');
                    $("#remark").removeAttr('disabled');
                    $("#Destination").removeAttr('disabled');
                    $("#dateRide").removeAttr('disabled');
                    $("#hour").removeAttr('disabled');
                    $("#minute").removeAttr('disabled');
                    $("#dirBTN").removeAttr('disabled');
                    $("#patArabic").removeAttr('disabled');
                }
            }
            else if ($("#patEnglishName").val() != "") {
                var i = arr_englishNames.indexOf($("#patEnglishName").val().trim().replace(/\s\s+/g, ' '));
                if (i === -1) {
                    var i = arr_englishNamesAssistent.indexOf($("#patEnglishName").val().trim().replace(/\s\s+/g, ' '));
                    localStorage.PatID = patientsAssistent[i].Id;
                    $("#patArabic").val(arr_arabNamesAssistent[i]);
                    $("#PatientIdentity").val(patientsIdentityAssistent[i]);
                    $("#pat").val(patientsAssistent[i].DisplayName);
                    $("#patientInfo").show();
                }
                else {
                    $("#pat").val(patients[i]);
                    $("#patArabic").val(arr_arabNames[i]);
                    localStorage.PatID = arr_pat[i].Id;
                    $("#PatientIdentity").val(patientsIdentity[i]);
                    $("#patientInfo").show();
                }
                if (rideStatusForFields == 0) {
                    $("#afterNoon").removeAttr('disabled');
                    $("#Origin").removeAttr('disabled');
                    $("#remark").removeAttr('disabled');
                    $("#Destination").removeAttr('disabled');
                    $("#dateRide").removeAttr('disabled');
                    $("#hour").removeAttr('disabled');
                    $("#minute").removeAttr('disabled');
                    $("#dirBTN").removeAttr('disabled');
                    $("#patArabic").removeAttr('disabled');
                }
            }
            else if ($("#patArabic").val() != "") {
                var i = arr_arabNames.indexOf($("#patArabic").val().trim().replace(/\s\s+/g, ' '));
                if (i === -1) {
                    var i = arr_arabNamesAssistent.indexOf($("#patEnglishName").val().trim().replace(/\s\s+/g, ' '));
                    localStorage.PatID = patientsAssistent[i].Id;
                    $("#patEnglishName").val(arr_englishNamesAssistent[i]);
                    $("#PatientIdentity").val(patientsIdentityAssistent[i]);
                    $("#pat").val(patientsAssistent[i].DisplayName);
                    $("#patientInfo").show();
                }
                else {
                    $("#pat").val(patients[i]);
                    $("#patEnglishName").val(arr_englishNames[i]);
                    localStorage.PatID = arr_pat[i].Id;
                    $("#PatientIdentity").val(patientsIdentity[i]);
                    $("#patientInfo").show();

                }
                if (rideStatusForFields == 0) {
                    $("#afterNoon").removeAttr('disabled');
                    $("#Origin").removeAttr('disabled');
                    $("#remark").removeAttr('disabled');
                    $("#Destination").removeAttr('disabled');
                    $("#dateRide").removeAttr('disabled');
                    $("#hour").removeAttr('disabled');
                    $("#minute").removeAttr('disabled');
                    $("#dirBTN").removeAttr('disabled');
                    $("#patArabic").removeAttr('disabled');
                }
            }
            else if ($("#PatientIdentity").val() != '' && $("#PatientIdentity").val() != '0') {
                var i = patientsIdentity.indexOf(parseInt($("#PatientIdentity").val().trim().replace(/\s\s+/g, ' ')));
                if (i === -1) {
                    var i = patientsIdentityAssistent.indexOf($("#PatientIdentity").val().trim().replace(/\s\s+/g, ' '));
                    localStorage.PatID = patientsAssistent[i].Id;
                    $("#patEnglishName").val(arr_englishNamesAssistent[i]);
                    $("#patArabic").val(arr_arabNamesAssistent[i]);
                    $("#pat").val(patientsAssistent[i].DisplayName);
                    $("#patientInfo").show();
                }
                else {
                    $("#pat").val(patients[i]);
                    $("#patEnglishName").val(arr_englishNames[i]);
                    localStorage.PatID = arr_pat[i].Id;
                    $("#patArabic").val(arr_arabNamesAssistent[i]);
                    //$("#PatientIdentity").val(patientsIdentity[i]);
                    $("#patientInfo").show();
                }
                if (rideStatusForFields == 0) {
                    $("#afterNoon").removeAttr('disabled');
                    $("#Origin").removeAttr('disabled');
                    $("#remark").removeAttr('disabled');
                    $("#Destination").removeAttr('disabled');
                    $("#dateRide").removeAttr('disabled');
                    $("#hour").removeAttr('disabled');
                    $("#minute").removeAttr('disabled');
                    $("#dirBTN").removeAttr('disabled');
                    $("#patArabic").removeAttr('disabled');
                }
            }


            try {
                if (currentOrigin === arr_pat[i].Barrier.Name && isCenterPatient) {
                    $("#Origin option[value ='" + currentOrigin + "']").prop('selected', true);
                    $("#Destination option[value ='" + arr_pat[i].Hospital.Name + "']").prop('selected', true);
                }
                else if (currentDestination === arr_pat[i].Barrier.Name && isCenterPatient) {
                    $("#Origin option[value ='" + arr_pat[i].Hospital.Name + "']").prop('selected', true);
                    $("#Destination option[value ='" + currentDestination + "']").prop('selected', true);
                }
                else if (currentOrigin === arr_pat[i].Hospital.Name && isCenterPatient) {
                    $("#Origin option[value ='" + currentOrigin + "']").prop('selected', true);
                    $("#Destination option[value ='" + arr_pat[i].Barrier.Name + "']").prop('selected', true);
                }
                else if (currentDestination === arr_pat[i].Hospital.Name && isCenterPatient) {
                    $("#Origin option[value ='" + arr_pat[i].Barrier.Name + "']").prop('selected', true);
                    $("#Destination option[value ='" + currentDestination + "']").prop('selected', true);
                }
                else if (currentOrigin != '' && currentDestination != '' && !isCenterPatient) {
                    $("#Origin option[value ='" + currentOrigin + "']").prop('selected', true);
                    $("#Destination option[value ='" + currentDestination + "']").prop('selected', true);
                }
                else {
                    $("#Origin option[value ='" + arr_pat[i].Barrier.Name.replace("'", "\\'") + "']").prop('selected', true);
                    $("#Destination option[value ='" + arr_pat[i].Hospital.Name.replace("'", "\\'") + "']").prop('selected', true);
                    //$("#Origin option[value ='" + arr_pat[i].Barrier.EnglishName.replace("'", "\\'") + "']").prop('selected', true);
                    //$("#Destination option[value ='" + arr_pat[i].Hospital.EnglishName.replace("'", "\\'") + "']").prop('selected', true);
                }
                if (arr_pat[i].IsAnonymous == "True") {
                    //EQQQ
                    //getEquipmentForAnonymousPatient();
                    anonymousName = "True";
                    $("#Origin").attr('disabled', 'disabled');
                    $("#Destination").attr('disabled', 'disabled');
                    //$("#dirBTN").attr('disabled', 'disabled');
                }
                if (firstLoad) {
                    getEquipmentForPatient();
                    firstLoad = false;
                }
                //ADD HERE
                generateEsc();

            } catch (e) {
                if (e.responseText == undefined) {
                    swal("אנא בחר חולה\nالرجاء اختيار مريض");
                }
                else alert(e.responseText);
            }

        }
        */

        function checkFutureDate(date) {
            //if ($("#afterNoon").is(':checked')) { //22:14 is the default time that means afternoon אחה''צ
            //    Hour = 22;
            //    Minute = 14;
            //}

            checkDate = Date.parse(date); //parameter datetime to compare with today
            if ($("#afterNoon").is(':checked')) { //22:14 is the default time that means afternoon אחה''צ
                checkDate = Date.parse(new Date(date.getFullYear(), date.getMonth(), date.getDate(), 23, 59));
            }
            var d2 = new Date(); //now
            currentDate = Date.parse(d2);

            if (checkDate < currentDate) return false //past datetime
            else return true; //future datetime
        }
        //EQQQ

        function getEquipmentForPatient() {
            //.trim().replace(/\s\s+/g, ' ')
            var dataString = $("#pat").val().trim().replace(/\s\s+/g, ' ');

            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getEquipmentForPatient",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                //async: false,
                data: JSON.stringify({ patient: dataString }),
                success: getEquipmentForPatientSuccessCB,
                error: getEquipmentForPatientErrorCB
            });
        }

        function getEquipmentForPatientSuccessCB(data) {
            checkEquipment = [];
            var arr_equipment = JSON.parse(data.d)
            var str = "";
            for (i in arr_equipment) {
                var english = '';
                if (arr_equipment[i] == 'כסא גלגלים') {
                    english = 'Wheelchair';
                }
                else if (arr_equipment[i] == 'כסא תינוק') {
                    english = 'Baby seat';
                }
                else if (arr_equipment[i] == 'קביים') {
                    english = 'Crutches';
                }
                else {
                    english = 'Buster';
                }
                str += arr_equipment[i] + "(" + english + "), ";
                //for check in case of changing anonymous patient
                checkEquipment.push(arr_equipment[i]);
            }
            str = str.substring(0, str.lastIndexOf(", "));
            if (str == "") str = "(None) אין";
            $("#Equipment").text(str);
        }

        function getEquipmentForPatientErrorCB(err) {
            alert("Error in getEquipmentForPatient: " + err.responseText);
        }

        //getEquipment for anonymous patient
        function getEquipmentForAnonymousPatient() {
            //var dataString = document.forms["customerForm"]["pat"].value;
            var dataString = $("#pat").val().trim().replace(/\s\s+/g, ' ');

            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getEquipmentForPatient",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                //async: false,
                data: JSON.stringify({ patient: dataString }),
                success: getEquipmentForAnonymousPatientSuccessCB,
                error: getEquipmentForAnonymousPatientErrorCB
            });
        }

        function getEquipmentForAnonymousPatientSuccessCB(data) {
            checkEquipmentAnonymous = [];
            var arr_equipment = JSON.parse(data.d)
            var str = "";
            for (i in arr_equipment) {
                var english = '';
                if (arr_equipment[i] == 'כסא גלגלים') {
                    english = 'Wheelchair';
                }
                else if (arr_equipment[i] == 'כסא תינוק') {
                    english = 'Baby seat';
                }
                else if (arr_equipment[i] == 'קביים') {
                    english = 'Crutches';
                }
                else {
                    english = 'Buster';
                }
                str += arr_equipment[i] + "(" + english + "), ";
                //for anonymous patient
                checkEquipmentAnonymous.push(arr_equipment[i]);
            }
            str = str.substring(0, str.lastIndexOf(", "));
            if (str == "") str = "(None) אין";
            $("#Equipment").text(str);
        }

        function getEquipmentForAnonymousPatientErrorCB(err) {
            alert("Error in getEquipmentForAnonymousPatient: " + err.responseText);
        }

        function switchDir() {
            var a = $("#Origin").val();
            var b = $("#Destination").val()
            a = a.replace("'", "\\'");
            b = b.replace("'", "\\'");

            $("#Origin option[value ='" + b + "']").prop('selected', true);
            $("#Destination option[value ='" + a + "']").prop('selected', true);
        }

        function loadPage() {
            var userType = GENERAL.USER.getUserType();
            if (userType != "מנהל") {
                $("#coorDiv").hide();
                $("#ph").show();
            } else {
                $("#coorDiv").show();
                $("#ph").hide();
            }
            if (JSON.parse(GENERAL.RIDEPAT.getRidePatList()).length != 0) {
                arr_customer = JSON.parse(GENERAL.RIDEPAT.getRidePatList());
                $("#ridePatNum").attr('disabled', 'disabled');
                $("#coordinator").attr('disabled', 'disabled');
                $("#statusRidePat").attr('disabled', 'disabled');
                $("#Equipment").attr('disabled', 'disabled');
                if (arr_customer.func == "edit" || arr_customer.func == "show") {

                    if (localStorage.getItem("duplicateRidePat") != null) {
                        duplicateRidePat = localStorage.getItem("duplicateRidePat");
                        duplicateRidePat = JSON.parse(duplicateRidePat);
                        $('#repeatRide').val(duplicateRidePat.repeatRide);
                        $('#numberOfRides').val(duplicateRidePat.numberOfRides);
                        $("#duplicateRidePat").prop("checked", true);
                        $('#hideDuplicate').show();
                        console.log(duplicateRidePat)

                        localStorage.removeItem("duplicateRidePat");
                    }

                    uploadData(arr_customer.RidePatNum);
                    $("#hideOnEdit").addClass('duplicateDisplay');

                    if (arr_customer.func == "show") {

                        $("#afterNoon").attr('disabled', 'disabled');
                        $("#pat").attr('disabled', 'disabled');
                        $("#Origin").attr('disabled', 'disabled');
                        $("#remark").attr('disabled', 'disabled');
                        $("#Destination").attr('disabled', 'disabled');
                        $("#dateRide").attr('disabled', 'disabled');
                        $("#hour").attr('disabled', 'disabled');
                        $("#minute").attr('disabled', 'disabled');
                        $("#dirBTN").attr('disabled', 'disabled');
                        $("#patArabic").attr('disabled', 'disabled');
                        $("#saveCustomer").attr('disabled', 'disabled');
                        $("#onlyEscort").prop('disabled', true);

                    }
                }
                else {
                    //check on בדיקה.
                    $("#afterNoon").attr('disabled', 'disabled');
                    $("#Origin").attr('disabled', 'disabled');
                    $("#remark").attr('disabled', 'disabled');
                    $("#Destination").attr('disabled', 'disabled');
                    $("#dateRide").attr('disabled', 'disabled');
                    $("#hour").attr('disabled', 'disabled');
                    $("#minute").attr('disabled', 'disabled');
                    $("#dirBTN").attr('disabled', 'disabled');
                    $("#patArabic").attr('disabled', 'disabled');
                    //$("#saveCustomer").attr('disabled', 'disabled');

                    generateStatus();

                    //generatePat();
                    getPatients_slim();
                    getCoor();
                    generateLocation();
                    generateHour();
                    generateMinute();
                }
            }
        }

        function showDuplicate() {
            if ($("#duplicateRidePat").is(':checked')) {
                $("#hideDuplicate").removeClass('duplicateDisplay');
            }
            else {
                $("#hideDuplicate").addClass('duplicateDisplay');
            }
        }

        //function to fill form for edit
        function uploadData(ridePatNum) {
            //  generatePat();
            getPatients_slim();
            generateLocation();
            generateHour();
            generateMinute();
            generateStatus();

            $('#wait').show();
            $.ajax({
                dataType: "json",
                url: "WebService.asmx/getRidePat",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({ ridePatNum: ridePatNum }),
                success: function (data) {




                    ridePat = JSON.parse(data.d);
                    arr_escort = ridePat.Escorts;



                    GENERAL.RIDEPAT.setRidePatList(JSON.stringify(ridePat));

                    var temp = ridePat.Date.substring(ridePat.Date.indexOf("(") + 1, ridePat.Date.indexOf(")"))
                    var date = new Date(parseInt(temp));
                    day = date.getDay();
                    var dayArr = ["ראשון", "שני", "שלישי", "רביעי", "חמישי", "שישי", "שבת"];
                    var dayName = dayArr[day];
                    var day = date.getDate();
                    var month = date.getMonth() + 1;
                    var year = date.getFullYear();
                    var hours = date.getHours();
                    var minutes = date.getMinutes();
                    if (hours < 10) hours = "0" + hours;
                    if (minutes < 10) minutes = minutes + "0";
                    if (day < 10) day = "0" + day;
                    if (month < 10) month = "0" + month;
                    date = year + "-" + month + "-" + day;

                    //rdate = ryear + "-" + rmonth + "-" + rday;
                    document.getElementById("dateRide").value = date;

                    if (hours + ":" + minutes == "22:14") {
                        $("#afterNoon").attr('checked', 'checked');
                        checkAfternoon();

                    } else {
                        $("#hour option[value='" + hours + "']").prop('selected', true);
                        $("#minute option[value='" + minutes + "']").prop('selected', true);
                    }
                    if (ridePat.Status != 'ממתינה לשיבוץ') {
                        rideStatusForFields = 1;
                    }

                    //editing anonymous ridepat only if a driver assigned to the ride.
                    if ((ridePat.Pat.IsAnonymous == "True") && (ridePat.Status != 'ממתינה לשיבוץ')) {

                        //$("#afterNoon").attr('disabled', 'disabled');
                        $("#Origin").attr('disabled', 'disabled');
                        $("#Destination").attr('disabled', 'disabled');
                        //$("#hour").attr('disabled', 'disabled');
                        //$("#minute").attr('disabled', 'disabled');
                        $("#dateRide").attr('disabled', 'disabled');
                        $("#dirBTN").attr('disabled', 'disabled');
                    }
                    if (ridePat.Pat.IsAnonymous == "True") {
                        var area = "";
                        //if(ridePat.Pat.DisplayName.indexOf('מרכז') !== -1){
                        //    area="מרכז";
                        //}
                        //if(ridePat.Pat.DisplayName.indexOf('דרום') !== -1){
                        //    area="דרום";
                        //}
                        //if(ridePat.Pat.DisplayName.indexOf('ירושלים') !== -1){
                        //    area="ירושלים";
                        //}
                        //if(ridePat.Pat.DisplayName.indexOf('צפון') !== -1){
                        //    area="צפון";
                        //}
                        //if (ridePat.Pat.DisplayName.indexOf('ארז') !== -1) {
                        //    area = "ארז";
                        //}
                        //if (ridePat.Pat.DisplayName.indexOf('תרקומיא') !== -1) {
                        //    area = "תרקומיא";
                        //}
                        var origin = ridePat.Origin.Name;
                        var destination = ridePat.Destination.Name;
                        isCenterPoint = true;
                        getAnonymousPatientsListForArea(origin, destination, area);
                    }
                    //else if (ridePat.Pat.IsAnonymous == "True") {

                    //    var origin = ridePat.Origin.Name;
                    //    var destination = ridePat.Destination.Name;
                    //    generatePatAnonymous(origin, destination);
                    //}

                    if (ridePat.OnlyEscort) $("#onlyEscort").prop('checked', true);
                    $("#ridePatNum").val(ridePat.RidePatNum);


                    RideId = ridePat.RideNum;
                    ridePatId = ridePat.RidePatNum;
                    if (ridePat.Drivers.length > 0) {
                        //$('#Driver').val(ridePat.Drivers[0].Id)

                        var driverIDindex = driversID.indexOf(ridePat.Drivers[0].Id);


                        $('#driver').val(drivers[driverIDindex])
                        currentDriverId = ridePat.Drivers[0].Id;
                        $('#deleteDriver').show();
                    } else {
                        currentDriverId = -1; // There is no driver assigned to the ride

                    }

                    $("#pat").val(ridePat.Pat.DisplayName);

                    fillPage_withPatientData(ridePat.Pat)
                    if (typeof arr_escort !== "undefined") {

                        for (i in arr_escort) {//escortCB$
                            $(`#escortCB${arr_escort[i].Id}`).prop('checked', true);


                            //if (ridePat.Pat.IsAnonymous == "True" && (ridePat.Status != 'ממתינה לשיבוץ')) {
                            //    var Escorted = new Object();
                            //    Escorted = arr_escort[i];
                            //    checkEscorts.push(Escorted);
                            //}
                            //for (j in ridePat.Escorts) {
                            //    //if (arr_escort[i].DisplayName == ridePat.Escorts[j].DisplayName) {
                            //    //CHECK THIS XXXXXXX
                            //    if (arr_escort[i].Id == ridePat.Escorts[j].Id) {
                            //        $("#escortCB" + arr_escort[i].Id).prop('checked', true);
                            //    }
                            //}
                        }
                    } else ($("#selectEscort").html("<label data-toggle='tooltip' title='No escorts'>אין מלווים</label>"));

                    //ridePat.Origin.EnglishName = ridePat.Origin.EnglishName.replace("'", "\\'");
                    //$("#selectOrigin option[value='" + ridePat.Origin.EnglishName + "']").prop('selected', true);
                    //ridePat.Destination.EnglishName = ridePat.Destination.EnglishName.replace("'", "\\'");
                    //$("#selectDestination option[value='" + ridePat.Destination.EnglishName + "']").prop('selected', true);
                    ridePat.Origin.Name = ridePat.Origin.Name.replace("'", "\\'");
                    $("#selectOrigin option[value='" + ridePat.Origin.Name + "']").prop('selected', true);
                    ridePat.Destination.Name = ridePat.Destination.Name.replace("'", "\\'");
                    $("#selectDestination option[value='" + ridePat.Destination.Name + "']").prop('selected', true);

                    if (ridePat.Pat.IsAnonymous == "True") {
                        currentOrigin = ridePat.Origin.Name;
                        currentDestination = ridePat.Destination.Name;
                    }


                    //$("#dateRide").val(date);


                    $("#coordinator").val(ridePat.Coordinator.DisplayName);

                    $("#remark").val(ridePat.Remark);

                    $("#statusRidePat option[value='" + ridePat.Status + "']").prop('selected', true);
                    //anonymousName = ridePat.Pat.DisplayName;
                    isWaiting = ridePat.Status;
                    if (ridePat.Drivers.length > 0) {
                        driverId = ridePat.Drivers[0].Id;
                    }
                    $('#wait').hide();
                    $('#driversDiv').show();
                    $("#lastModified").val(ridePat.LastModified);


                    rideData = arr_customer.RidePatNum;
                    if (rideData !== 1) {
                        var rideNumber = rideData;

                        var returnDriveExist = false;
                        if ($('#driver').val() != "") {
                            localStorage.setItem("ReturnRidePatFlag", true);
                        }
                        //tmpOrigin = $('#Origin').val();
                        Pat = { DisplayName: ridePat.Pat.DisplayName, Id: localStorage.PatID };
                        Origin = { Name: ridePat.Destination.Name };
                        Destination = { Name: ridePat.Origin.Name };
                        Coordinator = { DisplayName: ridePat.Coordinator.DisplayName }
                        Remark = ridePat.Remark;
                        Escorts = ridePat.Escorts;
                        var temp = ridePat.Date.substring(ridePat.Date.indexOf("(") + 1, ridePat.Date.indexOf(")"))
                        var date = new Date(parseInt(temp));
                        let now = new Date();
                        if (date.getTime() < now.getTime()) { // getTime converts the timestemp back to int for more accurate evaluate
                            return;
                        }
                        OnlyEscort = ridePat.OnlyEscort;
                        RidePatBack = {
                            Pat: Pat, Origin: Origin, Destination: Destination, Coordinator: Coordinator, Remark: Remark, Escorts: Escorts, Date: date, OnlyEscort: OnlyEscort
                        }
                        //console.log(RidePatBack)
                        //$.ajax({
                        //    dataType: "json",
                        //    url: "WebService.asmx/CheckRidePat",
                        //    contentType: "application/json; charset=utf-8",
                        //    type: "POST",
                        //    async: false,
                        //    data: JSON.stringify({ RidePatBack }),
                        //    success: function (data) {
                        //        returnDriveExist = JSON.parse(data.d);
                        //        console.log(returnDriveExist)
                        //        var DestIsHospital = hospitals.includes(ridePat.Destination.Name);
                        //        var ReturnRidePatFlag = (localStorage.getItem("ReturnRidePatFlag") == 'true');
                        //        //maybe currentDriverId != -1
                        //        //alert(ReturnRidePatFlag);
                        //        if (DestIsHospital && !returnDriveExist && ReturnRidePatFlag) {
                        //            secondModal = true;
                        //            $("#Modal").modal();

                        //        }
                        //    },
                        //    error: function (err) { alert("Error in CheckRidePat: " + err.responseText); }
                        //});

                        //CANCAEL THE QUESTION OF CREAT A RETURN RIDE WHEN GETS IN THE EDIT
                    }
                    else {
                        data.d = data.d.toString();
                        var temp = data.d.replace(/(?!^)(\d{2})(?=(?:\d{2})*$)/g, '/$1');
                        //var dateToShow = data.d.replace(;

                        swal(
                            "خطأ\nשגיאה",
                            "קיימת כבר הסעה בתאריך " + date + " עם אותו החולה ואותן נקודות האיסוף\nيوجد سفرية بالتاريخ (التاريخ) مع نفس المريض ونفس نقطة الالتقاء",
                            "warning"
                        );

                    }

                },
                error: function (err) {
                    $('#wait').hide();
                    alert("Error in uploadData: " + err.responseText);
                }
            });
        }

        function return2manageRidePats() {//returnRidePat()
            localStorage.setItem("PatientNameForRide", null);
            location.href = "manageRidePats.html"
        }

        function checkAfternoon() {
            if ($("#afterNoon").is(':checked')) {
                $("#hour").val("");
                $("#minute").val("");
                $("#hour").attr('disabled', 'disabled');
                $("#minute").attr('disabled', 'disabled');
            } else {
                $("#hour").val("06");
                $("#minute").val("00");
                $("#hour").attr('disabled', false);
                $("#minute").attr('disabled', false);
            }
        }

        function getPatientInformation() {
            var pat = $("#pat").val();
            arr_details = { displayName: pat, func: "edit" };
            GENERAL.PATIENTS.setPatientsList(JSON.stringify(arr_details));
            if (pat.indexOf("אנונימי") != -1) {
                location.href = "anonymousPatientForm.html";
            }
            else location.href = "patientForm.html";
        }

        function generateDrivers() {
            //var $drivers = $("#Driver");

            $.ajax({
                dataType: "json",
                url: "WebService.asmx/GetDrivers",
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Content-Encoding", "gzip");
                },
                type: "POST",
                async: false,
                data: JSON.stringify({ isActive: true, isDriving: true }),
                success: function (data) {
                    var arr_drivers = JSON.parse(data.d);
                    arr_drivers.sort();
                    for (i in arr_drivers) {

                        drivers.push(arr_drivers[i].DisplayName)
                        driversID.push(arr_drivers[i].Id)
                    }
                    $('#driver').autocomplete({
                        source: drivers
                    });
                },
                error: function (err) { alert("Error in generateDrivers"); }
            });
        }

        function signDriverToRide() {

            //var driverIndex = drivers.indexOf($('#driver').val());
            //userSelected = driversID[driverIndex];
            //userSelected = $('#Driver').val();

            if (userSelected == undefined) {
                //swal({
                //    title: "יש לבחור נהג",
                //    type: "warning",
                //    timer: 2000,
                //    showConfirmButton: true
                //});
                return;
            }

            checkNumberOfRides = JSON.parse(localStorage.getItem("numberOfRides", numberOfRides));

            //localStorage.getItem("repeatRide", repeatRide);
            localStorage.removeItem("numberOfRides");
            localStorage.removeItem("repeatRide");

            if (checkNumberOfRides == 1) {
                var request = {
                    ridePatId: ridePatId,
                    userId: userSelected,
                    driverType: "primary"
                };
            }
            else {
                var request = {
                    ridePatId: JSON.parse(localStorage.getItem("ridePatId", ridePatId)),
                    userId: userSelected,
                    driverType: "primary",
                    numberOfRides: checkNumberOfRides,
                    repeatRide: ""
                };
                localStorage.removeItem("ridePatId");
            }
            var dataString = JSON.stringify(request);
            if (currentDriverId == -1) {
                currentDriverId = userSelected;
                $('#wait').show();

                if (checkNumberOfRides == 1) {
                    $.ajax({ // ajax call starts
                        url: 'WebService.asmx/AssignRideToRidePat',   // server side web service method
                        data: dataString,                          // the parameters sent to the server
                        type: 'POST',                              // can be also GET
                        dataType: 'json',                          // expecting JSON datatype from the server
                        contentType: 'application/json; charset = utf-8', // sent to the server
                        success: signDriverSuccessCB,                // data.d id the Variable data contains the data we get from serverside
                        error: signDriverErrorCB
                    }) // end of ajax call
                }
                else {
                    console.log(dataString)
                    $.ajax({ // ajax call starts
                        url: 'WebService.asmx/AssignMultiRideToRidePat',   // server side web service method
                        data: dataString,                          // the parameters sent to the server
                        type: 'POST',                              // can be also GET
                        dataType: 'json',                          // expecting JSON datatype from the server
                        contentType: 'application/json; charset = utf-8', // sent to the server
                        success: signDriverSuccessCB,                // data.d id the Variable data contains the data we get from serverside
                        error: signDriverErrorCB
                    }) // end of ajax call
                }




            } else {
                if (currentDriverId != userSelected) {
                    if (confirm("האם אתה בטוח שאתה רוצה לשנות את הנהג?")) {
                        $('#wait').show();
                        driverMode = "edit";
                        request = {
                            ridePatId: ridePatId,
                            rideId: RideId,
                            driverId: userSelected
                        }
                        var dataString = JSON.stringify(request);
                        $.ajax({ // ajax call starts
                            url: 'WebService.asmx/LeaveRidePat',   // server side web service method
                            data: dataString,                          // the parameters sent to the server
                            type: 'POST',                              // can be also GET
                            dataType: 'json',                          // expecting JSON datatype from the server
                            contentType: 'application/json; charset = utf-8', // sent to the server
                            success: deleteRideSuccessCB,                // data.d id the Variable data contains the data we get from serverside
                            error: deleteRideErrorCB
                        }) // end of ajax call



                    } else {
                        alert("הנהג לא שונה");
                        //$('#Driver').val(currentDriverId);

                        $('#driver').val(currentDriverId);

                    }
                }
            }


        }

        function signDriverSuccessCB(data) {

            RideId = data.d;
            console.log(RideId);
            $('#wait').hide();
            swal({
                title: "הנהג עודכן בהצלחה",
                type: "success",
                timer: 1000,
                showConfirmButton: false
            });

            $('#deleteDriver').show();
            //if (firstDriverBeforeSwap) {
            //    setTimeout('uploadData(ridePatId)', 1001);
            //    firstDriverBeforeSwap = false;
            //}

        }

        function signDriverErrorCB() {
            $('#wait').hide();
            //alert("Error signing driver");

        }

        function deleteRideSuccessCB() {
            if (driverMode == "edit") {
                currentDriverId = userSelected;
                var request = {
                    ridePatId: ridePatId,
                    userId: userSelected,
                    driverType: "primary"
                };

                var dataString = JSON.stringify(request);
                $.ajax({ // ajax call starts
                    url: 'WebService.asmx/AssignRideToRidePat',   // server side web service method
                    data: dataString,                          // the parameters sent to the server
                    type: 'POST',                              // can be also GET
                    dataType: 'json',                          // expecting JSON datatype from the server
                    contentType: 'application/json; charset = utf-8', // sent to the server
                    success: signDriverSuccessCB,                // data.d id the Variable data contains the data we get from serverside
                    error: signDriverErrorCB
                }) // end of ajax call

            } else if (driverMode == "delete") {
                //$('#Driver').val(0)

                $('#driver').val("")

                $('#wait').hide();
                swal({
                    title: "הנהג נמחק מההסעה בהצלחה",
                    type: "success",
                    timer: 1000,
                    showConfirmButton: false
                });
                $('#deleteDriver').hide();
                currentDriverId = -1;
            }

            driverMode = "";

        }

        function deleteRideErrorCB() {
            $('#wait').hide();
            alert("Error deleting driver");

        }

        function deleteDriverFromRide() {
            //userSelected = $('#Driver').val();

            var driverIndex = drivers.indexOf($('#driver').val());
            userSelected = driversID[driverIndex];

            if (confirm("האם אתה בטוח שאתה רוצה למחוק את הנהג מההסעה?")) {
                $('#wait').show();
                driverMode = "delete";
                deleteDriverFlag = true;
                request = {
                    ridePatId: ridePatId,
                    rideId: RideId,
                    driverId: userSelected
                }
                var dataString = JSON.stringify(request);
                $.ajax({ // ajax call starts
                    url: 'WebService.asmx/LeaveRidePat',   // server side web service method
                    data: dataString,                          // the parameters sent to the server
                    type: 'POST',                              // can be also GET
                    dataType: 'json',                          // expecting JSON datatype from the server
                    contentType: 'application/json; charset = utf-8', // sent to the server
                    success: deleteRideSuccessCB,                // data.d id the Variable data contains the data we get from serverside
                    error: deleteRideErrorCB
                }) // end of ajax call
            } else {

            }
        }

        function createNewRide() {

            let ridepat = JSON.parse(GENERAL.RIDEPAT.getRidePatList());
            ridePat = { ...ridePat, func: 'new' }
            GENERAL.RIDEPAT.setRidePatList(JSON.stringify(ridePat));
            location.reload();
            $('#wait').show();

        }

        function createReturnRide() {

            isThisAReturnDrive = true;
            localStorage.setItem("ReturnRidePatFlag", true);

            returnRide();
            $("#afterNoon").attr('checked', 'checked');
            $("#afterNoon").prop('disabled', false);
            checkAfternoon();

            dateForReturnRepeat = localStorage.getItem("dateForReturnRepeat");
            localStorage.removeItem("dateForReturnRepeat");
            $("#dateRide").val(dateForReturnRepeat)

            $('#driver').val(""); // clearing the value of this input for avoiding mistakes
            $('#saveCustomer').addClass("saveHighlight");

            CoordinatorForReturn = $("#coordinator").val();

            $('#Modal').modal('hide');
        }

        const editThisRide = () => {
            x_wasClicked = true;
            arr_customer.func = 'edit';
        }

    </script>
</head>
<body class="fixed-left">

    <!-- Begin page -->
    <div id="wrapper">

        <!-- Top Bar Start -->
        <div class="topbar">



            <!-- Navbar -->
            <div id="na" class="navbar navbar-default" role="navigation">
                <div class="container">
                    <div class="">
                        <!--Expend/Collaps Side Menue-->
                        <div class="pull-left">
                            <button class="button-menu-mobile open-left waves-effect">
                                <i class="md md-menu"></i>
                            </button>
                            <span class="clearfix"></span>
                        </div>

                        <!-- LOGO -->
                        <div class="pull-left">
                            <div class="text-center">
                                <a href="manageRidePats.html" class="logo"><span>בדרך להחלמה</span>&nbsp&nbsp&nbsp</a>
                            </div>
                        </div>
                        <div class="pull-right">
                            <span class="logo" id="userName"></span>
                        </div>
                    </div>
                    <!--/.nav-collapse -->
                </div>
            </div>
        </div>
        <!-- Top Bar End -->
        <!-- ========== Right Sidebar Start ========== -->
        <div id="menuType"></div>
        <!-- Right Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start page Content here -->
        <!-- ============================================================== -->
        <div class="content-page">
            <!-- Start content -->
            <div class="content">
                <div class="container">
                    <!-- Page-Title -->
                    <form class="form-horizontal" role="form" id="customerForm">
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="page-title-box">
                                    <ol class="breadcrumb pull-right">
                                        <li><a href="viewRidePats.html">כל ההסעות</a></li>
                                        <li data-toggle="tooltip" title="Ride   توصيل المريض" class="active">הסעת חולה</li>
                                    </ol>
                                    <h4 class="page-title">הסעת חולה&nbsp&nbsp<i data-toggle="tooltip" title="Ride   توصيل المريض" class="md md-recent-actors"></i></h4>
                                </div>
                            </div>
                        </div>
                        <div class="row">

                            <div class="col-sm-12">
                                <div class="card-box">
                                    <div class="row">
                                        <h4 class="m-t-0 header-title"><b data-toggle="tooltip" title="Ride   توصيل المريض">הסעת חולה</b></h4>

                                        <div class="text-right m-b-30 m-r-15">
                                            <button type="button" onclick="return2manageRidePats()" class="btn btn-default waves-effect w-md m-b-5"><i data-toggle="tooltip" data-placement="bottom" title="عودة  Back" class="ti-back-right m-r-5"></i>&nbsp Back</button>
                                            <div id="patientInfo"> <button type="button" onclick="getPatientInformation()" dir="ltr" class="btn btn-info waves-effect w-md m-b-5"><i data-toggle="tooltip" data-placement="bottom" title="Patient info" class="ti-info m-r-5"></i>&nbsp Patient information</button></div>
                                        </div>
                                        <p class="required"><span data-toggle="tooltip" title="Must field   حقل اجباري">* שדה חובה</span></p>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Patient's Name   اسم المريض" class="col-sm-2 control-label">שם החולה&nbsp;<span class="required">*</span></label>
                                                    <div class="col-sm-6 ui-widget" id="selectPat">
                                                        <input type="text" id="pat" name="pat" class="form-control">
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <input type="checkbox" id="onlyEscort" />
                                                        <label data-toggle="tooltip" title="Company only   سفر للمرافقين فقط" for="onlyEscort">נסיעה למלווים בלבד</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label id="statuslabelRidePat" data-toggle="tooltip" title="Status   حالة السفرية" class="col-sm-2 control-label">סטטוס</label>
                                                    <div class="col-sm-6" id="selectstatusRidePat">
                                                        <select id="statusRidePat" name="statusRidePat" class="form-control"><option>בחר סטטוס נסיעה</option></select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Patient's English Name   اسم المريض" class="col-sm-2 control-label">שם החולה באנגלית&nbsp;<span class="required">*</span></label>
                                                    <div class="col-sm-6 ui-widget" id="selectEnglishPat">
                                                        <input type="text" id="patEnglishName" name="pat" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Patient ID" class="col-sm-2 control-label">תעודת זהות&nbsp;</label>
                                                    <div class="col-sm-6 ui-widget" id="selectPatId">
                                                        <input type="text" id="PatientIdentity" name="PatientIdentity" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">اسم المريض</label>
                                                    <div class="col-sm-6 ui-widget" id="selectPat">
                                                        <input type="text" id="patArabic" name="patArabic" class="form-control"></input>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Select Origin   اختر نقطة الانطلاق" class="col-sm-2 control-label">מוצא&nbsp;<span class="required">*</span></label>
                                                    <div class="col-sm-6" id="selectOrigin">
                                                        <select id="Origin" name="Origin" class="form-control"><option>בחר מוצא</option></select>
                                                        <input data-toggle="tooltip" title="Change Direction   تغيير اتجاه/ وجهة" id="dirBTN" type="button" value="שינוי כיוון" onclick="switchDir()" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                                <div class="form-group" id="escortDiv">
                                                    <label data-toggle="tooltip" title="Patient escorts" class="col-sm-2 control-label">מלווים</label>
                                                    <div class="col-sm-6" id="selectEscort">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Destination   نقطة الوصول" class="col-sm-2 control-label">יעד&nbsp;<span class="required">*</span></label>
                                                    <div class="col-sm-6" id="selectDestination">
                                                        <select id="Destination" name="Destination" class="form-control"><option>בחר יעד</option></select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Equipment   غرض مرافق" class="col-sm-2 control-label">ציוד נלווה</label>
                                                    <div class="col-sm-6" id="selectaddition">
                                                        <label id="Equipment" name="Equipment" class="control-label" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="ملاحظات   Notes" class="col-sm-2 control-label">הערות</label>
                                                    <div class="col-sm-6">
                                                        <input id="remark" name="remark" type="text" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Time  ساعة السفر" class="col-sm-2 control-label">שעת הסעה&nbsp;<span class="required">*</span></label>
                                                    <div class="col-sm-6" id="selecthour">
                                                        <select id="minute" name="minute" class="form-control" style="width:33%;display:inline"><option>דקות</option></select>
                                                        <p style="display:inline;">:</p>
                                                        <select id="hour" name="hour" class="form-control" style="width:33%; display:inline;"><option>שעות</option></select>
                                                        <br />
                                                        <br />
                                                        <input type="checkbox" id="afterNoon" onchange="checkAfternoon()" />
                                                        <label data-toggle="tooltip" title="or afternoon  او بالمساء" for="afterNoon">או אחה"צ</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Ride #number  رقم السفرية" class="col-sm-2 control-label">מספר הסעה</label>
                                                    <div class="col-sm-6">
                                                        <input id="ridePatNum" name="ridePatNum" type="text" class="form-control">
                                                        <br />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                            </div>
                                        </div>
                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                                <!--HERE!-->
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Last modified" class="col-sm-2 control-label">עודכן לאחרונה</label>
                                                    <div class="col-sm-6">
                                                        <input id="lastModified" name="lastModified" type="text" class="form-control" disabled>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6" id="coorDiv">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">רכז</label>
                                                    <div class="col-sm-6" id="selectCoordinator">
                                                        <input type="text" id="coordinator" name="coordinator" class="form-control">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Date  تاريخ السفر" class="col-sm-2 control-label">תאריך הסעה&nbsp;<span class="required">*</span></label>
                                                    <div class="col-sm-6">
                                                        <!--<input type="text" class="form-control" placeholder="dd/mm/yyyy" id="dateRide" name="dateRide">-->
                                                        <input type="date" class="form-control" placeholder="dd/mm/yyyy" id="dateRide" name="dateRide" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--<div class="row m-l-10 m-r-10">

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">מספר הסעה</label>
                                                    <div class="col-sm-6">
                                                        <input id="ridePatNum" name="ridePatNum" type="text" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                            </div>
                                        </div>-->
                                        <!--duplicate ride section-->
                                        <div class="row m-l-10 m-r-10" id="hideOnEdit">
                                            <div class="col-sm-6">
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <div id="duplicate" class="col-sm-6">
                                                        <input type="checkbox" id="duplicateRidePat" onchange="showDuplicate()" />
                                                        <label data-toggle="tooltip" title="Recurring ride?  سفريات عائدة" for="duplicateRidePat"> הסעה חוזרת?</label>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                        <div class="row m-l-10 m-r-10 duplicateDisplay" id="hideDuplicate">
                                            <div class="col-md-6"></div>
                                            <div class="col-sm-3">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Scheduling جدولة" class="col-sm-2 control-label">תזמון</label>
                                                    <select id="repeatRide" name="repeatRide" class="form-control" style="width:80%;display:inline">
                                                        <option data-toggle="tooltip" title="Every week on this day كل اسبوع">כל שבוע</option>
                                                        <option data-toggle="tooltip" title="Successive days عدة ايام متتالية">מספר ימים ברצף</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-sm-2" id="coorDiv">
                                                <div class="form-group">
                                                    <label data-toggle="tooltip" title="Number of times عدة مرات" class="col-sm-4 control-label">מספר פעמים</label>
                                                    <div class="col-sm-6" id="selectCoordinator">
                                                        <input type="number" max="30" min="0" id="numberOfRides" name="numberOfRides" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-1"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="wait" style="display:none;width:69px;height:89px;position:absolute;top:50%;left:50%;padding:2px;">
                                <img src="../../Media/Wedges-3s-200px.gif" width="64" height="64" />
                            </div>

                            <!--</form>-->

                        </div>

                        <!--XXXXX-->

                        <div class="row" id="driversDiv">
                            <!--<form class="form-horizontal" role="form" id="driverForm">-->
                            <div class="col-sm-12">
                                <!--<hr />-->
                                <div class="card-box">
                                    <div class="row" id="flashDiv">
                                        <!--<h4 class="m-t-0 header-title"><b>נהג בנסיעה</b></h4>-->

                                        <div class="row m-l-10 m-r-10">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">נהג בנסיעה&nbsp;</label>
                                                    <div class="col-sm-6" id="selectDriver">
                                                        <!--<select id="Driver" class="form-control"><option value="0">בחר נהג</option></select>-->
                                                        <input placeholder="הזן שם" type="text" id="driver" name="driver" class="form-control ui-autocomplete-input" autocomplete="off" aria-required="true" aria-invalid="false">
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="col-sm-6">

                                                <!--<input type="button" onclick="signDriverToRide()" id="saveDriver" class="btn btn-success w-md waves-light m-b-5 m-r-15" value="Save Driver" />-->
                                                <input type="button" onclick="deleteDriverFromRide()" id="deleteDriver" class="btn btn-danger w-md waves-light m-b-5 m-r-15" value="הסרת נהג" />

                                                <!--<div class="form-group" id="escortDiv">
                                                    <label data-toggle="tooltip" title="Patient escorts" class="col-sm-2 control-label">מלווים</label>
                                                    <div class="col-sm-6" id="selectEscort">
                                                    </div>
                                                </div>-->
                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <!--<hr />-->
                            <div class="text-right m-t-30 row">
                                <button data-toggle="tooltip" title="Save  حفظ" type="submit" id="saveCustomer" class="btn btn-success waves-effect w-md waves-light m-b-5  m-r-15"><i class="ti-save m-r-5"></i>&nbsp Save</button>
                            </div>
                        </div>
                        <div class="row m-l-10 m-r-10">
                            <div class="col-sm-12 text-center">
                                <br />
                                <br />
                                <button type="button" onclick="return2manageRidePats()" class="btn btn-default waves-effect w-md m-b-5"> חזרה לניהול ההסעות שלי&nbsp<i class="ti-back-right m-r-5"></i></button>
                            </div>
                        </div>

                    </form>




                </div>

            </div>
            <!-- Modal -->
            <!--<div class="modal fade text-center" id="IgulModal" tabindex="-1" role="dialog" aria-labelledby="IgulModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title" id="exampleModalLabel">תודה רבה</h2>
                            <h3>הפרטים נשמרו</h3>

                        </div>
                        <div class="modal-body">
                            <div class="row m-l-10 m-r-10">
                                <div class="col-sm-12 text-center">

                                    <h4>
                                        האם תהיה מעוניין ליצור נסיעת חזרה?
                                    </h4>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <div class="col-sm-12 text-center">
                                <button type="button" class="btn btn-primary" onclick="goToIgul()">כן</button>
                                <button type="button" class="btn btn-secondary" onclick="reload()">לא</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>-->
            <!-- end container -->
        </div>
        <!-- end content -->
        <!-- FOOTER -->
        <footer id="rights" data-toggle="tooltip" data-placement="top" title="© All rights reserved The Road to Recovery.  جميع الحقوق محفوظة لجمعية الطريق الى الشفاء" class="footer text-right">
        </footer>
        <!-- End FOOTER -->
    </div>
    <!-- END wrapper -->
    <div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="ModalTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="editThisRide()">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h1 class="modal-title centerHeader" id="ModalTitle">הנסיעה נשמרה</h1>

                </div>
                <div class="modal-body">
                    <h3 class="centerHeader">להמשך, בחר.י:</h3>
                    <!-- <h4 class="centerHeader">(אפשר לשנות פרטים בהחזרה, ובסוף יש להקיש על מקש שמירה)</h4>-->
                </div>
                <div id="modalButtons" class="modal-footer centerHeader">
                    <button onclick="createNewRide()" class="btn btn-success waves-effect w-md m-b-5 sameWidthBtn">יצירת הסעה חדשה</button>
                    <button onclick="return2manageRidePats()" class="btn btn-default waves-effect w-md m-b-5 sameWidthBtn">חזרה לניהול ההסעות שלי<i class="ti-back-right m-r-5"></i></button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

